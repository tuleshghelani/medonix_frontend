import{a as Yt}from"./chunk-SVBUHBIG.js";import{c as qt,d as Gt}from"./chunk-WYYFELHO.js";import{b as Z}from"./chunk-GC4KDOX7.js";import{a as X,b as Mt}from"./chunk-44VES7CY.js";import{b as vt,c as nt,d as xt}from"./chunk-PGE6QRUW.js";import{$b as rt,Ab as pt,C as R,D as lt,Db as Y,Eb as gt,Fb as ht,Ga as dt,H as b,Hb as U,I as C,Ib as _t,Jb as ft,Ka as S,Kb as Q,La as Vt,Ma as k,Ob as bt,Pa as V,Pb as Ct,Rb as Pt,Sa as L,Sb as K,Ta as z,Tb as jt,U as c,Ua as j,Ub as Bt,V as P,Va as B,Vb as $t,Xa as ut,Xb as W,Ya as mt,Yb as et,_a as Lt,a as it,aa as v,b as Rt,bb as zt,bc as H,ca as d,e as at,ea as y,f as N,ha as o,ia as r,ja as p,ma as F,o as tt,pa as h,q as ct,qa as g,u as x,wa as i,wb as $,wc as J,xa as A,xb as M,xc as T,y as st,ya as w,yb as q,zb as G,zc as D}from"./chunk-RL35WT5O.js";var Zt=()=>({label:"All Customers",value:""});function te(s,_){if(s&1){let t=F();o(0,"div",6)(1,"div",31),p(2,"app-searchable-select",32),o(3,"button",33),h("click",function(){b(t);let n=g();return C(n.refreshCustomers())}),p(4,"i",34),r()()()}if(s&2){let t=g();c(2),d("options",t.customers)("defaultOption",dt(5,Zt))("searchPlaceholder","Search customers..."),c(),d("disabled",t.isLoadingCustomers),c(),d("ngClass",t.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt")}}function ee(s,_){if(s&1){let t=F();o(0,"button",35),h("click",function(){b(t);let n=g();return C(n.exportExcel())}),p(1,"i",36),i(2," Export "),r()}if(s&2){let t=g();d("disabled",t.isExportButtonDisabled())}}function ne(s,_){if(s&1){let t=F();o(0,"div",37)(1,"button",38),h("click",function(){b(t);let n=g();return C(n.clearLocalStorage())}),p(2,"i",39),i(3," Add Sale "),r()()}}function re(s,_){s&1&&(o(0,"th",27),i(1,"Actions"),r())}function oe(s,_){if(s&1){let t=F();o(0,"td",47)(1,"button",48),h("click",function(){b(t);let n=g().$implicit,a=g();return C(a.generatePdf(n.id,n.invoiceNumber))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(2,"i",49),r(),o(3,"button",50),h("click",function(){b(t);let n=g().$implicit,a=g();return C(a.editSales(n.id))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(4,"i",51),r(),o(5,"button",52),h("click",function(){b(t);let n=g().$implicit,a=g();return C(a.deleteSale(n.id))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(6,"i",53),r()()}}function ie(s,_){if(s&1&&(o(0,"tr",40)(1,"td",41),i(2),r(),o(3,"td",42)(4,"strong"),i(5),r()(),o(6,"td",43),i(7),r(),o(8,"td",44),i(9),S(10,"date"),r(),o(11,"td",45)(12,"strong"),i(13),S(14,"round"),r()(),v(15,oe,7,0,"td",46),r()),s&2){let t,e=_.$implicit,n=_.index,a=g();c(2),A(a.startIndex+n+1),c(3),A(e==null?null:e.invoiceNumber),c(2),A(e!=null&&e.customerName?e==null?null:e.customerName:"-"),c(2),A(k(10,6,e==null?null:e.saleDate,"dd-MM-yyyy")),c(4),A(Vt(14,9,(t=e==null?null:e.totalSaleAmount)!==null&&t!==void 0?t:0)),c(2),d("ngIf",a.canManageSales)}}function ae(s,_){if(s&1){let t=F();o(0,"app-pagination",54),h("pageChange",function(n){b(t);let a=g();return C(a.onPageChange(n))})("pageSizeChange",function(n){b(t);let a=g();return C(a.onPageSizeChange(n))}),r()}if(s&2){let t=g();d("currentPage",t.currentPage)("pageSize",t.pageSize)("totalElements",t.totalElements)("pageSizeOptions",t.pageSizeOptions)}}var Ut=(()=>{class s{constructor(t,e,n,a,l,u,m,f,O){this.saleService=t,this.customerService=e,this.fb=n,this.snackbar=a,this.dateUtils=l,this.encryptionService=u,this.router=m,this.authService=f,this.cdr=O,this.sales=[],this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,50,100],this.totalPages=0,this.totalElements=0,this.startIndex=0,this.endIndex=0,this.customers=[],this.isLoadingCustomers=!1,this.canManageSales=!1,this.destroy$=new N,this.initializeForm()}ngOnInit(){this.canManageSales=this.authService.isAdmin()||this.authService.isStaffAdmin(),this.loadSales(),this.canManageSales&&this.loadCustomers()}initializeForm(){this.searchForm=this.fb.group({search:[""],customerId:[""],startDate:[""],endDate:[""],batchNumber:[""]})}onSearch(){this.currentPage=0,this.loadSales()}downloadFile(t,e){let n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n)}onPageChange(t){this.currentPage=t,this.loadSales()}onPageSizeChange(t){this.pageSize=t,this.currentPage=0,this.loadSales()}deleteSale(t){confirm("Are you sure you want to delete this sale? This action cannot be undone.")&&(this.isLoading=!0,this.saleService.deleteSale(t).pipe(x(this.destroy$)).subscribe({next:e=>{e.success?(this.snackbar.success("Sale deleted successfully"),this.loadSales()):(this.snackbar.error(e.message||"Failed to delete sale"),this.isLoading=!1,this.cdr.markForCheck())},error:e=>{this.snackbar.error(e?.error?.message||"Failed to delete sale"),this.isLoading=!1,this.cdr.markForCheck()}}))}formatDate(t){return this.dateUtils.formatDate(t)}resetForm(){this.searchForm.reset(),this.currentPage=0,this.loadSales()}loadCustomers(){this.canManageSales&&(this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(x(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}refreshCustomers(){this.canManageSales&&(this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(x(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to refresh customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}editSales(t){localStorage.setItem("saleId",this.encryptionService.encrypt(t.toString())),this.router.navigate(["/sale/create"])}addSaleReturn(t){let e=this.encryptionService.encrypt(t.toString());this.router.navigate(["/sale/return",e])}generatePdf(t,e){this.saleService.generatePdf(t).pipe(x(this.destroy$)).subscribe({next:({blob:n,filename:a})=>{let l=e?`sale-${e}.pdf`:a;this.downloadFile(n,l),this.snackbar.success("PDF downloaded successfully")},error:n=>{this.snackbar.error(n?.error?.message||"Failed to generate PDF")}})}isExportButtonDisabled(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;return!t||!e}exportExcel(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;if(!t||!e){this.snackbar.error("Please select both start date and end date to export");return}let n=this.dateUtils.formatDateDDMMYYYY(t),a=this.dateUtils.formatDateDDMMYYYY(e);this.isLoading=!0,this.saleService.exportExcel({startDate:n,endDate:a}).pipe(x(this.destroy$)).subscribe({next:({blob:l,filename:u})=>{let m=u||`sale_export_${n}_${a}.xlsx`;this.downloadFile(l,m),this.snackbar.success("Excel file downloaded successfully"),this.isLoading=!1,this.cdr.markForCheck()},error:l=>{this.snackbar.error(l?.error?.message||"Failed to export Excel file"),this.isLoading=!1,this.cdr.markForCheck()}})}loadSales(){this.isLoading=!0;let t=it({currentPage:this.currentPage,perPageRecord:this.pageSize,startDate:this.searchForm.value.startDate?this.dateUtils.formatDate(this.searchForm.value.startDate):"",endDate:this.searchForm.value.endDate?this.dateUtils.formatDate(this.searchForm.value.endDate):""},this.searchForm.value);this.saleService.searchSales(t).pipe(x(this.destroy$)).subscribe({next:e=>{this.sales=e.content,this.totalPages=e.totalPages,this.totalElements=e.totalElements,this.startIndex=this.currentPage*this.pageSize,this.endIndex=Math.min((this.currentPage+1)*this.pageSize,this.totalElements),this.isLoading=!1,this.cdr.markForCheck()},error:e=>{this.snackbar.error(e.message||"Failed to load sales"),this.isLoading=!1,this.cdr.markForCheck()}})}clearLocalStorage(){localStorage.removeItem("saleId"),this.router.navigate(["/sale/create"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(e){return new(e||s)(P(Z),P(X),P(K),P(J),P(Mt),P(H),P(W),P(vt),P(V))}}static{this.\u0275cmp=R({type:s,selectors:[["app-sale"]],decls:53,vars:8,consts:[[1,"sales-container"],[3,"show"],["aria-labelledby","search-sales-heading",1,"search-section","card"],["id","search-sales-heading"],["role","search","aria-label","Sale search form",3,"ngSubmit","formGroup"],[1,"search-controls"],[1,"form-group"],["for","invoice-search",1,"sr-only"],["id","invoice-search","type","text","formControlName","search","placeholder","Search by invoice number...","aria-label","Search by invoice number",1,"form-control"],["for","batch-search",1,"sr-only"],["id","batch-search","type","text","formControlName","batchNumber","placeholder","Search by Batch Number...","aria-label","Search by batch number",1,"form-control"],["class","form-group",4,"ngIf"],["for","start-date",1,"sr-only"],["id","start-date","type","date","formControlName","startDate","placeholder","Start Date","aria-label","Start date",1,"form-control",3,"touchstart"],["for","end-date",1,"sr-only"],["id","end-date","type","date","formControlName","endDate","placeholder","End Date","aria-label","End date",1,"form-control",3,"touchstart"],[1,"button-group"],["type","submit",1,"search-btn","btn","btn-sm","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-btn","btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-undo"],["type","button","class","search-btn btn btn-sm btn-success export-btn","title","Export sales to Excel",3,"disabled","click",4,"ngIf"],["class","action-header",4,"ngIf"],["aria-labelledby","sales-heading",1,"sales-list","card"],["id","sales-heading"],[1,"table-responsive"],["role","table","aria-label","Sales list",1,"table"],["scope","col"],["scope","col",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],[3,"currentPage","pageSize","totalElements","pageSizeOptions","pageChange","pageSizeChange",4,"ngIf"],[1,"product-select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","defaultOption","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",2,"margin-top","3px",3,"click","disabled"],[1,"fas",3,"ngClass"],["type","button","title","Export sales to Excel",1,"search-btn","btn","btn-sm","btn-success","export-btn",3,"click","disabled"],[1,"fas","fa-file-excel"],[1,"action-header"],["aria-label","Add new sale",1,"btn","btn-sm","btn-primary","mb-2",3,"click"],["aria-hidden","true",1,"fas","fa-plus"],["role","row"],["data-label","No"],["data-label","Invoice No."],["data-label","Customer Name"],["data-label","Sale Date"],["data-label","Total Sales Amount"],["class","actions","data-label","Actions",4,"ngIf"],["data-label","Actions",1,"actions"],["aria-label","Export sale as PDF",1,"btn-icon","pdf",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-file-pdf"],["aria-label","View sale details",1,"btn-icon","edit",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-eye"],["aria-label","Delete sale",1,"btn-icon","delete",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-trash"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalElements","pageSizeOptions"]],template:function(e,n){e&1&&(o(0,"div",0),p(1,"app-loader",1),o(2,"section",2)(3,"h2",3),i(4,"Search Sales"),r(),o(5,"form",4),h("ngSubmit",function(){return n.onSearch()}),o(6,"div",5)(7,"div",6)(8,"label",7),i(9,"Search by invoice number"),r(),p(10,"input",8),o(11,"label",9),i(12,"Search by batch number"),r(),p(13,"input",10),r(),v(14,te,5,6,"div",11),o(15,"div",6)(16,"label",12),i(17,"Start date"),r(),o(18,"input",13),h("touchstart",function(l){return l.stopPropagation()}),r()(),o(19,"div",6)(20,"label",14),i(21,"End date"),r(),o(22,"input",15),h("touchstart",function(l){return l.stopPropagation()}),r()(),o(23,"div",16)(24,"button",17),p(25,"i",18),i(26," Search "),r(),o(27,"button",19),h("click",function(){return n.resetForm()}),p(28,"i",20),i(29," Reset "),r(),v(30,ee,3,1,"button",21),r()()()(),v(31,ne,4,0,"div",22),o(32,"section",23)(33,"h2",24),i(34,"Sales"),r(),o(35,"div",25)(36,"table",26)(37,"thead")(38,"tr")(39,"th",27),i(40,"No"),r(),o(41,"th",27),i(42,"Invoice No."),r(),o(43,"th",27),i(44,"Customer Name"),r(),o(45,"th",27),i(46,"Sale Date"),r(),o(47,"th",27),i(48,"Total Sales Amount"),r(),v(49,re,2,0,"th",28),r()(),o(50,"tbody"),v(51,ie,16,11,"tr",29),r()()(),v(52,ae,1,4,"app-pagination",30),r()()),e&2&&(c(),d("show",n.isLoading),c(4),d("formGroup",n.searchForm),c(9),d("ngIf",n.canManageSales),c(16),d("ngIf",n.canManageSales),c(),d("ngIf",n.canManageSales),c(18),d("ngIf",n.canManageSales),c(2),d("ngForOf",n.sales),c(),d("ngIf",n.totalPages>0))},dependencies:[z,j,B,Y,$,q,G,U,Q,T,D,nt,ut,Yt],styles:[".sales-container[_ngcontent-%COMP%]{padding:2rem;position:relative;min-height:200px;background-color:var(--background)}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border-radius:0;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;padding:20px}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--text-primary);font-size:1.5rem;font-weight:600}.sales-container[_ngcontent-%COMP%]   .action-header[_ngcontent-%COMP%]{margin-bottom:1rem}.sales-container[_ngcontent-%COMP%]   .action-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{touch-action:manipulation;-webkit-tap-highlight-color:transparent}.sales-container[_ngcontent-%COMP%]   .sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:flex-start}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{grid-template-columns:1fr}}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin:0}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{grid-column:1/-1}}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:120px;height:42px;display:flex;align-items:center;justify-content:center;gap:.5rem;transition:all .2s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent;cursor:pointer}@media (max-width: 576px){.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100%;flex:1 1 100%}}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:1px solid #28a745;font-weight:500}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838;border-color:#1e7e34;transform:translateY(-1px);box-shadow:0 2px 4px #28a7454d}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:active:not(:disabled), .sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:focus:not(:disabled){outline:2px solid rgba(40,167,69,.5);outline-offset:2px;transform:translateY(0)}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:disabled{background-color:#6c757d;border-color:#6c757d;opacity:.6;cursor:not-allowed;transform:none}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap;font-weight:600}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;border:1px solid #dee2e6;border-radius:4px;padding:.5rem}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border:none;border-bottom:1px solid #f0f0f0}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);font-weight:600;color:var(--text-primary)}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-bottom:none}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]{justify-content:flex-start;flex-wrap:wrap;gap:.5rem}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]:before{display:none}}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-secondary);white-space:nowrap}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{width:auto;min-width:80px;padding:.5rem;margin-bottom:0}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]{padding:1rem}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{width:100%}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{touch-action:manipulation;-webkit-appearance:none}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:1rem}}@media (max-width: 576px){.sales-container[_ngcontent-%COMP%]{padding:.75rem}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}.table-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]{width:100%}.table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{flex:1}}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-start;flex-wrap:wrap}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:6px;transition:all .2s ease;display:flex;align-items:center;justify-content:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-width:36px;min-height:36px}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]{color:var(--primary);background-color:#1458811a}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.return[_ngcontent-%COMP%]{color:#ff9800;background-color:#ff98001a}.actions[_ngcontent-%COMP%]   .btn-icon.return[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#ff9800;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.return[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]{color:var(--primary);background-color:#fd78231a}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:active{transform:translateY(0)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{padding:6px}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}}  .custom-snackbar.success{background-color:var(--accent2)}  .custom-snackbar.error{background-color:#dc3545}  .custom-snackbar .snackbar-message{display:flex;align-items:center;gap:.5rem;color:#fff}  .custom-snackbar .snackbar-message i{font-size:1.2rem}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffc;display:flex;justify-content:center;align-items:center;z-index:1000}.loading-overlay[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:var(--primary)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]{background-color:var(--background);color:#fff;margin-top:3px;width:42px;height:42px;border-radius:6px;transition:all .2s ease}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:active{transform:translateY(0)}"],changeDetection:0})}}return s})();function se(s,_){s&1&&(o(0,"div",54),i(1," Customer is required "),r())}function le(s,_){s&1&&(o(0,"div",54),i(1," Sale date is required "),r())}function de(s,_){s&1&&(o(0,"div",54),i(1," Packaging and forwarding charges is required and must be 0 or greater "),r())}function ue(s,_){s&1&&(o(0,"div",54),i(1," Please select a product "),r())}function me(s,_){s&1&&(o(0,"div",54),i(1," Quantity must be 1 or greater "),r())}function pe(s,_){s&1&&(o(0,"div",54),i(1," Double quotes are not allowed "),r())}function ge(s,_){s&1&&(o(0,"div",54),i(1," Unit price must be greater than 0 "),r())}function he(s,_){if(s&1&&(o(0,"div",34)(1,"span",35),i(2,"%"),r(),p(3,"input",73),r()),s&2){let t=g().index,e=g();c(3),y("is-invalid",e.isProductFieldInvalid(t,"discountPercentage"))}}function _e(s,_){s&1&&(o(0,"div",34),p(1,"input",74),o(2,"span",75),i(3,"-"),r()())}function fe(s,_){s&1&&(o(0,"div",54),i(1," Discount percentage must be between 0 and 100 "),r())}function be(s,_){if(s&1&&(o(0,"div",34)(1,"span",35),i(2,"\u20B9"),r(),p(3,"input",76),r()),s&2){let t=g().index,e=g();c(3),y("is-invalid",e.isProductFieldInvalid(t,"discountAmount"))}}function Ce(s,_){if(s&1&&(o(0,"div",34)(1,"span",35),i(2,"\u20B9"),r(),p(3,"input",77),r()),s&2){let t=g().index,e=g();c(3),d("value",e.getFormattedDiscountAmount(t))}}function Pe(s,_){s&1&&(o(0,"div",54),i(1," Discount amount cannot exceed subtotal "),r())}function ve(s,_){if(s&1){let t=F();o(0,"tr",55)(1,"td")(2,"div",56)(3,"div",14),p(4,"app-searchable-select",57),o(5,"button",58),h("click",function(){b(t);let n=g();return C(n.refreshProducts())})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(6,"i",17),r()(),v(7,ue,2,0,"div",18),r()(),o(8,"td")(9,"div",56),p(10,"input",59),v(11,me,2,0,"div",18),r()(),o(12,"td")(13,"div",56),p(14,"input",60),v(15,pe,2,0,"div",18),r()(),o(16,"td")(17,"div",56)(18,"div",34)(19,"span",35),i(20,"\u20B9"),r(),p(21,"input",61),r(),v(22,ge,2,0,"div",18),r()(),o(23,"td")(24,"div",34),p(25,"input",62),r()(),o(26,"td")(27,"div",56)(28,"div",63)(29,"div",64)(30,"input",65),h("change",function(){let n=b(t).index,a=g();return C(a.onDiscountTypeChange(n))}),r(),o(31,"label",66),i(32,"%"),r()(),o(33,"div",64)(34,"input",65),h("change",function(){let n=b(t).index,a=g();return C(a.onDiscountTypeChange(n))}),r(),o(35,"label",66),i(36,"\u20B9"),r()()()()(),o(37,"td")(38,"div",56),v(39,he,4,2,"div",67)(40,_e,4,0,"div",67)(41,fe,2,0,"div",18),r()(),o(42,"td")(43,"div",56),v(44,be,4,2,"div",67)(45,Ce,4,1,"div",67)(46,Pe,2,0,"div",18),r()(),o(47,"td")(48,"div",34),p(49,"input",68),r()(),o(50,"td")(51,"div",34),p(52,"input",69),r()(),o(53,"td")(54,"div",56),p(55,"input",70),r()(),o(56,"td")(57,"button",71),h("click",function(){let n=b(t).index,a=g();return C(a.removeProduct(n))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(58,"i",72),r()()()}if(s&2){let t,e,n,a,l,u=_.index,m=g();d("formGroupName",u),c(4),y("is-invalid",m.isProductFieldInvalid(u,"productId")),d("focusWidthPx",600)("options",m.products)("placeholder","Select Product")("searchPlaceholder","Search products..."),c(),d("disabled",m.isLoadingProducts),c(),d("ngClass",m.isLoadingProducts?"fa-spinner fa-spin":"fa-sync-alt"),c(),d("ngIf",m.isProductFieldInvalid(u,"productId")),c(3),y("is-invalid",m.isProductFieldInvalid(u,"quantity")),c(),d("ngIf",m.isProductFieldInvalid(u,"quantity")),c(3),y("is-invalid",m.isProductFieldInvalid(u,"batchNumber")),c(),d("ngIf",(t=m.productsFormArray.at(u).get("batchNumber"))==null||t.errors==null?null:t.errors.doubleQuotes),c(6),y("is-invalid",m.isProductFieldInvalid(u,"unitPrice")),c(),d("ngIf",m.isProductFieldInvalid(u,"unitPrice")),c(3),d("value",m.getFormattedPrice(u)),c(5),d("value","percentage")("id","discountTypePercentage"+u),c(),d("for","discountTypePercentage"+u),c(3),d("value","amount")("id","discountTypeAmount"+u),c(),d("for","discountTypeAmount"+u),c(4),d("ngIf",((e=m.productsFormArray.at(u).get("discountType"))==null?null:e.value)==="percentage"),c(),d("ngIf",((n=m.productsFormArray.at(u).get("discountType"))==null?null:n.value)!=="percentage"),c(),d("ngIf",m.isProductFieldInvalid(u,"discountPercentage")),c(3),d("ngIf",((a=m.productsFormArray.at(u).get("discountType"))==null?null:a.value)==="amount"),c(),d("ngIf",((l=m.productsFormArray.at(u).get("discountType"))==null?null:l.value)!=="amount"),c(),d("ngIf",m.isProductFieldInvalid(u,"discountAmount")),c(3),d("value",m.getFormattedDiscountPrice(u)),c(3),d("value",m.getFormattedTaxAmount(u)),c(5),d("disabled",m.productsFormArray.length===1)}}function xe(s,_){if(s&1&&(o(0,"div",46)(1,"span"),i(2,"Total Discount:"),r(),o(3,"strong",78),i(4),S(5,"number"),r()()),s&2){let t=g();c(4),w("-\u20B9",k(5,1,t.totalDiscountAmount,"1.2-2"),"")}}var Dt=(()=>{class s{get productsFormArray(){return this.saleForm.get("products")}trackByProductIndex(t,e){return e}constructor(t,e,n,a,l,u,m,f,O){this.fb=t,this.productService=e,this.customerService=n,this.saleService=a,this.snackbar=l,this.http=u,this.router=m,this.encryptionService=f,this.cdr=O,this.products=[],this.customers=[],this.loading=!1,this.isLoadingProducts=!1,this.isLoadingCustomers=!1,this.isEdit=!1,this.destroy$=new N,this.productSubscriptions=[],this.productMap=new Map,this.totalAmount=0,this.totalDiscountAmount=0,this.totalTaxAmount=0,this.grandTotal=0,this.initForm()}ngOnInit(){this.loadProducts(),this.loadCustomers(),this.saleForm.get("packagingAndForwadingCharges")?.valueChanges.pipe(x(this.destroy$),tt(150)).subscribe(()=>{this.calculateTotalAmount(),this.cdr.markForCheck()});let t=localStorage.getItem("saleId");if(t){let e=this.encryptionService.decrypt(t);e&&this.fetchSaleDetails(Number(e))}}ngOnDestroy(){this.productSubscriptions.forEach(t=>{t&&!t.closed&&t.unsubscribe()}),this.productSubscriptions=[],this.destroy$.next(),this.destroy$.complete(),this.products=[],this.customers=[],this.productMap.clear(),this.saleForm&&this.saleForm.reset()}initForm(){this.saleForm=this.fb.group({id:[null],customerId:["",M.required],saleDate:[L(new Date,"yyyy-MM-dd","en"),M.required],invoiceNumber:[""],products:this.fb.array([]),isBlack:[!1,M.required],packagingAndForwadingCharges:[0,[M.required,M.min(0)]]}),this.addProduct()}createProductFormGroup(){return this.fb.group({id:[null],productId:["",M.required],quantity:["",[M.required,M.min(1)]],batchNumber:["",[this.noDoubleQuotesValidator()]],unitPrice:["",[M.required,M.min(.01)]],price:[{value:0,disabled:!0}],discountType:["percentage"],discountPercentage:[0,[M.min(0),M.max(100)]],discountAmount:[0,[M.min(0)]],discountPrice:[{value:0,disabled:!0}],taxPercentage:[{value:0,disabled:!0}],taxAmount:[{value:0,disabled:!0}],remarks:[null,[]]})}addProduct(){let t=this.createProductFormGroup(),e=this.setupProductCalculations(t);this.productSubscriptions.push(e),this.productsFormArray.push(t)}removeProduct(t){this.productsFormArray.length!==1&&(this.productSubscriptions[t]&&(this.productSubscriptions[t].unsubscribe(),this.productSubscriptions.splice(t,1)),this.productsFormArray.removeAt(t),this.calculateTotalAmount())}setupProductCalculations(t){let e=new at,n=t.get("productId")?.valueChanges.pipe(x(this.destroy$),ct()).subscribe(l=>{if(l){let u=this.productMap.get(l);if(u){let m=u.taxPercentage||0,f=u.saleAmount||0;t.patchValue({taxPercentage:m,unitPrice:f},{emitEvent:!1}),this.calculateProductPrice(t)}}});n&&e.add(n);let a=t.valueChanges.pipe(x(this.destroy$),tt(150)).subscribe(()=>{this.calculateProductPrice(t)});return e.add(a),e}calculateProductPrice(t){if(!t)return;let e=Number(t.get("quantity")?.value||0),n=Number(t.get("unitPrice")?.value||0),a=Number(t.get("taxPercentage")?.value||0),l=t.get("discountType")?.value||"percentage",u=Number(t.get("discountPercentage")?.value||0),m=Number(t.get("discountAmount")?.value||0),f=Number((e*n).toFixed(2)),O=0;if(l==="percentage"&&u>0){let Ot=Math.min(u,100);O=Number((f*(Ot/100)).toFixed(2)),u>100&&t.patchValue({discountPercentage:100},{emitEvent:!1})}else l==="amount"&&m>0&&(O=Math.min(m,f),m>f&&t.patchValue({discountAmount:f},{emitEvent:!1}));let E=Number((f-O).toFixed(2)),I=Number((E*a/100).toFixed(2)),Wt=Number((E+I).toFixed(2));t.patchValue({price:f,discountAmount:O,discountPrice:E,taxAmount:I},{emitEvent:!1}),this.calculateTotalAmount(),this.cdr.markForCheck()}getTotalAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("price").value||0),0)}getTotalTaxAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("taxAmount").value||0),0)}getTotalFinalPrice(){return this.productsFormArray.controls.reduce((t,e)=>{let n=Number(e.get("discountPrice")?.value||e.get("price")?.value||0),a=Number(e.get("taxAmount")?.value||0);return t+(n+a)},0)}getTotalDiscountAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+Number(e.get("discountAmount")?.value||0),0)}onDiscountTypeChange(t){let e=this.productsFormArray.at(t);e.get("discountType")?.value==="percentage"?e.patchValue({discountAmount:0},{emitEvent:!1}):e.patchValue({discountPercentage:0},{emitEvent:!1}),this.calculateProductPrice(e)}validateDiscount(t){let e=this.productsFormArray.at(t),n=Number(e.get("quantity")?.value||0),a=Number(e.get("unitPrice")?.value||0),l=n*a,u=e.get("discountType")?.value,m=Number(e.get("discountPercentage")?.value||0),f=Number(e.get("discountAmount")?.value||0);if(u==="percentage"){if(m<0||m>100)return!1}else if(u==="amount"){if(f<0)return!1;if(f>l)return e.patchValue({discountAmount:l},{emitEvent:!1}),this.calculateProductPrice(e),!1}return!0}getGrandTotal(){let t=Number(this.saleForm.get("packagingAndForwadingCharges")?.value||0);return this.getTotalFinalPrice()+t}transformProductsWithDisplayName(t){return t.map(e=>Rt(it({},e),{displayName:e.materialName?`${e.name} (${e.materialName})`:e.name}))}loadProducts(){this.isLoadingProducts=!0,this.productService.getProducts({status:"A"}).pipe(x(this.destroy$)).subscribe({next:t=>{t.success&&(this.products=this.transformProductsWithDisplayName(t.data),this.buildProductMap()),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}})}buildProductMap(){this.productMap.clear();for(let t of this.products)this.productMap.set(t.id,t)}refreshProducts(){this.isLoadingProducts=!0,this.productService.refreshProducts().pipe(x(this.destroy$)).subscribe({next:t=>{t.success&&(this.products=this.transformProductsWithDisplayName(t.data),this.buildProductMap(),this.snackbar.success("Products refreshed successfully")),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to refresh products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}})}loadCustomers(){this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(x(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}refreshCustomers(){this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(x(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data),this.snackbar.success("Customers refreshed successfully"),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}isFieldInvalid(t){let e=this.saleForm.get(t);return e?e.invalid&&e.touched:!1}isProductFieldInvalid(t,e){let n=this.productsFormArray.at(t).get(e);if(!n)return!1;if(n.invalid&&(n.dirty||n.touched)){let l=n.errors;if(l&&(l.required||l.min&&(e==="quantity"||e==="unitPrice"||e==="discountAmount")||l.max&&e==="discountPercentage"||l.min||l.max))return!0}if(e==="discountAmount"){let l=this.productsFormArray.at(t),u=Number(l.get("quantity")?.value||0),m=Number(l.get("unitPrice")?.value||0),f=u*m;if(Number(n.value||0)>f)return!0}return!1}resetForm(){this.isEdit=!1,this.saleForm.patchValue({id:null}),this.initForm()}onSubmit(){if(this.markFormGroupTouched(this.saleForm),this.saleForm.valid){this.loading=!0;let t=this.prepareFormData();(this.isEdit?this.saleService.updateSale(t):this.saleService.createSale(t)).pipe(x(this.destroy$)).subscribe({next:n=>{n?.success&&(this.snackbar.success(`Sale ${this.isEdit?"updated":"created"} successfully`),localStorage.removeItem("saleId"),this.router.navigate(["/sale"])),this.loading=!1,this.cdr.markForCheck()},error:n=>{this.snackbar.error(n?.error?.message||`Failed to ${this.isEdit?"update":"create"} sale`),this.loading=!1,this.cdr.markForCheck()}})}else{let t=document.querySelector(".is-invalid");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}prepareFormData(){let t=this.saleForm.value,e={saleDate:L(t.saleDate,"dd-MM-yyyy","en"),customerId:t.customerId,invoiceNumber:t.invoiceNumber,price:this.getTotalAmount(),discountAmount:this.getTotalDiscountAmount(),taxAmount:this.getTotalTaxAmount(),packagingAndForwadingCharges:Number(t.packagingAndForwadingCharges||0),totalAmount:this.getGrandTotal(),isBlack:!!t.isBlack,products:t.products.map((n,a)=>{let l=this.productsFormArray.at(a).get("id")?.value,u=this.productsFormArray.at(a).get("price")?.value||0,m=Number(this.productsFormArray.at(a).get("discountPercentage")?.value||0),f=Number(this.productsFormArray.at(a).get("discountAmount")?.value||0),O=Number(this.productsFormArray.at(a).get("discountPrice")?.value||u),E=this.productsFormArray.at(a).get("taxAmount")?.value||0,I={productId:n.productId,quantity:n.quantity,batchNumber:n.batchNumber,unitPrice:n.unitPrice,price:u,discountPercentage:m,discountAmount:f,taxPercentage:this.productsFormArray.at(a).get("taxPercentage")?.value,taxAmount:E,finalPrice:O+E,remarks:n.remarks};return this.isEdit&&l&&(I.id=l),I})};return this.isEdit&&t.id&&(e.id=t.id),e}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e instanceof pt||e instanceof Pt?this.markFormGroupTouched(e):(e.markAsTouched(),e.markAsDirty())})}calculateTotalAmount(){this.totalAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("price").value||0),0),this.totalDiscountAmount=this.productsFormArray.controls.reduce((e,n)=>e+Number(n.get("discountAmount")?.value||0),0),this.totalTaxAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("taxAmount").value||0),0);let t=Number(this.saleForm.get("packagingAndForwadingCharges")?.value||0);this.grandTotal=this.getTotalFinalPrice()+t,this.saleForm.patchValue({price:this.totalAmount,taxAmount:this.totalTaxAmount},{emitEvent:!1}),this.cdr.markForCheck()}noDoubleQuotesValidator(){return t=>t.value&&t.value.includes('"')?{doubleQuotes:!0}:null}getFormattedPrice(t){let e=this.productsFormArray.at(t).get("price")?.value;return e?e.toFixed(2):"0.00"}getFormattedTaxAmount(t){let e=this.productsFormArray.at(t).get("taxAmount")?.value;return e?e.toFixed(2):"0.00"}getFormattedDiscountAmount(t){let e=this.productsFormArray.at(t).get("discountAmount")?.value;return e?e.toFixed(2):"0.00"}getFormattedDiscountPrice(t){let e=this.productsFormArray.at(t).get("discountPrice")?.value,n=this.productsFormArray.at(t).get("price")?.value;return e?e.toFixed(2):n?n.toFixed(2):"0.00"}fetchSaleDetails(t){this.saleService.getSaleDetails(t).pipe(x(this.destroy$)).subscribe({next:e=>{e.id&&(this.isEdit=!0,this.populateForm(e)),this.cdr.markForCheck()},error:e=>{this.snackbar.error(e?.error?.message||"Failed to load sale details"),this.cdr.markForCheck()}})}populateForm(t){this.productSubscriptions.forEach(e=>{e&&!e.closed&&e.unsubscribe()}),this.productSubscriptions=[],this.saleForm.patchValue({customerId:t.customerId,id:t.id,saleDate:L(new Date(t.saleDate),"yyyy-MM-dd","en"),invoiceNumber:t.invoiceNumber,isBlack:t.isBlack,packagingAndForwadingCharges:t.packagingAndForwadingCharges||0}),this.productsFormArray.clear(),t.items.forEach(e=>{let n=this.createProductFormGroup(),a=this.setupProductCalculations(n);this.productSubscriptions.push(a);let l=e.discountPercentage||0,u=e.discountAmount||0,m=l>0?"percentage":u>0?"amount":"percentage";n.patchValue({id:e.id,productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,price:e.price||0,discountType:m,discountPercentage:l,discountAmount:u,discountPrice:e.discountPrice||(e.price||0)-(u||0),taxPercentage:e.taxPercentage||0,taxAmount:e.taxAmount||0,batchNumber:e.batchNumber||"",remarks:e.remarks||""},{emitEvent:!1}),this.productsFormArray.push(n)}),this.isEdit=!0}static{this.\u0275fac=function(e){return new(e||s)(P(K),P(xt),P(X),P(Z),P(J),P(zt),P(W),P(H),P(V))}}static{this.\u0275cmp=R({type:s,selectors:[["app-add-sale"]],decls:145,vars:46,consts:[[1,"add-sale-container"],["routerLink","/sale",1,"btn","btn-sm","btn-secondary","back-btn"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"form-title"],[1,"fas","fa-cart-plus"],[1,"sale-form",3,"ngSubmit","formGroup"],[1,"header-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],[1,"fas","fa-user"],[1,"required"],[1,"select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","placeholder","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",3,"click","disabled"],[1,"fas",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","saleDate"],[1,"fas","fa-calendar"],["type","date","id","saleDate","formControlName","saleDate",1,"form-control",3,"touchstart"],["for","invoiceNumber"],[1,"fas","fa-file-invoice"],["type","text","id","invoiceNumber","formControlName","invoiceNumber","readonly","",1,"form-control"],[1,"form-label"],[1,"d-flex","gap-3"],[1,"form-check"],["type","radio","formControlName","isBlack","id","isBlackTrue",1,"form-check-input",3,"value"],["for","isBlackTrue",1,"form-check-label"],["type","radio","formControlName","isBlack","id","isBlackFalse",1,"form-check-input",3,"value"],["for","isBlackFalse",1,"form-check-label"],["for","packagingAndForwadingCharges"],[1,"fas","fa-box"],[1,"input-group"],[1,"input-group-text"],["type","number","id","packagingAndForwadingCharges","formControlName","packagingAndForwadingCharges","min","0","step","0.01","placeholder","Enter packaging and forwarding charges",1,"form-control"],["formArrayName","products",1,"products-section"],[1,"products-header"],[1,"fas","fa-boxes"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","touchstart"],[1,"fas","fa-plus"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"sale-summary"],[1,"summary-item"],["class","summary-item",4,"ngIf"],[1,"summary-item","total"],[1,"form-actions"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","touchstart","disabled"],[1,"fas","fa-undo"],["type","submit",1,"btn","btn-sm","btn-primary",3,"touchstart","disabled"],[3,"show"],[1,"invalid-feedback"],[3,"formGroupName"],[1,"form-field-container"],["formControlName","productId","labelKey","displayName","valueKey","id",3,"focusWidthPx","options","placeholder","searchPlaceholder"],["type","button","title","Refresh Products",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],["type","number","formControlName","quantity","placeholder","Qty","min","1",1,"form-control"],["type","text","formControlName","batchNumber","placeholder","Batch Number",1,"form-control"],["type","number","formControlName","unitPrice","placeholder","Price","min","0.01","step","0.01",1,"form-control"],["type","number","formControlName","price","readonly","","title","Subtotal (before discount)",1,"form-control",3,"value"],[1,"discount-type-selector"],[1,"form-check","form-check-inline"],["type","radio","formControlName","discountType",1,"form-check-input",3,"change","value","id"],[1,"form-check-label",3,"for"],["class","input-group",4,"ngIf"],["type","number","formControlName","discountPrice","readonly","","title","Price after discount",1,"form-control","discount-price-display",3,"value"],["type","number","formControlName","taxAmount","readonly","","title","Tax calculated on discounted price",1,"form-control",3,"value"],["type","text","formControlName","remarks","placeholder","Remarks",1,"form-control"],["type","button","title","Remove Product",1,"btn","btn-sm","btn-danger",3,"click","touchstart","disabled"],[1,"fas","fa-trash"],["type","number","formControlName","discountPercentage","placeholder","0.00","min","0","max","100","step","0.01",1,"form-control"],["type","number","formControlName","discountPercentage","readonly","","value","0",1,"form-control",2,"display","none"],[1,"form-control",2,"background-color","#f8f9fa","color","#6c757d"],["type","number","formControlName","discountAmount","placeholder","0.00","min","0","step","0.01",1,"form-control"],["type","number","formControlName","discountAmount","readonly","","title","Calculated discount amount",1,"form-control","discount-amount-display",3,"value"],[1,"discount-amount"]],template:function(e,n){if(e&1&&(o(0,"div",0)(1,"button",1),p(2,"i",2),i(3," Back to Sales "),r(),o(4,"div",3)(5,"div",4)(6,"h2",5),p(7,"i",6),i(8," Add New Sale "),r()(),o(9,"form",7),h("ngSubmit",function(){return n.onSubmit()}),o(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),p(14,"i",12),i(15," Select Customer "),o(16,"span",13),i(17,"*"),r()(),o(18,"div",14),p(19,"app-searchable-select",15),o(20,"button",16),h("click",function(){return n.refreshCustomers()}),p(21,"i",17),r()(),v(22,se,2,0,"div",18),r(),o(23,"div",10)(24,"label",19),p(25,"i",20),i(26," Sale Date "),o(27,"span",13),i(28,"*"),r()(),o(29,"input",21),h("touchstart",function(l){return l.stopPropagation()}),r(),v(30,le,2,0,"div",18),r(),o(31,"div",10)(32,"label",22),p(33,"i",23),i(34," Invoice Number "),r(),p(35,"input",24),r(),o(36,"div",10)(37,"label",25),i(38,"Is Black"),r(),o(39,"div",26)(40,"div",27),p(41,"input",28),o(42,"label",29),i(43,"Yes"),r()(),o(44,"div",27),p(45,"input",30),o(46,"label",31),i(47,"No"),r()()()(),o(48,"div",10)(49,"label",32),p(50,"i",33),i(51," Packaging & Forwarding Charges "),o(52,"span",13),i(53,"*"),r()(),o(54,"div",34)(55,"span",35),i(56,"\u20B9"),r(),p(57,"input",36),r(),v(58,de,2,0,"div",18),r()()(),o(59,"div",37)(60,"div",38)(61,"h3"),p(62,"i",39),i(63," Products"),r(),o(64,"button",40),h("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),p(65,"i",41),i(66," Add Product "),r()(),o(67,"div",42)(68,"table",43)(69,"thead")(70,"tr")(71,"th"),i(72,"Product Name"),r(),o(73,"th"),i(74,"Quantity"),r(),o(75,"th"),i(76,"Batch Number"),r(),o(77,"th"),i(78,"Sale Rate"),r(),o(79,"th"),i(80,"Subtotal"),r(),o(81,"th"),i(82,"Discount Type"),r(),o(83,"th"),i(84,"Discount %"),r(),o(85,"th"),i(86,"Discount Amount"),r(),o(87,"th"),i(88,"After Discount"),r(),o(89,"th"),i(90,"Tax Amount"),r(),o(91,"th"),i(92,"Remarks"),r(),o(93,"th"),i(94,"Actions"),r()()(),o(95,"tbody"),v(96,ve,59,35,"tr",44),r()()()(),o(97,"button",40),h("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),p(98,"i",41),i(99," Add Product "),r(),o(100,"div",45)(101,"div",46)(102,"span"),i(103,"Total Products:"),r(),o(104,"strong"),i(105),r()(),o(106,"div",46)(107,"span"),i(108,"Subtotal:"),r(),o(109,"strong"),i(110),S(111,"number"),r()(),v(112,xe,6,4,"div",47),o(113,"div",46)(114,"span"),i(115,"Tax Amount:"),r(),o(116,"strong"),i(117),S(118,"number"),r()(),o(119,"div",46)(120,"span"),i(121,"Total After Discount & Tax:"),r(),o(122,"strong"),i(123),S(124,"number"),r()(),o(125,"div",46)(126,"span"),i(127,"Packaging & Forwarding Charges:"),r(),o(128,"strong"),i(129),S(130,"number"),r()(),o(131,"div",48)(132,"span"),i(133,"Grand Total:"),r(),o(134,"strong"),i(135),S(136,"number"),r()()(),o(137,"div",49)(138,"button",50),h("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),p(139,"i",51),i(140," Reset "),r(),o(141,"button",52),h("touchstart",function(l){return l.stopPropagation()}),p(142,"i",17),i(143),r()()()()(),p(144,"app-loader",53)),e&2){let a;c(9),d("formGroup",n.saleForm),c(10),y("is-invalid",n.isFieldInvalid("customerId")),d("options",n.customers)("placeholder","Select Customer")("searchPlaceholder","Search customers..."),c(),d("disabled",n.isLoadingCustomers),c(),d("ngClass",n.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt"),c(),d("ngIf",n.isFieldInvalid("customerId")),c(7),y("is-invalid",n.isFieldInvalid("saleDate")),c(),d("ngIf",n.isFieldInvalid("saleDate")),c(11),d("value",!0),c(4),d("value",!1),c(12),y("is-invalid",n.isFieldInvalid("packagingAndForwadingCharges")),c(),d("ngIf",n.isFieldInvalid("packagingAndForwadingCharges")),c(38),d("ngForOf",n.productsFormArray.controls)("ngForTrackBy",n.trackByProductIndex),c(9),A(n.productsFormArray.length),c(5),w("\u20B9",k(111,31,n.totalAmount,"1.2-2"),""),c(2),d("ngIf",n.totalDiscountAmount>0),c(5),w("\u20B9",k(118,34,n.totalTaxAmount,"1.2-2"),""),c(6),w("\u20B9",k(124,37,n.getTotalFinalPrice(),"1.2-2"),""),c(6),w("\u20B9",k(130,40,((a=n.saleForm.get("packagingAndForwadingCharges"))==null?null:a.value)||0,"1.2-2"),""),c(6),w("\u20B9",k(136,43,n.grandTotal,"1.2-2"),""),c(3),d("disabled",n.loading),c(3),d("disabled",n.saleForm.invalid||n.loading),c(),d("ngClass",n.loading?"fa-spinner fa-spin":"fa-save"),c(),w(" ",n.loading?"Saving...":n.isEdit?"Update Sale":"Save Sale"," "),c(),d("show",n.loading)}},dependencies:[z,j,B,Y,$,gt,ht,q,G,Ct,bt,U,Q,_t,ft,et,T,D,mt],styles:[".add-sale-container[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}@media (max-width: 768px){.add-sale-container[_ngcontent-%COMP%]{padding:1rem}}.form-control[_ngcontent-%COMP%]{height:40px}@media (max-width: 768px){.form-control[_ngcontent-%COMP%]{font-size:16px;min-height:44px}}.back-btn[_ngcontent-%COMP%]{margin-bottom:1rem;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.select-group[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:.5rem;width:100%;overflow:visible}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{display:block;flex:1;position:relative;z-index:100;overflow:visible}.select-group[_ngcontent-%COMP%]   app-searchable-select.custom-width[_ngcontent-%COMP%]{position:absolute;z-index:1000;left:0}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within{z-index:1000;position:relative}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]{flex-shrink:0;margin-top:0;height:40px;min-width:40px;display:flex;align-items:center;justify-content:center;position:relative;z-index:1;border:1px solid var(--supporting);border-radius:8px;background:#fff;transition:all .3s ease;color:var(--primary);touch-action:manipulation;-webkit-tap-highlight-color:transparent}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary);color:#fff}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{color:#fff;margin:0;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.sale-form[_ngcontent-%COMP%]{padding:2rem}@media (max-width: 768px){.sale-form[_ngcontent-%COMP%]{padding:1rem}}.header-section[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-bottom:2rem}.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.products-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;border:1px solid var(--primary)}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary);font-size:1.25rem;display:flex;align-items:center;gap:.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;color:var(--text-primary);font-weight:500}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:var(--danger);margin-left:4px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:stretch}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background-color:var(--background);border:1px solid var(--border-color);border-right:none;border-radius:var(--border-radius) 0 0 var(--border-radius);height:38px;color:var(--text-secondary);min-width:40px;display:flex;align-items:center;justify-content:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:0 var(--border-radius) var(--border-radius) 0;flex:1}.sale-summary[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;display:flex;justify-content:flex-end;gap:2rem;flex-wrap:wrap}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;font-weight:600}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong.discount-amount[_ngcontent-%COMP%]{color:#28a745}.sale-summary[_ngcontent-%COMP%]   .summary-item.total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary)}@media (max-width: 768px){.sale-summary[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-end;gap:1rem}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.table-responsive[_ngcontent-%COMP%]{margin:0 -1.5rem;padding:0 1.5rem;overflow-x:auto;min-height:400px;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{margin:0 -1rem;padding:0 1rem}}.products-table[_ngcontent-%COMP%]{width:100%;margin-bottom:0;background:#fff;border-collapse:separate;border-spacing:0}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:var(--text-primary);font-weight:600;padding:1rem;white-space:nowrap;border-bottom:2px solid var(--border-color);font-size:.875rem}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:20%;min-width:250px}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(4){width:8%;max-width:100px}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(6), .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(7), .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(8), .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(9){width:8%;min-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{min-width:80px;font-size:.875rem}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{width:20%;min-width:250px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child   .form-control[_ngcontent-%COMP%]{min-width:250px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:8%;max-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4)   .form-control[_ngcontent-%COMP%]{min-width:80px;max-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(6), .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(7), .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8), .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(9){width:8%;min-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(6)   .form-control[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(7)   .form-control[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8)   .form-control[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(9)   .form-control[_ngcontent-%COMP%]{min-width:90px}.products-table[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{flex-wrap:nowrap}.products-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{margin:0 auto}@media (max-width: 768px){.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}}.form-field-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem;overflow:visible}.form-field-container[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%], .form-field-container[_ngcontent-%COMP%]   .input-group.is-invalid[_ngcontent-%COMP%]{border-color:var(--danger);background-image:url(data:image/svg+xml,...)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-bottom:1.5rem;vertical-align:top}.invalid-feedback[_ngcontent-%COMP%]{color:var(--danger);font-size:.75rem;margin-top:.25rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}.discount-type-selector[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.discount-type-selector[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;gap:.25rem}.discount-type-selector[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin:0;cursor:pointer}.discount-type-selector[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{margin:0;cursor:pointer;font-size:.875rem;-webkit-user-select:none;user-select:none}.discount-amount-display[_ngcontent-%COMP%]{color:#28a745;font-weight:500}.discount-price-display[_ngcontent-%COMP%]{color:var(--text-primary);font-weight:500}.discount-amount[_ngcontent-%COMP%]{color:#28a745}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}@media (hover: none) and (pointer: coarse){.btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.form-control[_ngcontent-%COMP%]{min-height:44px;font-size:16px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.8rem}.products-table[_ngcontent-%COMP%]   .discount-type-selector[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{font-size:.75rem}}form[_ngcontent-%COMP%]{touch-action:manipulation}@media (max-width: 768px){app-searchable-select[_ngcontent-%COMP%]{position:relative;z-index:1000}}"],changeDetection:0})}}return s})();function Me(s,_){s&1&&(o(0,"div",47),i(1," Customer is required "),r())}function Oe(s,_){s&1&&(o(0,"div",47),i(1," Sale return date is required "),r())}function ye(s,_){s&1&&(o(0,"div",47),i(1," Packaging and forwarding charges is required and must be 0 or greater "),r())}function Se(s,_){s&1&&(o(0,"div",47),i(1," Please select a product "),r())}function ke(s,_){s&1&&(o(0,"div",47),i(1," Quantity must be 1 or greater "),r())}function we(s,_){s&1&&(o(0,"div",47),i(1," Double quotes are not allowed "),r())}function Fe(s,_){s&1&&(o(0,"div",47),i(1," Unit price must be greater than 0 "),r())}function Ae(s,_){if(s&1&&(o(0,"div",27)(1,"span",28),i(2,"%"),r(),p(3,"input",67),r()),s&2){let t=g().index,e=g();c(3),y("is-invalid",e.isProductFieldInvalid(t,"discountPercentage"))}}function Ee(s,_){s&1&&(o(0,"div",27),p(1,"input",68),o(2,"span",69),i(3,"-"),r()())}function Ie(s,_){s&1&&(o(0,"div",47),i(1," Discount percentage must be between 0 and 100 "),r())}function Te(s,_){if(s&1&&(o(0,"div",27)(1,"span",28),i(2,"\u20B9"),r(),p(3,"input",70),r()),s&2){let t=g().index,e=g();c(3),y("is-invalid",e.isProductFieldInvalid(t,"discountAmount"))}}function De(s,_){if(s&1&&(o(0,"div",27)(1,"span",28),i(2,"\u20B9"),r(),p(3,"input",71),r()),s&2){let t=g().index,e=g();c(3),d("value",e.getFormattedDiscountAmount(t))}}function Ne(s,_){s&1&&(o(0,"div",47),i(1," Discount amount cannot exceed subtotal "),r())}function Re(s,_){if(s&1){let t=F();o(0,"tr",48)(1,"td")(2,"div",49)(3,"div",50),p(4,"app-searchable-select",51),o(5,"button",52),h("click",function(){b(t);let n=g();return C(n.refreshProducts())})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(6,"i",17),r()(),v(7,Se,2,0,"div",18),r()(),o(8,"td")(9,"div",49),p(10,"input",53),v(11,ke,2,0,"div",18),r()(),o(12,"td")(13,"div",49),p(14,"input",54),v(15,we,2,0,"div",18),r()(),o(16,"td")(17,"div",49)(18,"div",27)(19,"span",28),i(20,"\u20B9"),r(),p(21,"input",55),r(),v(22,Fe,2,0,"div",18),r()(),o(23,"td")(24,"div",27),p(25,"input",56),r()(),o(26,"td")(27,"div",49)(28,"div",57)(29,"div",58)(30,"input",59),h("change",function(){let n=b(t).index,a=g();return C(a.onDiscountTypeChange(n))}),r(),o(31,"label",60),i(32,"%"),r()(),o(33,"div",58)(34,"input",59),h("change",function(){let n=b(t).index,a=g();return C(a.onDiscountTypeChange(n))}),r(),o(35,"label",60),i(36,"\u20B9"),r()()()()(),o(37,"td")(38,"div",49),v(39,Ae,4,2,"div",61)(40,Ee,4,0,"div",61)(41,Ie,2,0,"div",18),r()(),o(42,"td")(43,"div",49),v(44,Te,4,2,"div",61)(45,De,4,1,"div",61)(46,Ne,2,0,"div",18),r()(),o(47,"td")(48,"div",27),p(49,"input",62),r()(),o(50,"td")(51,"div",27),p(52,"input",63),r()(),o(53,"td")(54,"div",49),p(55,"input",64),r()(),o(56,"td")(57,"button",65),h("click",function(){let n=b(t).index,a=g();return C(a.removeProduct(n))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(58,"i",66),r()()()}if(s&2){let t,e,n,a,l,u=_.index,m=g();d("formGroupName",u),c(4),y("is-invalid",m.isProductFieldInvalid(u,"productId")),d("focusWidthPx",600)("options",m.products)("placeholder","Select Product")("searchPlaceholder","Search products..."),c(),d("disabled",m.isLoadingProducts),c(),d("ngClass",m.isLoadingProducts?"fa-spinner fa-spin":"fa-sync-alt"),c(),d("ngIf",m.isProductFieldInvalid(u,"productId")),c(3),y("is-invalid",m.isProductFieldInvalid(u,"quantity")),c(),d("ngIf",m.isProductFieldInvalid(u,"quantity")),c(3),y("is-invalid",m.isProductFieldInvalid(u,"batchNumber")),c(),d("ngIf",(t=m.productsFormArray.at(u).get("batchNumber"))==null||t.errors==null?null:t.errors.doubleQuotes),c(6),y("is-invalid",m.isProductFieldInvalid(u,"unitPrice")),c(),d("ngIf",m.isProductFieldInvalid(u,"unitPrice")),c(3),d("value",m.getFormattedPrice(u)),c(5),d("value","percentage")("id","discountTypePercentage"+u),c(),d("for","discountTypePercentage"+u),c(3),d("value","amount")("id","discountTypeAmount"+u),c(),d("for","discountTypeAmount"+u),c(4),d("ngIf",((e=m.productsFormArray.at(u).get("discountType"))==null?null:e.value)==="percentage"),c(),d("ngIf",((n=m.productsFormArray.at(u).get("discountType"))==null?null:n.value)!=="percentage"),c(),d("ngIf",m.isProductFieldInvalid(u,"discountPercentage")),c(3),d("ngIf",((a=m.productsFormArray.at(u).get("discountType"))==null?null:a.value)==="amount"),c(),d("ngIf",((l=m.productsFormArray.at(u).get("discountType"))==null?null:l.value)!=="amount"),c(),d("ngIf",m.isProductFieldInvalid(u,"discountAmount")),c(3),d("value",m.getFormattedDiscountPrice(u)),c(3),d("value",m.getFormattedTaxAmount(u)),c(5),d("disabled",m.productsFormArray.length===1)}}function Ve(s,_){if(s&1&&(o(0,"div",39)(1,"span"),i(2,"Total Discount:"),r(),o(3,"strong",72),i(4),S(5,"number"),r()()),s&2){let t=g();c(4),w("-\u20B9",k(5,1,t.totalDiscountAmount,"1.2-2"),"")}}var Nt=(()=>{class s{get productsFormArray(){return this.returnForm.get("products")}trackByProductIndex(t,e){return e}constructor(t,e,n,a,l,u,m,f,O){this.fb=t,this.router=e,this.route=n,this.saleService=a,this.productService=l,this.customerService=u,this.snackbar=m,this.encryptionService=f,this.cdr=O,this.products=[],this.customers=[],this.loading=!1,this.isLoadingProducts=!1,this.isLoadingCustomers=!1,this.isEdit=!1,this.saleReturnId=null,this.destroy$=new N,this.productSubscriptions=[],this.productMap=new Map,this.totalAmount=0,this.totalDiscountAmount=0,this.totalTaxAmount=0,this.grandTotal=0,this.initForm()}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(t){let e=this.encryptionService.decrypt(t);if(e){let n=Number(e);isNaN(n)||(this.saleReturnId=n,this.isEdit=!0)}}this.loadCustomers(),this.isLoadingProducts=!0,this.productService.getProducts({status:"A"}).pipe(x(this.destroy$)).subscribe({next:e=>{e?.success&&e.data&&(this.products=e.data.content||e.data,this.buildProductMap(),this.isEdit&&this.saleReturnId&&this.fetchSaleReturnDetails(this.saleReturnId)),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}}),this.returnForm.get("packagingAndForwadingCharges")?.valueChanges.pipe(x(this.destroy$),tt(150)).subscribe(()=>{this.calculateTotalAmount(),this.cdr.markForCheck()})}ngOnDestroy(){this.productSubscriptions.forEach(t=>{t&&!t.closed&&t.unsubscribe()}),this.productSubscriptions=[],this.destroy$.next(),this.destroy$.complete(),this.products=[],this.customers=[],this.productMap.clear(),this.returnForm&&this.returnForm.reset()}initForm(){this.returnForm=this.fb.group({id:[null],customerId:["",M.required],saleReturnDate:[L(new Date,"yyyy-MM-dd","en"),M.required],invoiceNumber:[""],products:this.fb.array([]),packagingAndForwadingCharges:[0,[M.required,M.min(0)]]}),this.isEdit||this.addProduct()}createProductFormGroup(){return this.fb.group({id:[null],productId:["",M.required],quantity:["",[M.required,M.min(1)]],batchNumber:["",[this.noDoubleQuotesValidator()]],unitPrice:["",[M.required,M.min(.01)]],price:[{value:0,disabled:!0}],discountType:["percentage"],discountPercentage:[0,[M.min(0),M.max(100)]],discountAmount:[0,[M.min(0)]],discountPrice:[{value:0,disabled:!0}],taxPercentage:[{value:0,disabled:!0}],taxAmount:[{value:0,disabled:!0}],remarks:[null,[]]})}addProduct(){let t=this.createProductFormGroup(),e=this.setupProductCalculations(t);this.productSubscriptions.push(e),this.productsFormArray.push(t)}removeProduct(t){this.productsFormArray.length!==1&&(this.productSubscriptions[t]&&(this.productSubscriptions[t].unsubscribe(),this.productSubscriptions.splice(t,1)),this.productsFormArray.removeAt(t),this.calculateTotalAmount())}setupProductCalculations(t){let e=new at,n=t.get("productId")?.valueChanges.pipe(x(this.destroy$),ct()).subscribe(l=>{if(l){let u=this.productMap.get(l);if(u){let m=u.taxPercentage||0;t.patchValue({taxPercentage:m},{emitEvent:!1}),this.calculateProductPrice(t)}}});n&&e.add(n);let a=t.valueChanges.pipe(x(this.destroy$),tt(150)).subscribe(()=>{this.calculateProductPrice(t)});return e.add(a),e}calculateProductPrice(t){if(!t)return;let e=Number(t.get("quantity")?.value||0),n=Number(t.get("unitPrice")?.value||0),a=Number(t.get("taxPercentage")?.value||0),l=t.get("discountType")?.value||"percentage",u=Number(t.get("discountPercentage")?.value||0),m=Number(t.get("discountAmount")?.value||0),f=Number((e*n).toFixed(2)),O=0;if(l==="percentage"&&u>0){let Ot=Math.min(u,100);O=Number((f*(Ot/100)).toFixed(2)),u>100&&t.patchValue({discountPercentage:100},{emitEvent:!1})}else l==="amount"&&m>0&&(O=Math.min(m,f),m>f&&t.patchValue({discountAmount:f},{emitEvent:!1}));let E=Number((f-O).toFixed(2)),I=Number((E*a/100).toFixed(2)),Wt=Number((E+I).toFixed(2));t.patchValue({price:f,discountAmount:O,discountPrice:E,taxAmount:I},{emitEvent:!1}),this.calculateTotalAmount(),this.cdr.markForCheck()}getTotalAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("price").value||0),0)}getTotalTaxAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("taxAmount").value||0),0)}getTotalFinalPrice(){return this.productsFormArray.controls.reduce((t,e)=>{let n=Number(e.get("discountPrice")?.value||e.get("price")?.value||0),a=Number(e.get("taxAmount")?.value||0);return t+(n+a)},0)}getGrandTotal(){let t=Number(this.returnForm.get("packagingAndForwadingCharges")?.value||0);return this.getTotalFinalPrice()+t}getTotalDiscountAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+Number(e.get("discountAmount")?.value||0),0)}onDiscountTypeChange(t){let e=this.productsFormArray.at(t);e.get("discountType")?.value==="percentage"?e.patchValue({discountAmount:0},{emitEvent:!1}):e.patchValue({discountPercentage:0},{emitEvent:!1}),this.calculateProductPrice(e)}validateDiscount(t){let e=this.productsFormArray.at(t),n=Number(e.get("quantity")?.value||0),a=Number(e.get("unitPrice")?.value||0),l=n*a,u=e.get("discountType")?.value,m=Number(e.get("discountPercentage")?.value||0),f=Number(e.get("discountAmount")?.value||0);if(u==="percentage"){if(m<0||m>100)return!1}else if(u==="amount"){if(f<0)return!1;if(f>l)return e.patchValue({discountAmount:l},{emitEvent:!1}),this.calculateProductPrice(e),!1}return!0}getFormattedDiscountAmount(t){let e=this.productsFormArray.at(t).get("discountAmount")?.value;return e?e.toFixed(2):"0.00"}getFormattedDiscountPrice(t){let e=this.productsFormArray.at(t).get("discountPrice")?.value,n=this.productsFormArray.at(t).get("price")?.value;return e?e.toFixed(2):n?n.toFixed(2):"0.00"}buildProductMap(){this.productMap.clear();for(let t of this.products)this.productMap.set(t.id,t)}refreshProducts(){this.isLoadingProducts=!0,this.productService.refreshProducts().pipe(x(this.destroy$)).subscribe({next:t=>{t?.success&&(this.products=t.data,this.buildProductMap(),this.snackbar.success("Products refreshed successfully")),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to refresh products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}})}loadCustomers(){this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(x(this.destroy$)).subscribe({next:t=>{t?.success&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}refreshCustomers(){this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(x(this.destroy$)).subscribe({next:t=>{t?.success&&(this.customers=t.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}isFieldInvalid(t){let e=this.returnForm.get(t);return e?e.invalid&&e.touched:!1}isProductFieldInvalid(t,e){let n=this.productsFormArray.at(t).get(e);if(!n)return!1;if(n.invalid&&(n.dirty||n.touched)){let l=n.errors;if(l&&(l.required||l.min&&(e==="quantity"||e==="unitPrice"||e==="discountAmount")||l.max&&e==="discountPercentage"||l.min||l.max))return!0}if(e==="discountAmount"){let l=this.productsFormArray.at(t),u=Number(l.get("quantity")?.value||0),m=Number(l.get("unitPrice")?.value||0),f=u*m;if(Number(n.value||0)>f)return!0}return!1}resetForm(){this.initForm()}onSubmit(){if(this.markFormGroupTouched(this.returnForm),this.returnForm.valid){this.loading=!0;let t=this.prepareFormData();(this.isEdit?this.saleService.createSaleReturn(t):this.saleService.createSaleReturn(t)).pipe(x(this.destroy$)).subscribe({next:n=>{n?.success?(this.snackbar.success(n.message||`Sale return ${this.isEdit?"updated":"created"} successfully`),this.router.navigate(["/sale/return"])):this.snackbar.error(n?.message||`Failed to ${this.isEdit?"update":"create"} sale return`),this.loading=!1,this.cdr.markForCheck()},error:n=>{let a=n?.error?.message||`Failed to ${this.isEdit?"update":"create"} sale return`;this.snackbar.error(a),this.loading=!1,this.cdr.markForCheck()}})}else{let t=document.querySelector(".is-invalid");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}prepareFormData(){let t=this.returnForm.value,e={saleReturnDate:L(t.saleReturnDate,"dd-MM-yyyy","en"),customerId:t.customerId,invoiceNumber:t.invoiceNumber,price:this.getTotalAmount(),discountAmount:this.getTotalDiscountAmount(),taxAmount:this.getTotalTaxAmount(),packagingAndForwadingCharges:Number(t.packagingAndForwadingCharges||0),totalAmount:this.getGrandTotal(),products:t.products.map((n,a)=>{let l=this.productsFormArray.at(a).get("id")?.value,u=this.productsFormArray.at(a).get("price")?.value||0,m=Number(this.productsFormArray.at(a).get("discountPercentage")?.value||0),f=Number(this.productsFormArray.at(a).get("discountAmount")?.value||0),O=Number(this.productsFormArray.at(a).get("discountPrice")?.value||u),E=this.productsFormArray.at(a).get("taxAmount")?.value||0,I={productId:n.productId,quantity:n.quantity,batchNumber:n.batchNumber,unitPrice:n.unitPrice,price:u,discountPercentage:m,discountAmount:f,taxPercentage:this.productsFormArray.at(a).get("taxPercentage")?.value,taxAmount:E,finalPrice:O+E,remarks:n.remarks};return this.isEdit&&l&&(I.id=l),I})};return this.isEdit&&t.id&&(e.id=t.id),e}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e instanceof pt||e instanceof Pt?this.markFormGroupTouched(e):(e.markAsTouched(),e.markAsDirty())})}calculateTotalAmount(){this.totalAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("price").value||0),0),this.totalDiscountAmount=this.productsFormArray.controls.reduce((e,n)=>e+Number(n.get("discountAmount")?.value||0),0),this.totalTaxAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("taxAmount").value||0),0);let t=Number(this.returnForm.get("packagingAndForwadingCharges")?.value||0);this.grandTotal=this.getTotalFinalPrice()+t,this.returnForm.patchValue({price:this.totalAmount,taxAmount:this.totalTaxAmount},{emitEvent:!1}),this.cdr.markForCheck()}noDoubleQuotesValidator(){return t=>t.value&&t.value.includes('"')?{doubleQuotes:!0}:null}getFormattedPrice(t){let e=this.productsFormArray.at(t).get("price")?.value;return e?e.toFixed(2):"0.00"}getFormattedTaxAmount(t){let e=this.productsFormArray.at(t).get("taxAmount")?.value;return e?e.toFixed(2):"0.00"}fetchSaleReturnDetails(t){this.loading=!0,this.saleService.getSaleReturnDetail(t).pipe(x(this.destroy$)).subscribe({next:e=>{e&&e.id?this.populateForm(e):this.snackbar.error("Failed to load sale return details"),this.loading=!1,this.cdr.markForCheck()},error:e=>{this.snackbar.error(e?.error?.message||"Failed to load sale return details"),this.loading=!1,this.cdr.markForCheck()}})}populateForm(t){this.productsFormArray.clear(),this.productSubscriptions.forEach(e=>e?.unsubscribe()),this.productSubscriptions=[],this.returnForm.patchValue({id:t.id,customerId:t.customerId,saleReturnDate:L(new Date(t.saleReturnDate),"yyyy-MM-dd","en"),invoiceNumber:t.invoiceNumber,packagingAndForwadingCharges:t.packagingAndForwadingCharges||0}),t.items&&t.items.length>0?t.items.forEach(e=>{let n=this.createProductFormGroup(),a=this.setupProductCalculations(n);this.productSubscriptions.push(a);let l=e.discountPercentage||0,u=e.discountAmount||0,m=l>0?"percentage":u>0?"amount":"percentage";n.patchValue({id:e.id,productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,price:e.price||0,discountType:m,discountPercentage:l,discountAmount:u,discountPrice:e.discountPrice||(e.price||0)-(u||0),taxPercentage:e.taxPercentage||0,taxAmount:e.taxAmount||0,batchNumber:e.batchNumber||"",remarks:e.remarks||""},{emitEvent:!1}),this.productsFormArray.push(n)}):this.addProduct()}static{this.\u0275fac=function(e){return new(e||s)(P(K),P(W),P($t),P(Z),P(xt),P(X),P(J),P(H),P(V))}}static{this.\u0275cmp=R({type:s,selectors:[["app-add-sale-return"]],decls:133,vars:45,consts:[[1,"add-sale-container"],["routerLink","/sale/return",1,"btn","btn-sm","btn-secondary","back-btn",3,"touchstart"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"form-title"],[1,"fas","fa-undo-alt"],[1,"sale-form",3,"ngSubmit","formGroup"],[1,"header-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],[1,"fas","fa-user"],[1,"required"],[1,"select-group","inline"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","placeholder","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],[1,"fas",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","saleReturnDate"],[1,"fas","fa-calendar"],["type","date","id","saleReturnDate","formControlName","saleReturnDate",1,"form-control",3,"touchstart"],["for","invoiceNumber"],[1,"fas","fa-file-invoice"],["type","text","id","invoiceNumber","formControlName","invoiceNumber","readonly","",1,"form-control"],["for","packagingAndForwadingCharges"],[1,"fas","fa-box"],[1,"input-group"],[1,"input-group-text"],["type","number","id","packagingAndForwadingCharges","formControlName","packagingAndForwadingCharges","min","0","step","0.01","placeholder","Enter packaging and forwarding charges",1,"form-control"],["formArrayName","products",1,"products-section"],[1,"products-header"],[1,"fas","fa-boxes"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","touchstart"],[1,"fas","fa-plus"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"sale-summary"],[1,"summary-item"],["class","summary-item",4,"ngIf"],[1,"summary-item","total"],[1,"form-actions"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","touchstart","disabled"],[1,"fas","fa-undo"],["type","submit",1,"btn","btn-sm","btn-primary",3,"touchstart","disabled"],[3,"show"],[1,"invalid-feedback"],[3,"formGroupName"],[1,"form-field-container"],[1,"select-group"],["formControlName","productId","labelKey","name","valueKey","id",3,"focusWidthPx","options","placeholder","searchPlaceholder"],["type","button","title","Refresh Products",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],["type","number","formControlName","quantity","placeholder","Qty","min","1",1,"form-control"],["type","text","formControlName","batchNumber","placeholder","Batch Number",1,"form-control"],["type","number","formControlName","unitPrice","placeholder","Price","min","0.01","step","0.01",1,"form-control"],["type","number","formControlName","price","readonly","","title","Subtotal (before discount)",1,"form-control",3,"value"],[1,"discount-type-selector"],[1,"form-check","form-check-inline"],["type","radio","formControlName","discountType",1,"form-check-input",3,"change","value","id"],[1,"form-check-label",3,"for"],["class","input-group",4,"ngIf"],["type","number","formControlName","discountPrice","readonly","","title","Price after discount",1,"form-control","discount-price-display",3,"value"],["type","number","formControlName","taxAmount","readonly","","title","Tax calculated on discounted price",1,"form-control",3,"value"],["type","text","formControlName","remarks","placeholder","Remarks",1,"form-control"],["type","button","title","Remove Product",1,"btn","btn-sm","btn-danger",3,"click","touchstart","disabled"],[1,"fas","fa-trash"],["type","number","formControlName","discountPercentage","placeholder","0.00","min","0","max","100","step","0.01",1,"form-control"],["type","number","formControlName","discountPercentage","readonly","","value","0",1,"form-control",2,"display","none"],[1,"form-control",2,"background-color","#f8f9fa","color","#6c757d"],["type","number","formControlName","discountAmount","placeholder","0.00","min","0","step","0.01",1,"form-control"],["type","number","formControlName","discountAmount","readonly","","title","Calculated discount amount",1,"form-control","discount-amount-display",3,"value"],[1,"discount-amount"]],template:function(e,n){if(e&1&&(o(0,"div",0)(1,"button",1),h("touchstart",function(l){return l.stopPropagation()}),p(2,"i",2),i(3," Back to Sale Returns "),r(),o(4,"div",3)(5,"div",4)(6,"h2",5),p(7,"i",6),i(8),r()(),o(9,"form",7),h("ngSubmit",function(){return n.onSubmit()}),o(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),p(14,"i",12),i(15," Select Customer "),o(16,"span",13),i(17,"*"),r()(),o(18,"div",14),p(19,"app-searchable-select",15),o(20,"button",16),h("click",function(){return n.refreshCustomers()})("touchstart",function(l){return l.stopPropagation()}),p(21,"i",17),r()(),v(22,Me,2,0,"div",18),r(),o(23,"div",10)(24,"label",19),p(25,"i",20),i(26," Sale Return Date "),o(27,"span",13),i(28,"*"),r()(),o(29,"input",21),h("touchstart",function(l){return l.stopPropagation()}),r(),v(30,Oe,2,0,"div",18),r(),o(31,"div",10)(32,"label",22),p(33,"i",23),i(34," Return Invoice Number "),r(),p(35,"input",24),r(),o(36,"div",10)(37,"label",25),p(38,"i",26),i(39," Packaging & Forwarding Charges "),o(40,"span",13),i(41,"*"),r()(),o(42,"div",27)(43,"span",28),i(44,"\u20B9"),r(),p(45,"input",29),r(),v(46,ye,2,0,"div",18),r()()(),o(47,"div",30)(48,"div",31)(49,"h3"),p(50,"i",32),i(51," Products"),r(),o(52,"button",33),h("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),p(53,"i",34),i(54," Add Product "),r()(),o(55,"div",35)(56,"table",36)(57,"thead")(58,"tr")(59,"th"),i(60,"Product Name"),r(),o(61,"th"),i(62,"Quantity"),r(),o(63,"th"),i(64,"Batch Number"),r(),o(65,"th"),i(66,"Sale Rate"),r(),o(67,"th"),i(68,"Subtotal"),r(),o(69,"th"),i(70,"Discount Type"),r(),o(71,"th"),i(72,"Discount %"),r(),o(73,"th"),i(74,"Discount Amount"),r(),o(75,"th"),i(76,"After Discount"),r(),o(77,"th"),i(78,"Tax Amount"),r(),o(79,"th"),i(80,"Remarks"),r(),o(81,"th"),i(82,"Actions"),r()()(),o(83,"tbody"),v(84,Re,59,35,"tr",37),r()()()(),o(85,"button",33),h("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),p(86,"i",34),i(87," Add Product "),r(),o(88,"div",38)(89,"div",39)(90,"span"),i(91,"Total Products:"),r(),o(92,"strong"),i(93),r()(),o(94,"div",39)(95,"span"),i(96,"Subtotal:"),r(),o(97,"strong"),i(98),S(99,"number"),r()(),v(100,Ve,6,4,"div",40),o(101,"div",39)(102,"span"),i(103,"Tax Amount:"),r(),o(104,"strong"),i(105),S(106,"number"),r()(),o(107,"div",39)(108,"span"),i(109,"Total After Discount & Tax:"),r(),o(110,"strong"),i(111),S(112,"number"),r()(),o(113,"div",39)(114,"span"),i(115,"Packaging & Forwarding Charges:"),r(),o(116,"strong"),i(117),S(118,"number"),r()(),o(119,"div",41)(120,"span"),i(121,"Grand Total:"),r(),o(122,"strong"),i(123),S(124,"number"),r()()(),o(125,"div",42)(126,"button",43),h("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),p(127,"i",44),i(128," Reset "),r(),o(129,"button",45),h("touchstart",function(l){return l.stopPropagation()}),p(130,"i",17),i(131),r()()()()(),p(132,"app-loader",46)),e&2){let a;c(8),w(" ",n.isEdit?"Edit Sale Return":"Add New Sale Return"," "),c(),d("formGroup",n.returnForm),c(10),y("is-invalid",n.isFieldInvalid("customerId")),d("options",n.customers)("placeholder","Select Customer")("searchPlaceholder","Search customers..."),c(),d("disabled",n.isLoadingCustomers),c(),d("ngClass",n.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt"),c(),d("ngIf",n.isFieldInvalid("customerId")),c(7),y("is-invalid",n.isFieldInvalid("saleReturnDate")),c(),d("ngIf",n.isFieldInvalid("saleReturnDate")),c(15),y("is-invalid",n.isFieldInvalid("packagingAndForwadingCharges")),c(),d("ngIf",n.isFieldInvalid("packagingAndForwadingCharges")),c(38),d("ngForOf",n.productsFormArray.controls)("ngForTrackBy",n.trackByProductIndex),c(9),A(n.productsFormArray.length),c(5),w("\u20B9",k(99,30,n.totalAmount,"1.2-2"),""),c(2),d("ngIf",n.totalDiscountAmount>0),c(5),w("\u20B9",k(106,33,n.totalTaxAmount,"1.2-2"),""),c(6),w("\u20B9",k(112,36,n.getTotalFinalPrice(),"1.2-2"),""),c(6),w("\u20B9",k(118,39,((a=n.returnForm.get("packagingAndForwadingCharges"))==null?null:a.value)||0,"1.2-2"),""),c(6),w("\u20B9",k(124,42,n.grandTotal,"1.2-2"),""),c(3),d("disabled",n.loading),c(3),d("disabled",n.returnForm.invalid||n.loading),c(),d("ngClass",n.loading?"fa-spinner fa-spin":"fa-save"),c(),w(" ",n.loading?n.isEdit?"Updating...":"Saving...":n.isEdit?"Update Sale Return":"Save Sale Return"," "),c(),d("show",n.loading)}},dependencies:[z,j,B,Y,$,gt,ht,q,G,Ct,bt,U,Q,_t,ft,et,T,D,mt],styles:[".add-sale-container[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}@media (max-width: 768px){.add-sale-container[_ngcontent-%COMP%]{padding:1rem}}.form-control[_ngcontent-%COMP%]{height:40px}@media (max-width: 768px){.form-control[_ngcontent-%COMP%]{font-size:16px;min-height:44px}}.back-btn[_ngcontent-%COMP%]{margin-bottom:1rem;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{color:#fff;margin:0;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.sale-form[_ngcontent-%COMP%]{padding:2rem}@media (max-width: 768px){.sale-form[_ngcontent-%COMP%]{padding:1rem}}.header-section[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-bottom:2rem}.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.products-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;border:1px solid var(--primary)}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary);font-size:1.25rem;display:flex;align-items:center;gap:.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;color:var(--text-primary);font-weight:500}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:var(--danger);margin-left:4px}.select-group[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:.5rem;width:100%;overflow:visible}.select-group.inline[_ngcontent-%COMP%]{flex-direction:row;align-items:center;gap:.5rem}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{display:block;flex:1;position:relative;z-index:100;overflow:visible}.select-group[_ngcontent-%COMP%]   app-searchable-select.custom-width[_ngcontent-%COMP%]{position:absolute;z-index:1000;left:0}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within{z-index:1000;position:relative}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]{flex-shrink:0;margin-top:0;height:40px;min-width:40px;display:flex;align-items:center;justify-content:center;position:relative;z-index:1;border:1px solid var(--supporting);border-radius:8px;background:#fff;transition:all .3s ease;color:var(--primary);touch-action:manipulation;-webkit-tap-highlight-color:transparent}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary);color:#fff}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.input-group[_ngcontent-%COMP%]{display:flex;align-items:stretch}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background-color:var(--background);border:1px solid var(--border-color);border-right:none;border-radius:var(--border-radius) 0 0 var(--border-radius);height:38px;color:var(--text-secondary);min-width:40px;display:flex;align-items:center;justify-content:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:0 var(--border-radius) var(--border-radius) 0;flex:1}.sale-summary[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;display:flex;justify-content:flex-end;gap:2rem;flex-wrap:wrap}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;font-weight:600}.sale-summary[_ngcontent-%COMP%]   .summary-item.total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary)}@media (max-width: 768px){.sale-summary[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-end;gap:1rem}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.table-responsive[_ngcontent-%COMP%]{margin:0 -1.5rem;padding:0 1.5rem;overflow-x:auto;min-height:400px;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{margin:0 -1rem;padding:0 1rem}}.products-table[_ngcontent-%COMP%]{width:100%;margin-bottom:0;background:#fff;border-collapse:separate;border-spacing:0}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:var(--text-primary);font-weight:600;padding:1rem;white-space:nowrap;border-bottom:2px solid var(--border-color);font-size:.875rem}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:20%;min-width:250px}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(4){width:8%;max-width:100px}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(6), .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(7), .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(8), .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(9){width:8%;min-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{min-width:80px;font-size:.875rem}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{width:20%;min-width:250px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child   .form-control[_ngcontent-%COMP%]{min-width:250px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:8%;max-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4)   .form-control[_ngcontent-%COMP%]{min-width:80px;max-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(6), .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(7), .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8), .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(9){width:8%;min-width:100px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(6)   .form-control[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(7)   .form-control[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(8)   .form-control[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(9)   .form-control[_ngcontent-%COMP%]{min-width:90px}.products-table[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{flex-wrap:nowrap}.products-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{margin:0 auto}@media (max-width: 768px){.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}}.form-field-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem;overflow:visible}.form-field-container[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%], .form-field-container[_ngcontent-%COMP%]   .input-group.is-invalid[_ngcontent-%COMP%]{border-color:var(--danger);background-image:url(data:image/svg+xml,...)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-bottom:1.5rem;vertical-align:top}.invalid-feedback[_ngcontent-%COMP%]{color:var(--danger);font-size:.75rem;margin-top:.25rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}.discount-type-selector[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.discount-type-selector[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;gap:.25rem}.discount-type-selector[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{margin:0;cursor:pointer}.discount-type-selector[_ngcontent-%COMP%]   .form-check[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{margin:0;cursor:pointer;font-size:.875rem;-webkit-user-select:none;user-select:none}.discount-amount-display[_ngcontent-%COMP%]{color:#28a745;font-weight:500}.discount-price-display[_ngcontent-%COMP%]{color:var(--text-primary);font-weight:500}.discount-amount[_ngcontent-%COMP%]{color:#28a745}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}@media (hover: none) and (pointer: coarse){.btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.form-control[_ngcontent-%COMP%]{min-height:44px;font-size:16px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.8rem}.products-table[_ngcontent-%COMP%]   .discount-type-selector[_ngcontent-%COMP%]   .form-check-label[_ngcontent-%COMP%]{font-size:.75rem}}form[_ngcontent-%COMP%]{touch-action:manipulation}@media (max-width: 768px){app-searchable-select[_ngcontent-%COMP%]{position:relative;z-index:1000}}"],changeDetection:0})}}return s})();var Le=()=>({label:"All Customers",value:""});function ze(s,_){if(s&1){let t=F();o(0,"div",6)(1,"div",31),p(2,"app-searchable-select",32),o(3,"button",33),h("click",function(){b(t);let n=g();return C(n.refreshCustomers())})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(4,"i",34),r()()()}if(s&2){let t=g();c(2),d("options",t.customers)("defaultOption",dt(5,Le))("searchPlaceholder","Search customers..."),c(),d("disabled",t.isLoadingCustomers),c(),d("ngClass",t.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt")}}function je(s,_){if(s&1){let t=F();o(0,"button",35),h("click",function(){b(t);let n=g();return C(n.exportExcel())})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(1,"i",36),i(2," Export "),r()}if(s&2){let t=g();d("disabled",t.isExportButtonDisabled())}}function Be(s,_){if(s&1){let t=F();o(0,"div",37)(1,"button",38),h("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(2,"i",39),i(3," Add Sale Return "),r()()}}function $e(s,_){s&1&&(o(0,"th",27),i(1,"Actions"),r())}function qe(s,_){if(s&1){let t=F();o(0,"td",47)(1,"button",48),h("click",function(){b(t);let n=g().$implicit,a=g();return C(a.generatePdf(n.id,n.invoiceNumber))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(2,"i",49),r(),o(3,"button",50),h("click",function(){b(t);let n=g().$implicit,a=g();return C(a.viewDetails(n==null?null:n.id))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(4,"i",51),r(),o(5,"button",52),h("click",function(){b(t);let n=g().$implicit,a=g();return C(a.deleteSaleReturn(n.id))})("touchstart",function(n){return b(t),C(n.stopPropagation())}),p(6,"i",53),r()()}if(s&2){let t=g().$implicit;c(3),d("disabled",!(t!=null&&t.id))}}function Ge(s,_){if(s&1&&(o(0,"tr",40)(1,"td",41),i(2),r(),o(3,"td",42)(4,"strong"),i(5),r()(),o(6,"td",43),i(7),r(),o(8,"td",44),i(9),S(10,"date"),r(),o(11,"td",45)(12,"strong"),i(13),r()(),v(14,qe,7,1,"td",46),r()),s&2){let t=_.$implicit,e=_.index,n=g();c(2),A(n.startIndex+e+1),c(3),A(t.invoiceNumber),c(2),A(t.customerName),c(2),A(k(10,6,t.saleReturnDate,"dd-MM-yyyy")),c(4),A(t.totalSaleAmount||0),c(),d("ngIf",n.canManagePurchases)}}function Ye(s,_){if(s&1){let t=F();o(0,"app-pagination",54),h("pageChange",function(n){b(t);let a=g();return C(a.onPageChange(n))})("pageSizeChange",function(n){b(t);let a=g();return C(a.onPageSizeChange(n))}),r()}if(s&2){let t=g();d("currentPage",t.currentPage)("pageSize",t.pageSize)("totalElements",t.totalElements)("pageSizeOptions",t.pageSizeOptions)}}var Qt=(()=>{class s{constructor(t,e,n,a,l,u,m,f,O){this.saleService=t,this.customerService=e,this.fb=n,this.snackbar=a,this.dateUtils=l,this.encryptionService=u,this.router=m,this.authService=f,this.cdr=O,this.saleReturns=[],this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,50,100],this.totalPages=0,this.totalElements=0,this.startIndex=0,this.endIndex=0,this.customers=[],this.isLoadingCustomers=!1,this.canManagePurchases=!1,this.destroy$=new N,this.initializeForm()}ngOnInit(){this.canManagePurchases=this.authService.isAdmin()||this.authService.isStaffAdmin(),this.loadSaleReturns(),this.canManagePurchases&&this.loadCustomers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeForm(){this.searchForm=this.fb.group({search:[""],batchNumber:[""],customerId:[""],startDate:[""],endDate:[""]})}loadSaleReturns(){this.isLoading=!0;let t=this.searchForm.value,e={currentPage:this.currentPage,perPageRecord:this.pageSize,search:t.search?.trim()||void 0,customerId:this.canManagePurchases&&t.customerId?Number(t.customerId):void 0,startDate:t.startDate?this.formatDateForApi(t.startDate):void 0,endDate:t.endDate?this.formatDateForApi(t.endDate):void 0};Object.keys(e).forEach(n=>{e[n]===void 0&&delete e[n]}),this.saleService.searchSaleReturn(e).pipe(x(this.destroy$)).subscribe({next:n=>{this.saleReturns=n.content||[],this.totalPages=n.totalPages||0,this.totalElements=n.totalElements||0,this.updatePaginationIndexes(),this.isLoading=!1,this.cdr.markForCheck()},error:n=>{this.snackbar.error(n?.error?.message||"Failed to load sale returns"),this.isLoading=!1,this.cdr.markForCheck()}})}formatDateForApi(t){if(!t)return"";let e=new Date(t);if(isNaN(e.getTime()))return"";let n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${l}`}updatePaginationIndexes(){this.startIndex=this.currentPage*this.pageSize,this.endIndex=Math.min((this.currentPage+1)*this.pageSize,this.totalElements)}onSearch(t){t&&(t.preventDefault(),t.stopPropagation()),this.currentPage=0,this.loadSaleReturns()}resetForm(){this.searchForm.reset(),this.currentPage=0,this.loadSaleReturns()}onPageChange(t){this.currentPage=t,this.loadSaleReturns()}onPageSizeChange(t){this.pageSize=t,this.currentPage=0,this.loadSaleReturns()}loadCustomers(){this.canManagePurchases&&(this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(x(this.destroy$)).subscribe({next:t=>{t?.success&&t.data&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}refreshCustomers(){this.canManagePurchases&&(this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(x(this.destroy$)).subscribe({next:t=>{t?.success&&t.data&&(this.customers=t.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to refresh customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}viewDetails(t){if(!t){this.snackbar.error("Sale return ID is not available");return}let e=this.encryptionService.encrypt(t.toString());this.router.navigate(["/sale/return",e])}deleteSaleReturn(t){confirm("Are you sure you want to delete this sale return? This action cannot be undone.")&&(this.isLoading=!0,this.saleService.deleteSaleReturn(t).pipe(x(this.destroy$)).subscribe({next:e=>{e?.success?(this.snackbar.success(e.message||"Sale return deleted successfully"),this.loadSaleReturns()):(this.snackbar.error(e?.message||"Failed to delete sale return"),this.isLoading=!1,this.cdr.markForCheck())},error:e=>{this.snackbar.error(e?.error?.message||"Failed to delete sale return"),this.isLoading=!1,this.cdr.markForCheck()}}))}generatePdf(t,e){this.saleService.generateSaleReturnPdf(t).pipe(x(this.destroy$)).subscribe({next:({blob:n,filename:a})=>{let l="sale-return-"+(e?`${e}.pdf`:a),u=window.URL.createObjectURL(n),m=document.createElement("a");m.href=u,m.download=l,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(u),this.snackbar.success("PDF downloaded successfully")},error:n=>{this.snackbar.error(n?.error?.message||"Failed to generate PDF")}})}isExportButtonDisabled(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;return!t||!e}exportExcel(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;if(!t||!e){this.snackbar.error("Please select both start date and end date to export");return}let n=this.dateUtils.formatDateDDMMYYYY(t),a=this.dateUtils.formatDateDDMMYYYY(e);this.isLoading=!0,this.saleService.exportSaleReturnExcel({startDate:n,endDate:a}).pipe(x(this.destroy$)).subscribe({next:({blob:l,filename:u})=>{let m=window.URL.createObjectURL(l),f=document.createElement("a");f.href=m,f.download=u||`sale_return_export_${n}_${a}.xlsx`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(m),this.snackbar.success("Excel file downloaded successfully"),this.isLoading=!1,this.cdr.markForCheck()},error:l=>{this.snackbar.error(l?.error?.message||"Failed to export Excel file"),this.isLoading=!1,this.cdr.markForCheck()}})}static{this.\u0275fac=function(e){return new(e||s)(P(Z),P(X),P(K),P(J),P(Mt),P(H),P(W),P(vt),P(V))}}static{this.\u0275cmp=R({type:s,selectors:[["app-sale-return-list"]],decls:53,vars:8,consts:[[1,"purchase-container"],[3,"show"],["aria-labelledby","search-sale-returns-heading",1,"search-section","card"],["id","search-sale-returns-heading"],["role","search","aria-label","Sale return search form",3,"ngSubmit","formGroup"],[1,"search-controls"],[1,"form-group"],["for","invoice-search",1,"sr-only"],["id","invoice-search","type","text","formControlName","search","placeholder","Search by invoice number...","aria-label","Search by invoice number",1,"form-control"],["for","batch-search",1,"sr-only"],["id","batch-search","type","text","formControlName","batchNumber","placeholder","Search by Batch Number...","aria-label","Search by batch number",1,"form-control"],["class","form-group",4,"ngIf"],["for","start-date",1,"sr-only"],["id","start-date","type","date","formControlName","startDate","placeholder","Start Date","aria-label","Start date",1,"form-control",3,"touchstart"],["for","end-date",1,"sr-only"],["id","end-date","type","date","formControlName","endDate","placeholder","End Date","aria-label","End date",1,"form-control",3,"touchstart"],[1,"button-group"],["type","submit",1,"search-btn","btn","btn-sm","btn-primary",3,"touchstart"],[1,"fas","fa-search"],["type","button",1,"search-btn","btn","btn-sm","btn-secondary",3,"click","touchstart"],[1,"fas","fa-undo"],["type","button","class","search-btn btn btn-sm btn-success export-btn","title","Export sale returns to Excel",3,"disabled","click","touchstart",4,"ngIf"],["class","action-buttons",4,"ngIf"],["aria-labelledby","sale-returns-heading",1,"purchases-list","card"],["id","sale-returns-heading"],[1,"table-responsive"],["role","table","aria-label","Sale returns list",1,"table"],["scope","col"],["scope","col",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],[3,"currentPage","pageSize","totalElements","pageSizeOptions","pageChange","pageSizeChange",4,"ngIf"],[1,"product-select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","defaultOption","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",2,"margin-top","3px",3,"click","touchstart","disabled"],[1,"fas",3,"ngClass"],["type","button","title","Export sale returns to Excel",1,"search-btn","btn","btn-sm","btn-success","export-btn",3,"click","touchstart","disabled"],[1,"fas","fa-file-excel"],[1,"action-buttons"],["routerLink","/sale/return/create","aria-label","Add new sale return",1,"btn","btn-sm","btn-primary",3,"touchstart"],["aria-hidden","true",1,"fas","fa-plus"],["role","row"],["data-label","No"],["data-label","Invoice No."],["data-label","Customer Name"],["data-label","Sale Return Date"],["data-label","Total Amount"],["class","actions","data-label","Actions",4,"ngIf"],["data-label","Actions",1,"actions"],["aria-label","Export sale return as PDF",1,"btn-icon","pdf",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-file-pdf"],["aria-label","View sale return details",1,"btn-icon","edit",3,"click","touchstart","disabled"],["aria-hidden","true",1,"fas","fa-eye"],["aria-label","Delete sale return",1,"btn-icon","delete",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-trash"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalElements","pageSizeOptions"]],template:function(e,n){e&1&&(o(0,"div",0),p(1,"app-loader",1),o(2,"section",2)(3,"h2",3),i(4,"Search Sale Returns"),r(),o(5,"form",4),h("ngSubmit",function(l){return n.onSearch(l)}),o(6,"div",5)(7,"div",6)(8,"label",7),i(9,"Search by invoice number"),r(),p(10,"input",8),o(11,"label",9),i(12,"Search by batch number"),r(),p(13,"input",10),r(),v(14,ze,5,6,"div",11),o(15,"div",6)(16,"label",12),i(17,"Start date"),r(),o(18,"input",13),h("touchstart",function(l){return l.stopPropagation()}),r()(),o(19,"div",6)(20,"label",14),i(21,"End date"),r(),o(22,"input",15),h("touchstart",function(l){return l.stopPropagation()}),r()(),o(23,"div",16)(24,"button",17),h("touchstart",function(l){return l.stopPropagation()}),p(25,"i",18),i(26," Search "),r(),o(27,"button",19),h("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),p(28,"i",20),i(29," Reset "),r(),v(30,je,3,1,"button",21),r()()()(),v(31,Be,4,0,"div",22),o(32,"section",23)(33,"h2",24),i(34,"Sale Returns"),r(),o(35,"div",25)(36,"table",26)(37,"thead")(38,"tr")(39,"th",27),i(40,"No"),r(),o(41,"th",27),i(42,"Invoice No."),r(),o(43,"th",27),i(44,"Customer Name"),r(),o(45,"th",27),i(46,"Sale Return Date"),r(),o(47,"th",27),i(48,"Total Amount"),r(),v(49,$e,2,0,"th",28),r()(),o(50,"tbody"),v(51,Ge,15,9,"tr",29),r()()(),v(52,Ye,1,4,"app-pagination",30),r()()),e&2&&(c(),d("show",n.isLoading),c(4),d("formGroup",n.searchForm),c(9),d("ngIf",n.canManagePurchases),c(16),d("ngIf",n.canManagePurchases),c(),d("ngIf",n.canManagePurchases),c(18),d("ngIf",n.canManagePurchases),c(2),d("ngForOf",n.saleReturns),c(),d("ngIf",n.totalPages>0))},dependencies:[z,j,B,Y,$,q,G,U,Q,et,T,D,nt,ut],styles:[".purchase-container[_ngcontent-%COMP%]{padding:2rem;position:relative;min-height:200px;background-color:var(--background)}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border-radius:0;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;padding:20px}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--text-primary);font-size:1.5rem;font-weight:600}.purchase-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;justify-content:flex-start;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{touch-action:manipulation;-webkit-tap-highlight-color:transparent}.purchase-container[_ngcontent-%COMP%]   .sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:flex-start}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{grid-template-columns:1fr}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin:0}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{font-size:16px;min-height:44px}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:42px;padding:0;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color);border-radius:var(--border-radius);background:var(--primary)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{grid-column:1/-1}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:120px;height:42px;display:flex;align-items:center;justify-content:center;gap:.5rem;transition:all .2s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent;cursor:pointer}@media (max-width: 576px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100%;flex:1 1 100%}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:1px solid #28a745;font-weight:500}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838;border-color:#1e7e34;transform:translateY(-1px);box-shadow:0 2px 4px #28a7454d}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:active:not(:disabled), .purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:focus:not(:disabled){outline:2px solid rgba(40,167,69,.5);outline-offset:2px;transform:translateY(0)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:disabled{background-color:#6c757d;border-color:#6c757d;opacity:.6;cursor:not-allowed;transform:none}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap;font-weight:600}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;border:1px solid #dee2e6;border-radius:4px;padding:.5rem}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border:none;border-bottom:1px solid #f0f0f0}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);font-weight:600;color:var(--text-primary)}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-bottom:none}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]{justify-content:flex-start;flex-wrap:wrap;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]:before{display:none}}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]{padding:1rem}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{width:100%}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{touch-action:manipulation;-webkit-appearance:none;font-size:16px}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:1rem}}@media (max-width: 576px){.purchase-container[_ngcontent-%COMP%]{padding:.75rem}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-start;flex-wrap:wrap}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:6px;transition:all .2s ease;display:flex;align-items:center;justify-content:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-width:36px;min-height:36px}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]{color:var(--primary);background-color:#1458811a}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:active{transform:translateY(0)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{padding:6px}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}}.product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}.product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]{background-color:var(--background);color:#fff;margin-top:3px;width:42px;height:42px;border-radius:6px;transition:all .2s ease}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:active{transform:translateY(0)}"],changeDetection:0})}}return s})();var Ue=[{path:"",component:Ut},{path:"create",component:Dt},{path:"edit/:id",component:Dt},{path:"return",component:Qt},{path:"return/create",component:Nt},{path:"return/:id",component:Nt}],Kt=(()=>{class s{static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275mod=lt({type:s})}static{this.\u0275inj=st({imports:[rt.forChild(Ue),rt]})}}return s})();var Vn=(()=>{class s{static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275mod=lt({type:s})}static{this.\u0275inj=st({imports:[Lt,Bt,jt,rt,qt,Kt,T,D,nt,Gt]})}}return s})();export{Vn as SaleModule};
