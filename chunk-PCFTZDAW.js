import"./chunk-3HPTJ5GV.js";import{b as Me,c as le,d as ue,f as Le,g as Ve,i as ze,j as Qe}from"./chunk-4ELJ3ZDY.js";import{$ as u,A as Ae,Ab as q,Bb as ne,C as F,Ca as Pe,D as he,Da as me,Eb as L,Fb as re,Gb as ie,H as v,Ha as E,Hb as V,I as M,Ja as k,Ka as K,Lb as be,Mb as oe,Nb as De,Ob as z,Pa as Y,Pb as Te,Qa as H,Qb as ae,R as s,Ra as N,Rb as ve,S as g,Sa as A,Tb as ce,Ua as Z,Ub as se,Va as ee,Xa as te,Xb as U,Yb as ke,Z as h,Zb as Q,_a as Ce,a as Fe,ba as I,ea as r,f as w,fa as i,ga as d,ha as _e,ia as fe,ja as O,ma as _,na as p,sa as B,sc as j,ta as a,tb as R,tc as W,u as b,ua as C,ub as y,uc as qe,va as x,vb as D,vc as J,wb as T,wc as de,x as Ne,xb as Re,xc as Oe,y as ge}from"./chunk-5TXFCLAM.js";var $=(()=>{class o{constructor(e){this.http=e,this.apiUrl=`${ke.apiUrl}/api/purchases`,this.purchaseReturnApiUrl=`${ke.apiUrl}/api/purchase-returns`}searchPurchases(e){return this.http.post(`${this.apiUrl}/searchPurchase`,e)}createPurchase(e){return this.http.post(`${this.apiUrl}/create`,e)}updatePurchase(e){return this.http.post(`${this.apiUrl}/create`,e)}deletePurchase(e){return this.http.delete(`${this.apiUrl}/${e}`)}getPurchaseDetails(e,t=!1){return this.http.post(`${this.apiUrl}/detail`,{id:e,isPurchaseReturn:t})}updateQcPass(e){return this.http.post(`${this.apiUrl}/update-qc-pass`,e)}createPurchaseReturn(e){return this.http.post(`${this.purchaseReturnApiUrl}/create`,e)}getPurchaseReturnDetail(e){return this.http.post(`${this.purchaseReturnApiUrl}/detail`,{id:e})}searchPurchaseReturn(e){return this.http.post(`${this.purchaseReturnApiUrl}/searchPurchaseReturn`,e)}deletePurchaseReturn(e){return this.http.post(`${this.purchaseReturnApiUrl}/delete`,{id:e})}static{this.\u0275fac=function(t){return new(t||o)(Ae(Ce))}}static{this.\u0275prov=Ne({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var et=()=>({label:"All Customers",value:""});function tt(o,m){if(o&1){let e=O();r(0,"div",5)(1,"div",23),d(2,"app-searchable-select",24),r(3,"button",25),_("click",function(){v(e);let n=p();return M(n.refreshCustomers())}),d(4,"i",26),i()()()}if(o&2){let e=p();s(2),u("options",e.customers)("defaultOption",me(5,et))("searchPlaceholder","Search customers..."),s(),u("disabled",e.isLoadingCustomers),s(),u("ngClass",e.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt")}}function nt(o,m){if(o&1){let e=O();r(0,"button",33),_("click",function(){v(e);let n=p().$implicit,c=p();return M(c.editPurchase(n.id))}),d(1,"i",34),i()}}function rt(o,m){if(o&1){let e=O();r(0,"button",35),_("click",function(){v(e);let n=p().$implicit,c=p();return M(c.openReturn(n.id))}),d(1,"i",15),i()}}function it(o,m){if(o&1){let e=O();r(0,"button",36),_("click",function(){v(e);let n=p().$implicit,c=p();return M(c.openQc(n.id))}),d(1,"i",37),i()}}function ot(o,m){if(o&1){let e=O();r(0,"button",38),_("click",function(){v(e);let n=p().$implicit,c=p();return M(c.deletePurchase(n.id))}),d(1,"i",39),i()}}function at(o,m){if(o&1&&(r(0,"tr")(1,"td"),a(2),i(),r(3,"td"),a(4),i(),r(5,"td"),a(6),i(),r(7,"td"),a(8),E(9,"date"),i(),r(10,"td"),a(11),i(),r(12,"td")(13,"span",27),a(14),i()(),r(15,"td",28),h(16,nt,2,0,"button",29)(17,rt,2,0,"button",30)(18,it,2,0,"button",31)(19,ot,2,0,"button",32),i()()),o&2){let e,t=m.$implicit,n=m.index,c=p();s(2),C(c.startIndex+n+1),s(2),C(t.invoiceNumber),s(2),C(t.customerName),s(2),C(k(9,14,t.purchaseDate,"dd-MM-yyyy")),s(3),C((e=t.totalPurchaseAmount)!==null&&e!==void 0?e:0),s(2),I("pass",t.isQcPass)("pending",!t.isQcPass),s(),x(" ",t.isQcPass?"Pass":"Pending"," "),s(2),u("ngIf",c.canManagePurchases),s(),u("ngIf",c.canManagePurchases),s(),u("ngIf",c.canManagePurchases),s(),u("ngIf",c.canManagePurchases)}}function ct(o,m){if(o&1){let e=O();r(0,"app-pagination",40),_("pageChange",function(n){v(e);let c=p();return M(c.onPageChange(n))})("pageSizeChange",function(n){v(e);let c=p();return M(c.onPageSizeChange(n))}),i()}if(o&2){let e=p();u("currentPage",e.currentPage)("pageSize",e.pageSize)("totalElements",e.totalElements)("pageSizeOptions",e.pageSizeOptions)}}function st(o,m){if(o&1){let e=O();r(0,"app-sale-modal",41),_("saleCreated",function(){v(e);let n=p();return M(n.loadPurchases())}),i()}if(o&2){let e=p();u("purchase",e.selectedPurchase)}}var $e=(()=>{class o{constructor(e,t,n,c,l,f,P,S,G,He,We){this.purchaseService=e,this.customerService=t,this.fb=n,this.snackbar=c,this.dialog=l,this.modalService=f,this.dateUtils=P,this.cacheService=S,this.encryptionService=G,this.router=He,this.authService=We,this.purchases=[],this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,50,100],this.totalPages=0,this.totalElements=0,this.startIndex=0,this.endIndex=0,this.selectedPurchase=null,this.products=[],this.isLoadingProducts=!1,this.customers=[],this.isLoadingCustomers=!1,this.canManagePurchases=!1,this.destroy$=new w,this.initializeForm()}ngOnInit(){this.canManagePurchases=this.authService.isAdmin()||this.authService.isStaffAdmin(),this.loadPurchases(),this.canManagePurchases&&this.loadCustomers()}initializeForm(){this.searchForm=this.fb.group({search:[""],customerId:[""],startDate:[""],endDate:[""],batchNumber:[""]})}loadPurchases(){this.isLoading=!0;let e=Fe({currentPage:this.currentPage,perPageRecord:this.pageSize,startDate:this.searchForm.value.startDate?this.dateUtils.formatDate(this.searchForm.value.startDate):"",endDate:this.searchForm.value.endDate?this.dateUtils.formatDate(this.searchForm.value.endDate):""},this.searchForm.value);this.purchaseService.searchPurchases(e).pipe(b(this.destroy$)).subscribe({next:t=>{this.purchases=t.content,this.totalPages=t.totalPages,this.totalElements=t.totalElements,this.startIndex=this.currentPage*this.pageSize,this.endIndex=Math.min((this.currentPage+1)*this.pageSize,this.totalElements),this.isLoading=!1},error:t=>{this.snackbar.error(t.message||"Failed to load purchases"),this.isLoading=!1}})}onSearch(){this.currentPage=0,this.loadPurchases()}onPageChange(e){this.currentPage=e,this.loadPurchases()}onPageSizeChange(e){this.pageSize=e,this.currentPage=0,this.loadPurchases()}openSaleModal(e){this.selectedPurchase=e,this.modalService.open("sale")}deletePurchase(e){confirm("Are you sure you want to delete this purchase? This action cannot be undone.")&&(this.isLoading=!0,this.purchaseService.deletePurchase(e).pipe(b(this.destroy$)).subscribe({next:()=>{this.snackbar.success("Purchase deleted successfully"),this.loadPurchases()},error:t=>{this.snackbar.error(t?.error?.message||"Failed to delete purchase"),this.isLoading=!1}}))}loadCustomers(){this.canManagePurchases&&(this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(b(this.destroy$)).subscribe({next:e=>{e.success&&(this.customers=e.data),this.isLoadingCustomers=!1},error:e=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1}}))}refreshCustomers(){this.canManagePurchases&&(this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(b(this.destroy$)).subscribe({next:e=>{e.success&&(this.customers=e.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1},error:e=>{this.snackbar.error("Failed to refresh customers"),this.isLoadingCustomers=!1}}))}resetForm(){this.searchForm.reset(),this.currentPage=0,this.loadPurchases()}editPurchase(e){localStorage.setItem("purchaseId",this.encryptionService.encrypt(e.toString())),this.router.navigate(["/purchase/create"])}clearLocalStorage(){localStorage.removeItem("purchaseId"),this.router.navigate(["/purchase/create"])}openReturn(e){let t=this.encryptionService.encrypt(e.toString());this.router.navigate(["/purchase/return",t])}openQc(e){let t=this.encryptionService.encrypt(e.toString());this.router.navigate(["/purchase/qc",t])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(t){return new(t||o)(g($),g(de),g(z),g(j),g(Le),g(ze),g(Oe),g(qe),g(Q),g(ce),g(Me))}}static{this.\u0275cmp=F({type:o,selectors:[["app-purchase"]],standalone:!0,features:[Pe],decls:49,vars:6,consts:[[1,"purchase-container"],[3,"show"],[1,"search-section","card"],[3,"ngSubmit","formGroup"],[1,"search-controls"],[1,"form-group"],["type","text","formControlName","search","placeholder","Search by invoice number...",1,"form-control"],["type","text","formControlName","batchNumber","placeholder","Search by Batch Number...",1,"form-control"],["class","form-group",4,"ngIf"],["type","date","formControlName","startDate","placeholder","Start Date",1,"form-control"],["type","date","formControlName","endDate","placeholder","End Date",1,"form-control"],[1,"button-group"],["type","submit",1,"search-btn","btn","btn-sm","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-btn","btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-undo"],[1,"btn","btn-sm","btn-primary","mb-2",3,"click"],[1,"purchases-list","card"],[1,"table-responsive"],[1,"table"],[4,"ngFor","ngForOf"],[3,"currentPage","pageSize","totalElements","pageSizeOptions","pageChange","pageSizeChange",4,"ngIf"],[3,"purchase","saleCreated",4,"ngIf"],[1,"product-select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","defaultOption","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",2,"margin-top","3px",3,"click","disabled"],[1,"fas",3,"ngClass"],[1,"status-chip"],[1,"actions"],["class","btn-icon edit","title","Edit Purchase",3,"click",4,"ngIf"],["class","btn-icon add-return","title","Add Return",3,"click",4,"ngIf"],["class","btn-icon qc","title","Purchase QC",3,"click",4,"ngIf"],["class","btn-icon delete","title","Delete Purchase",3,"click",4,"ngIf"],["title","Edit Purchase",1,"btn-icon","edit",3,"click"],[1,"fas","fa-eye"],["title","Add Return",1,"btn-icon","add-return",3,"click"],["title","Purchase QC",1,"btn-icon","qc",3,"click"],[1,"fas","fa-clipboard-check"],["title","Delete Purchase",1,"btn-icon","delete",3,"click"],[1,"fas","fa-trash"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalElements","pageSizeOptions"],[3,"saleCreated","purchase"]],template:function(t,n){t&1&&(r(0,"div",0),d(1,"app-loader",1),r(2,"div",2)(3,"h2"),a(4,"Search Purchases"),i(),r(5,"form",3),_("ngSubmit",function(){return n.onSearch()}),r(6,"div",4)(7,"div",5),d(8,"input",6)(9,"input",7),i(),h(10,tt,5,6,"div",8),r(11,"div",5),d(12,"input",9),i(),r(13,"div",5),d(14,"input",10),i(),r(15,"div",11)(16,"button",12),d(17,"i",13),a(18," Search "),i(),r(19,"button",14),_("click",function(){return n.resetForm()}),d(20,"i",15),a(21," Reset "),i()()()()(),r(22,"button",16),_("click",function(){return n.clearLocalStorage()}),a(23,"Add Purchase"),i(),r(24,"div",17)(25,"h2"),a(26,"Purchases"),i(),r(27,"div",18)(28,"table",19)(29,"thead")(30,"tr")(31,"th"),a(32,"No"),i(),r(33,"th"),a(34,"Invoice No."),i(),r(35,"th"),a(36,"Customer Name"),i(),r(37,"th"),a(38,"Purchase Date"),i(),r(39,"th"),a(40,"Total Purchase Amount"),i(),r(41,"th"),a(42,"QC Status"),i(),r(43,"th"),a(44,"Actions"),i()()(),r(45,"tbody"),h(46,at,20,17,"tr",20),i()()(),h(47,ct,1,4,"app-pagination",21),i()(),h(48,st,1,1,"app-sale-modal",22)),t&2&&(s(),u("show",n.isLoading),s(4),u("formGroup",n.searchForm),s(5),u("ngIf",n.canManagePurchases),s(36),u("ngForOf",n.purchases),s(),u("ngIf",n.totalPages>0),s(),u("ngIf",n.selectedPurchase))},dependencies:[te,H,N,A,Z,ae,q,R,D,T,L,V,Te,U,Ve,Qe,W,J,le],styles:[".purchase-container[_ngcontent-%COMP%]{padding:2rem;position:relative;min-height:200px;background-color:var(--background)}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border-radius:0;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;padding:20px}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--text-primary);font-size:1.5rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:flex-start}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{grid-template-columns:1fr}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin:0}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:42px;padding:0;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color);border-radius:var(--border-radius);background:var(--primary)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{grid-column:1/-1}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;height:42px;display:flex;align-items:center;justify-content:center;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.purchase-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.purchase-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-secondary);white-space:nowrap}.purchase-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{width:auto;min-width:80px;padding:.5rem;margin-bottom:0}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]{padding:1rem}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%], .purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (max-width: 576px){.table-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]{width:100%}.table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{flex:1}}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-start}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:6px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]{color:var(--primary);background-color:#fd78231a}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:active{transform:translateY(0)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{padding:6px}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}}.status-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.25rem .75rem;border-radius:999px;font-size:.8rem;font-weight:600;letter-spacing:.02em;text-transform:uppercase;white-space:nowrap}.status-chip.pass[_ngcontent-%COMP%]{background-color:#28a74526;color:#28a745}.status-chip.pending[_ngcontent-%COMP%]{background-color:#ffc10726;color:#ffc107}  .custom-snackbar.success{background-color:var(--accent2)}  .custom-snackbar.error{background-color:#dc3545}  .custom-snackbar .snackbar-message{display:flex;align-items:center;gap:.5rem;color:#fff}  .custom-snackbar .snackbar-message i{font-size:1.2rem}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffc;display:flex;justify-content:center;align-items:center;z-index:1000}.loading-overlay[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:var(--primary)}.product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}.product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]{background-color:var(--background);color:#fff;margin-top:3px;width:42px;height:42px;border-radius:6px;transition:all .2s ease}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:active{transform:translateY(0)}"]})}}return o})();function lt(o,m){o&1&&(r(0,"div",40),a(1," Customer is required "),i())}function ut(o,m){o&1&&(r(0,"div",40),a(1," Purchase date is required "),i())}function dt(o,m){o&1&&(r(0,"div",40),a(1," Invoice number is required "),i())}function mt(o,m){o&1&&(r(0,"div",40),a(1," Please select a product "),i())}function pt(o,m){o&1&&(r(0,"div",40),a(1," Quantity must be 1 or greater "),i())}function gt(o,m){o&1&&(r(0,"div",40),a(1," Double quotes are not allowed "),i())}function ht(o,m){o&1&&(r(0,"div",40),a(1," Unit price must be greater than 0 "),i())}function _t(o,m){if(o&1){let e=O();r(0,"tr",41)(1,"td")(2,"div",42),d(3,"app-searchable-select",43),h(4,mt,2,0,"div",18),i()(),r(5,"td")(6,"div",42),d(7,"input",44),h(8,pt,2,0,"div",18),i()(),r(9,"td")(10,"div",42),d(11,"input",45),h(12,gt,2,0,"div",18),i()(),r(13,"td")(14,"div",42)(15,"div",46),d(16,"input",47),i(),h(17,ht,2,0,"div",18),i()(),r(18,"td")(19,"div",46),d(20,"input",48),i()(),r(21,"td")(22,"div",46),d(23,"input",49),i()(),r(24,"td")(25,"div",42),d(26,"input",50),i()(),r(27,"td")(28,"button",51),_("click",function(){let n=v(e).index,c=p();return M(c.removeProduct(n))}),d(29,"i",52),i()()()}if(o&2){let e,t=m.index,n=p();u("formGroupName",t),s(3),I("is-invalid",n.isProductFieldInvalid(t,"productId")),u("focusWidthPx",400)("options",n.products)("placeholder","Select Product")("searchPlaceholder","Search products..."),s(),u("ngIf",n.isProductFieldInvalid(t,"productId")),s(3),I("is-invalid",n.isProductFieldInvalid(t,"quantity")),s(),u("ngIf",n.isProductFieldInvalid(t,"quantity")),s(3),I("is-invalid",n.isProductFieldInvalid(t,"batchNumber")),s(),u("ngIf",(e=n.productsFormArray.at(t).get("batchNumber"))==null||e.errors==null?null:e.errors.doubleQuotes),s(4),I("is-invalid",n.isProductFieldInvalid(t,"unitPrice")),s(),u("ngIf",n.isProductFieldInvalid(t,"unitPrice")),s(3),u("value",n.getFormattedPrice(t)),s(3),u("value",n.getFormattedTaxAmount(t)),s(5),u("disabled",n.productsFormArray.length===1)}}function ft(o,m){o&1&&d(0,"app-loader")}var we=(()=>{class o{get productsFormArray(){return this.purchaseForm.get("products")}constructor(e,t,n,c,l,f,P,S){this.fb=e,this.productService=t,this.customerService=n,this.purchaseService=c,this.snackbar=l,this.http=f,this.router=P,this.encryptionService=S,this.products=[],this.customers=[],this.loading=!1,this.isLoadingProducts=!1,this.isLoadingCustomers=!1,this.isEdit=!1,this.destroy$=new w,this.productSubscriptions=[],this.initForm()}ngOnInit(){this.loadProducts(),this.loadCustomers();let e=localStorage.getItem("purchaseId");if(e){let t=this.encryptionService.decrypt(e);t&&this.fetchPurchaseDetails(Number(t))}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.productSubscriptions.forEach(e=>e?.unsubscribe())}initForm(){this.purchaseForm=this.fb.group({id:[null],customerId:["",y.required],purchaseDate:[Y(new Date,"yyyy-MM-dd","en"),y.required],invoiceNumber:["",y.required],products:this.fb.array([])}),this.addProduct()}createProductFormGroup(){return this.fb.group({productId:["",y.required],quantity:["",[y.required,y.min(1)]],batchNumber:["",[this.noDoubleQuotesValidator()]],unitPrice:["",[y.required,y.min(.01)]],price:[{value:0,disabled:!0}],taxPercentage:[{value:0,disabled:!0}],taxAmount:[{value:0,disabled:!0}],remarks:[null,[]]})}addProduct(){let e=this.createProductFormGroup();this.setupProductCalculations(e,this.productsFormArray.length),this.productsFormArray.push(e)}removeProduct(e){this.productsFormArray.length!==1&&(this.productSubscriptions[e]&&(this.productSubscriptions[e].unsubscribe(),this.productSubscriptions.splice(e,1)),this.productsFormArray.removeAt(e),this.productsFormArray.controls.forEach((t,n)=>{this.productSubscriptions[n]&&this.productSubscriptions[n].unsubscribe(),this.setupProductCalculations(t,n)}),this.calculateTotalAmount())}setupProductCalculations(e,t){let n=e.get("productId")?.valueChanges.pipe(b(this.destroy$)).subscribe(l=>{if(l){let f=this.products.find(P=>P.id===l);if(f){let P=f.taxPercentage||0;e.patchValue({taxPercentage:P},{emitEvent:!1}),this.calculateProductPrice(t)}}}),c=e.valueChanges.pipe(b(this.destroy$)).subscribe(()=>{this.calculateProductPrice(t)});this.productSubscriptions[t]=c}calculateProductPrice(e){let t=this.productsFormArray.at(e);if(!t)return;let n=Number(t.get("quantity")?.value||0),c=Number(t.get("unitPrice")?.value||0),l=Number(t.get("taxPercentage")?.value||0),f=Number((n*c).toFixed(2)),P=Number((f*l/100).toFixed(2));t.patchValue({price:f,taxAmount:P},{emitEvent:!1}),this.calculateTotalAmount()}getTotalAmount(){return this.productsFormArray.controls.reduce((e,t)=>e+(t.get("price").value||0),0)}getTotalTaxAmount(){return this.productsFormArray.controls.reduce((e,t)=>e+(t.get("taxAmount").value||0),0)}loadProducts(){this.isLoadingProducts=!0,this.productService.getProducts({status:"A"}).subscribe({next:e=>{e.success&&(this.products=e.data),this.isLoadingProducts=!1},error:e=>{this.snackbar.error("Failed to load products"),this.isLoadingProducts=!1}})}refreshProducts(){this.isLoadingProducts=!0,this.productService.refreshProducts().subscribe({next:e=>{e.success&&(this.products=e.data,this.snackbar.success("Products refreshed successfully")),this.isLoadingProducts=!1},error:e=>{this.snackbar.error("Failed to refresh products"),this.isLoadingProducts=!1}})}loadCustomers(){this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).subscribe({next:e=>{e.success&&(this.customers=e.data),this.isLoadingCustomers=!1},error:e=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1}})}refreshCustomers(){this.isLoadingCustomers=!0,this.customerService.refreshCustomers().subscribe({next:e=>{e.success&&(this.customers=e.data),this.snackbar.success("Customers refreshed successfully"),this.isLoadingCustomers=!1},error:e=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1}})}isFieldInvalid(e){let t=this.purchaseForm.get(e);return t?t.invalid&&t.touched:!1}isProductFieldInvalid(e,t){let n=this.productsFormArray.at(e).get(t);if(!n)return!1;if(n.invalid&&(n.dirty||n.touched)){let l=n.errors;if(l&&(l.required||l.min&&t==="quantity"||l.min&&t==="unitPrice"||l.min||l.max||l.min))return!0}return!1}resetForm(){this.isEdit=!1,this.purchaseForm.patchValue({id:null}),this.initForm()}onSubmit(){if(this.markFormGroupTouched(this.purchaseForm),this.purchaseForm.valid){this.loading=!0;let e=this.preparePurchaseData();(this.isEdit?this.purchaseService.updatePurchase(e):this.purchaseService.createPurchase(e)).subscribe({next:n=>{n?.success&&(this.snackbar.success(`Purchase ${this.isEdit?"updated":"created"} successfully`),localStorage.removeItem("purchaseId"),this.router.navigate(["/purchase"])),this.loading=!1},error:n=>{this.snackbar.error(n?.error?.message||`Failed to ${this.isEdit?"update":"create"} purchase`),this.loading=!1}})}else{let e=document.querySelector(".is-invalid");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}preparePurchaseData(){let e=this.purchaseForm.value,t={purchaseDate:Y(e.purchaseDate,"dd-MM-yyyy","en"),customerId:e.customerId,invoiceNumber:e.invoiceNumber,price:this.getTotalAmount(),taxAmount:this.getTotalTaxAmount(),products:e.products.map((n,c)=>({productId:n.productId,quantity:n.quantity,batchNumber:n.batchNumber,unitPrice:n.unitPrice,price:this.productsFormArray.at(c).get("price")?.value,taxPercentage:this.productsFormArray.at(c).get("taxPercentage")?.value,taxAmount:this.productsFormArray.at(c).get("taxAmount")?.value,remarks:n.remarks}))};return this.isEdit&&e.id&&(t.id=e.id),t}markFormGroupTouched(e){Object.values(e.controls).forEach(t=>{t instanceof Re||t instanceof De?this.markFormGroupTouched(t):(t.markAsTouched(),t.markAsDirty())})}calculateTotalAmount(){let e=this.productsFormArray.controls.reduce((n,c)=>n+(c.get("price").value||0),0),t=this.productsFormArray.controls.reduce((n,c)=>n+(c.get("taxAmount").value||0),0);this.purchaseForm.patchValue({price:e,taxAmount:t,totalAmount:e+t},{emitEvent:!1})}noDoubleQuotesValidator(){return e=>e.value&&e.value.includes('"')?{doubleQuotes:!0}:null}getFormattedPrice(e){let t=this.productsFormArray.at(e).get("price")?.value;return t?t.toFixed(2):"0.00"}getFormattedTaxAmount(e){let t=this.productsFormArray.at(e).get("taxAmount")?.value;return t?t.toFixed(2):"0.00"}fetchPurchaseDetails(e){this.purchaseService.getPurchaseDetails(e).subscribe({next:t=>{console.log("response : ",t),t.id&&(console.log("response.data : ",t.id),this.isEdit=!0,this.populateForm(t))},error:t=>{this.snackbar.error(t?.error?.message||"Failed to load purchase details")}})}populateForm(e){this.purchaseForm.patchValue({customerId:e.customerId,id:e.id,purchaseDate:Y(new Date(e.purchaseDate),"yyyy-MM-dd","en"),invoiceNumber:e.invoiceNumber}),this.productsFormArray.clear(),e.items.forEach((t,n)=>{let c=this.createProductFormGroup();this.setupProductCalculations(c,n),c.patchValue({productId:t.productId,quantity:t.quantity,unitPrice:t.unitPrice,price:t.price,taxPercentage:t.taxPercentage,taxAmount:t.taxAmount,batchNumber:t.batchNumber,remarks:t.remarks}),this.productsFormArray.push(c)}),this.isEdit=!0}static{this.\u0275fac=function(t){return new(t||o)(g(z),g(ue),g(de),g($),g(j),g(Ce),g(ce),g(Q))}}static{this.\u0275cmp=F({type:o,selectors:[["app-add-purchase"]],standalone:!0,features:[Pe],decls:101,vars:34,consts:[[1,"add-purchase-container"],["routerLink","/purchase",1,"btn","btn-sm","btn-secondary","back-btn"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"form-title"],[1,"fas","fa-cart-plus"],[1,"purchase-form",3,"ngSubmit","formGroup"],[1,"header-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],[1,"fas","fa-user"],[1,"required"],[1,"select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","placeholder","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh","mt-2",3,"click","disabled"],[1,"fas",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","purchaseDate"],[1,"fas","fa-calendar"],["type","date","id","purchaseDate","formControlName","purchaseDate",1,"form-control"],["for","invoiceNumber"],[1,"fas","fa-file-invoice"],["type","text","id","invoiceNumber","formControlName","invoiceNumber",1,"form-control"],["formArrayName","products",1,"products-section"],[1,"products-header"],[1,"fas","fa-boxes"],["type","button",1,"btn","btn-sm","btn-primary",3,"click"],[1,"fas","fa-plus"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf"],[1,"purchase-summary"],[1,"summary-item"],[1,"form-actions"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","disabled"],[1,"fas","fa-undo"],["type","submit",1,"btn","btn-sm","btn-primary",3,"disabled"],[4,"ngIf"],[1,"invalid-feedback"],[3,"formGroupName"],[1,"form-field-container"],["formControlName","productId","labelKey","name","valueKey","id",3,"focusWidthPx","options","placeholder","searchPlaceholder"],["type","number","formControlName","quantity","placeholder","Qty","min","1",1,"form-control"],["type","text","formControlName","batchNumber","placeholder","Batch Number",1,"form-control"],[1,"input-group"],["type","number","formControlName","unitPrice","placeholder","Price","min","0.01","step","0.01",1,"form-control"],["type","number","formControlName","price","readonly","",1,"form-control",3,"value"],["type","number","formControlName","taxAmount","readonly","",1,"form-control",3,"value"],["type","text","formControlName","remarks","placeholder","Remarks",1,"form-control"],["type","button","title","Remove Product",1,"btn","btn-sm","btn-danger",3,"click","disabled"],[1,"fas","fa-trash"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"button",1),d(2,"i",2),a(3," Back to Purchases "),i(),r(4,"div",3)(5,"div",4)(6,"h2",5),d(7,"i",6),a(8," Add New Purchase "),i()(),r(9,"form",7),_("ngSubmit",function(){return n.onSubmit()}),r(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),d(14,"i",12),a(15," Select Customer "),r(16,"span",13),a(17,"*"),i()(),r(18,"div",14),d(19,"app-searchable-select",15),r(20,"button",16),_("click",function(){return n.refreshCustomers()}),d(21,"i",17),i()(),h(22,lt,2,0,"div",18),i(),r(23,"div",10)(24,"label",19),d(25,"i",20),a(26," Purchase Date "),r(27,"span",13),a(28,"*"),i()(),d(29,"input",21),h(30,ut,2,0,"div",18),i(),r(31,"div",10)(32,"label",22),d(33,"i",23),a(34," Invoice Number "),r(35,"span",13),a(36,"*"),i()(),d(37,"input",24),h(38,dt,2,0,"div",18),i()()(),r(39,"div",25)(40,"div",26)(41,"h3"),d(42,"i",27),a(43," Products"),i(),r(44,"button",28),_("click",function(){return n.addProduct()}),d(45,"i",29),a(46," Add Product "),i()(),r(47,"div",30)(48,"table",31)(49,"thead")(50,"tr")(51,"th"),a(52,"Product Name"),i(),r(53,"th"),a(54,"Quantity"),i(),r(55,"th"),a(56,"Batch Number"),i(),r(57,"th"),a(58,"Rate"),i(),r(59,"th"),a(60,"Price"),i(),r(61,"th"),a(62,"Tax Amount"),i(),r(63,"th"),a(64,"Remarks"),i(),r(65,"th"),a(66,"Actions"),i()()(),r(67,"tbody"),h(68,_t,30,20,"tr",32),i()()()(),r(69,"div",33)(70,"div",34)(71,"span"),a(72,"Total Products:"),i(),r(73,"strong"),a(74),i()(),r(75,"div",34)(76,"span"),a(77,"Total Price:"),i(),r(78,"strong"),a(79),E(80,"number"),i()(),r(81,"div",34)(82,"span"),a(83,"Total Tax Amount:"),i(),r(84,"strong"),a(85),E(86,"number"),i()(),r(87,"div",34)(88,"span"),a(89,"Grand Total:"),i(),r(90,"strong"),a(91),E(92,"number"),i()()(),r(93,"div",35)(94,"button",36),_("click",function(){return n.resetForm()}),d(95,"i",37),a(96," Reset "),i(),r(97,"button",38),d(98,"i",17),a(99),i()()()()(),h(100,ft,1,0,"app-loader",39)),t&2&&(s(9),u("formGroup",n.purchaseForm),s(10),I("is-invalid",n.isFieldInvalid("customerId")),u("options",n.customers)("placeholder","Select Customer")("searchPlaceholder","Search customers..."),s(),u("disabled",n.isLoadingCustomers),s(),u("ngClass",n.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt"),s(),u("ngIf",n.isFieldInvalid("customerId")),s(7),I("is-invalid",n.isFieldInvalid("purchaseDate")),s(),u("ngIf",n.isFieldInvalid("purchaseDate")),s(7),I("is-invalid",n.isFieldInvalid("invoiceNumber")),s(),u("ngIf",n.isFieldInvalid("invoiceNumber")),s(30),u("ngForOf",n.productsFormArray.controls),s(6),C(n.productsFormArray.length),s(5),x("\u20B9",k(80,25,n.getTotalAmount(),"1.2-2"),""),s(6),x("\u20B9",k(86,28,n.getTotalTaxAmount(),"1.2-2"),""),s(6),x("\u20B9",k(92,31,n.getTotalAmount()+n.getTotalTaxAmount(),"1.2-2"),""),s(3),u("disabled",n.loading),s(3),u("disabled",n.purchaseForm.invalid||n.loading),s(),u("ngClass",n.loading?"fa-spinner fa-spin":"fa-save"),s(),x(" ",n.loading?"Saving...":"Save Purchase"," "),s(),u("ngIf",n.loading))},dependencies:[te,H,N,A,ee,ae,q,R,ne,D,T,oe,L,V,re,ie,U,se,W,J],styles:[".add-purchase-container[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}@media (max-width: 768px){.add-purchase-container[_ngcontent-%COMP%]{padding:1rem}}.select-group[_ngcontent-%COMP%]{position:relative}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{display:block}.select-group[_ngcontent-%COMP%]   app-searchable-select.custom-width[_ngcontent-%COMP%]{position:absolute;z-index:1000;left:0}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within{z-index:1000}.form-control[_ngcontent-%COMP%]{height:40px}.back-btn[_ngcontent-%COMP%]{margin-bottom:1rem}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{color:#fff;margin:0;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.purchase-form[_ngcontent-%COMP%]{padding:2rem}@media (max-width: 768px){.purchase-form[_ngcontent-%COMP%]{padding:1rem}}.header-section[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-bottom:2rem;position:relative}.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.products-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;border:1px solid var(--primary)}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary);font-size:1.25rem;display:flex;align-items:center;gap:.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.product-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr 1fr 1fr 1fr 1fr 1fr auto;gap:1rem;align-items:start}@media (max-width: 1200px){.product-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}@media (max-width: 768px){.product-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.remove-product[_ngcontent-%COMP%]{background-color:var(--danger-light);color:var(--danger);border:none;width:36px;height:36px;border-radius:var(--border-radius);display:flex;align-items:center;justify-content:center;transition:all .3s ease}.remove-product[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--danger);color:#fff;transform:translateY(-1px)}.remove-product[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.remove-product[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem}}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem;position:relative}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;color:var(--text-primary);font-weight:500}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:var(--danger);margin-left:4px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:stretch}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background-color:var(--background);border:1px solid var(--border-color);border-right:none;border-radius:var(--border-radius) 0 0 var(--border-radius);height:38px;color:var(--text-secondary);min-width:40px;display:flex;align-items:center;justify-content:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:0 var(--border-radius) var(--border-radius) 0;flex:1}.purchase-summary[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;display:flex;justify-content:flex-end;gap:2rem;flex-wrap:wrap}.purchase-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.purchase-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.purchase-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;font-weight:600}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.table-responsive[_ngcontent-%COMP%]{margin:0 -1.5rem;padding:0 1.5rem;overflow-x:auto;min-height:400px;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{margin:0 -1rem;padding:0 1rem}}.products-table[_ngcontent-%COMP%]{width:100%;margin-bottom:0;background:#fff;border-collapse:separate;border-spacing:0}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:var(--text-primary);font-weight:600;padding:1rem;white-space:nowrap;border-bottom:2px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{min-width:80px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child   .form-control[_ngcontent-%COMP%]{min-width:200px}.products-table[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{flex-wrap:nowrap}.products-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{margin:0 auto}@media (max-width: 768px){.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}}.form-field-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem}.form-field-container[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%], .form-field-container[_ngcontent-%COMP%]   .input-group.is-invalid[_ngcontent-%COMP%]{border-color:var(--danger);background-image:url(data:image/svg+xml,...)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-bottom:1.5rem;vertical-align:top}.invalid-feedback[_ngcontent-%COMP%]{color:var(--danger);font-size:.75rem;margin-top:.25rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}"]})}}return o})();function Pt(o,m){if(o&1&&(r(0,"div",14)(1,"div",15)(2,"span"),a(3,"Invoice"),i(),r(4,"strong"),a(5),i()(),r(6,"div",15)(7,"span"),a(8,"Purchase Date"),i(),r(9,"strong"),a(10),E(11,"date"),i()(),r(12,"div",15)(13,"span"),a(14,"Total Amount"),i(),r(15,"strong"),a(16),E(17,"number"),i()()()),o&2){let e=p();s(5),C(e.purchaseDetails.invoiceNumber),s(5),C(k(11,3,e.purchaseDetails.purchaseDate,"dd-MM-yyyy")),s(6),C(k(17,6,e.purchaseDetails.totalAmount,"1.2-2"))}}function Ct(o,m){if(o&1&&(r(0,"div",39),a(1),i()),o&2){let e,t=p().$implicit;s(),x(" QC pass must be between 0 and ",(e=t.get("quantity"))==null?null:e.value," ")}}function bt(o,m){o&1&&(r(0,"span",40),d(1,"i",41),i())}function vt(o,m){if(o&1){let e=O();r(0,"tr",28)(1,"td"),a(2),i(),r(3,"td")(4,"div",29)(5,"div",30),a(6),i()()(),r(7,"td")(8,"span",31),a(9),i()(),r(10,"td")(11,"span",32),a(12),i()(),r(13,"td")(14,"div",33)(15,"input",34),_("blur",function(){let n=v(e).index,c=p(4);return M(c.onQcPassBlur(n))})("keydown",function(n){let c=v(e).index,l=p(4);return M(l.onQcPassKeydown(n,c))}),i(),h(16,Ct,2,1,"div",35),i()(),r(17,"td")(18,"div",36),a(19),i()(),r(20,"td")(21,"div",37)(22,"span",21),a(23),i(),h(24,bt,2,0,"span",38),i()()()}if(o&2){let e,t,n,c,l,f,P=m.$implicit,S=m.index,G=p(4);u("formGroupName",S),s(2),C(S+1),s(4),x(" ",((e=P.get("productName"))==null?null:e.value)||"N/A"," "),s(3),C((t=P.get("quantity"))==null?null:t.value),s(3),C(((n=P.get("batchNumber"))==null?null:n.value)||"-"),s(3),u("max",(c=P.get("quantity"))==null?null:c.value),s(),u("ngIf",G.isQcPassInvalid(S)),s(3),x(" ",((l=P.get("remarks"))==null?null:l.value)||"-"," "),s(3),I("pass",G.isItemQcPassed(P))("pending",!G.isItemQcPassed(P)),s(),x(" ",G.isItemQcPassed(P)?"Pass":"Pending"," "),s(),u("ngIf",G.savingItemId===((f=P.get("purchaseItemId"))==null?null:f.value))}}function Mt(o,m){if(o&1&&(r(0,"div",24)(1,"div",25)(2,"table",26)(3,"thead")(4,"tr")(5,"th"),a(6,"No"),i(),r(7,"th"),a(8,"Product Name"),i(),r(9,"th"),a(10,"Quantity"),i(),r(11,"th"),a(12,"Batch Number"),i(),r(13,"th"),a(14,"QC Pass"),i(),r(15,"th"),a(16,"Remarks"),i(),r(17,"th"),a(18,"Status"),i()()(),r(19,"tbody"),h(20,vt,25,14,"tr",27),i()()()()),o&2){let e=p(3);s(20),u("ngForOf",e.itemsFormArray.controls)}}function Ot(o,m){o&1&&(r(0,"div",42),d(1,"i",43),r(2,"p"),a(3,"No items found for this purchase."),i()())}function xt(o,m){if(o&1){let e=O();r(0,"div",17)(1,"div",18)(2,"div",19)(3,"div",20)(4,"span"),a(5,"Total Items"),i(),r(6,"strong"),a(7),i()(),r(8,"div",20)(9,"span"),a(10,"QC Status"),i(),r(11,"span",21),a(12),i()()()(),r(13,"form",22),_("ngSubmit",function(n){v(e);let c=p(2);return M(c.onFormSubmit(n))}),h(14,Mt,21,1,"div",23)(15,Ot,4,0,"ng-template",null,2,K),i()()}if(o&2){let e=B(16),t=p(2);s(7),C(t.itemsFormArray.length),s(4),I("pass",t.isAllQcPassed)("pending",!t.isAllQcPassed),s(),x(" ",t.isAllQcPassed?"All Passed":"Pending"," "),s(),u("formGroup",t.qcForm),s(),u("ngIf",t.itemsFormArray.length>0)("ngIfElse",e)}}function yt(o,m){if(o&1&&(_e(0),h(1,xt,17,9,"div",16),fe()),o&2){let e=p(),t=B(17);s(),u("ngIf",e.purchaseDetails)("ngIfElse",t)}}function St(o,m){o&1&&(r(0,"div",44),d(1,"i",41),r(2,"span"),a(3,"Loading purchase details..."),i()())}function It(o,m){o&1&&(r(0,"div",42),d(1,"i",45),r(2,"p"),a(3,"Purchase details not available."),i()())}var Ue=(()=>{class o{constructor(e,t,n,c,l,f){this.fb=e,this.route=t,this.purchaseService=n,this.productService=c,this.snackbar=l,this.encryptionService=f,this.isLoading=!1,this.isSaving=!1,this.products=[],this.savingItemId=null,this.destroy$=new w,this.qcForm=this.fb.group({items:this.fb.array([])})}get itemsFormArray(){return this.qcForm.get("items")}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(!e){this.snackbar.error("Invalid purchase id");return}let t=this.encryptionService.decrypt(e),n=t?Number(t):NaN;if(!n||isNaN(n)){this.snackbar.error("Invalid purchase id");return}this.loadProducts(),this.loadPurchaseDetails(n)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadProducts(){this.productService.getProducts({status:"A"}).pipe(b(this.destroy$)).subscribe({next:e=>{e?.success&&e.data&&(this.products=e.data.content||e.data),this.mapProductNames()},error:()=>{this.snackbar.error("Failed to load products")}})}loadPurchaseDetails(e){this.isLoading=!0,this.purchaseService.getPurchaseDetails(e).pipe(b(this.destroy$)).subscribe({next:t=>{this.purchaseDetails=t;let n=t.items||[];this.buildItemsForm(n),this.isLoading=!1},error:t=>{this.snackbar.error(t?.error?.message||"Failed to load purchase details"),this.isLoading=!1}})}buildItemsForm(e){this.itemsFormArray.clear(),e.forEach(t=>{let n=this.fb.group({purchaseItemId:[t.id],productId:[t.productId],productName:[null],quantity:[t.quantity],batchNumber:[t.batchNumber],qcPass:[t.qcPass,[y.min(0),y.max(t.quantity)]],remarks:[t.remarks]});this.itemsFormArray.push(n)}),this.mapProductNames()}mapProductNames(){!this.products||this.products.length===0||this.itemsFormArray.controls.forEach(e=>{let t=e.get("productId")?.value;if(t){let n=this.products.find(c=>c.id===t);n&&e.get("productName")?.setValue(n.name,{emitEvent:!1})}})}get isAllQcPassed(){return!this.itemsFormArray||this.itemsFormArray.length===0?!1:this.itemsFormArray.controls.every(e=>{let t=Number(e.get("quantity")?.value||0),c=e.get("qcPass")?.value;if(c===null||c==="")return!1;let l=Number(c);return!isNaN(l)&&l<=t})}isItemQcPassed(e){if(!e)return!1;let t=Number(e.get("quantity")?.value||0),c=e.get("qcPass")?.value;if(c===null||c==="")return!1;let l=Number(c);return!isNaN(l)&&l<=t}isQcPassInvalid(e){let t=this.itemsFormArray.at(e).get("qcPass");return!!(t&&t.invalid&&(t.dirty||t.touched))}onQcPassBlur(e){this.updateQcPass(e)}onQcPassKeydown(e,t){e.key==="Enter"&&(e.preventDefault(),this.updateQcPass(t))}onFormSubmit(e){e.preventDefault()}updateQcPass(e){let t=this.itemsFormArray.at(e),n=t.get("purchaseItemId")?.value,c=Number(t.get("quantity")?.value||0),l=t.get("qcPass"),f=l?.value;if(f===null||f==="")return;let P=Number(f);if(!n){this.snackbar.error("purchaseItemId is required");return}if(isNaN(P)||P<0){this.snackbar.error("QC pass quantity cannot be negative"),l?.setValue(0);return}if(P>c){this.snackbar.error("QC pass quantity cannot exceed ordered quantity"),l?.setValue(c);return}this.savingItemId!==n&&(this.isSaving=!0,this.savingItemId=n,this.purchaseService.updateQcPass({purchaseItemId:n,qcPass:P}).pipe(b(this.destroy$)).subscribe({next:S=>{S?.success?this.snackbar.success(S.message||"QC pass updated successfully"):this.snackbar.error(S?.message||"Failed to update QC pass"),this.isSaving=!1,this.savingItemId=null},error:S=>{let G=S?.error?.message||"Failed to update QC pass";this.snackbar.error(G),this.isSaving=!1,this.savingItemId=null}}))}static{this.\u0275fac=function(t){return new(t||o)(g(z),g(ve),g($),g(ue),g(j),g(Q))}}static{this.\u0275cmp=F({type:o,selectors:[["app-qc-purchase"]],decls:18,vars:8,consts:[["loadingTpl",""],["emptyPurchaseTpl",""],["noItemsTpl",""],[1,"qc-purchase-container"],["routerLink","/purchase",1,"btn","btn-sm","btn-secondary","back-btn"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"header-main"],[1,"form-title"],[1,"fas","fa-clipboard-check"],[1,"status-chip","header-status"],["class","purchase-meta",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"purchase-meta"],[1,"meta-item"],["class","qc-content",4,"ngIf","ngIfElse"],[1,"qc-content"],[1,"qc-summary"],[1,"summary-row"],[1,"summary-item"],[1,"status-chip"],["novalidate","",1,"qc-form",3,"ngSubmit","formGroup"],["class","products-section","formArrayName","items",4,"ngIf","ngIfElse"],["formArrayName","items",1,"products-section"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[1,"product-cell"],[1,"product-name"],[1,"quantity"],[1,"batch"],[1,"form-field-container"],["type","number","formControlName","qcPass","min","0","step","0.01","inputmode","decimal",1,"form-control",3,"blur","keydown","max"],["class","invalid-feedback",4,"ngIf"],[1,"remarks-cell"],[1,"status-cell"],["class","saving-indicator",4,"ngIf"],[1,"invalid-feedback"],[1,"saving-indicator"],[1,"fas","fa-spinner","fa-spin"],[1,"empty-state"],[1,"fas","fa-box-open"],[1,"loading-state"],[1,"fas","fa-file-invoice"]],template:function(t,n){if(t&1&&(r(0,"div",3)(1,"button",4),d(2,"i",5),a(3," Back to Purchases "),i(),r(4,"div",6)(5,"div",7)(6,"div",8)(7,"h2",9),d(8,"i",10),a(9," Purchase QC "),i(),r(10,"span",11),a(11),i()(),h(12,Pt,18,9,"div",12),i(),h(13,yt,2,2,"ng-container",13),i()(),h(14,St,4,0,"ng-template",null,0,K)(16,It,4,0,"ng-template",null,1,K)),t&2){let c=B(15);s(10),I("pass",n.isAllQcPassed)("pending",!n.isAllQcPassed),s(),x(" ",n.isAllQcPassed?"All Passed":"Pending"," "),s(),u("ngIf",n.purchaseDetails),s(),u("ngIf",!n.isLoading)("ngIfElse",c)}},dependencies:[N,A,q,R,ne,D,T,oe,be,L,V,re,ie,se,ee,Z],styles:[".qc-purchase-container[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}@media (max-width: 768px){.qc-purchase-container[_ngcontent-%COMP%]{padding:1rem}}.back-btn[_ngcontent-%COMP%]{margin-bottom:1rem}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1.5rem;display:flex;flex-direction:column;gap:.75rem}.card-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{color:#fff;margin:0;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fffc;font-size:.85rem}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fff;font-size:1rem}.qc-content[_ngcontent-%COMP%]{padding:1.5rem 2rem 2rem}@media (max-width: 768px){.qc-content[_ngcontent-%COMP%]{padding:1rem}}.qc-summary[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1rem 1.5rem;margin-bottom:1.5rem}.qc-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem;align-items:center}.qc-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.qc-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{color:var(--text-secondary);font-size:.9rem}.qc-summary[_ngcontent-%COMP%]   .summary-row[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.1rem;font-weight:600}.status-chip[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:center;padding:.25rem .75rem;border-radius:999px;font-size:.8rem;font-weight:600;letter-spacing:.02em;text-transform:uppercase}.status-chip.header-status[_ngcontent-%COMP%]{background-color:#ffffff26;color:#fff}.status-chip.pass[_ngcontent-%COMP%]{background-color:#28a74526;color:#28a745}.status-chip.pending[_ngcontent-%COMP%]{background-color:#ffc10726;color:#ffc107}.qc-form[_ngcontent-%COMP%]{width:100%}.products-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:var(--border-radius);padding:1.5rem 1.5rem 1rem;border:1px solid var(--primary)}.table-responsive[_ngcontent-%COMP%]{margin:0 -1.5rem;padding:0 1.5rem;overflow-x:auto;min-height:300px;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{margin:0 -1rem;padding:0 1rem}}.products-table[_ngcontent-%COMP%]{width:100%;margin-bottom:0;background:#fff;border-collapse:separate;border-spacing:0}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:var(--text-primary);font-weight:600;padding:.75rem 1rem;white-space:nowrap;border-bottom:2px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{white-space:nowrap;width:1%}@media (max-width: 768px){.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}}.product-cell[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.product-cell[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.product-cell[_ngcontent-%COMP%]   .product-id[_ngcontent-%COMP%]{font-size:.75rem;color:var(--text-secondary)}.quantity[_ngcontent-%COMP%], .batch[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.remarks-cell[_ngcontent-%COMP%]{max-width:220px;font-size:.9rem;color:var(--text-secondary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.form-field-container[_ngcontent-%COMP%]{position:relative}.form-field-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px;min-width:120px}.form-field-container[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{color:var(--danger);font-size:.75rem;margin-top:.25rem}.status-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.status-cell[_ngcontent-%COMP%]   .saving-indicator[_ngcontent-%COMP%]{color:var(--primary);font-size:.9rem}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:2rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.75rem;color:var(--text-secondary);text-align:center}.loading-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:var(--primary)}@media (max-width: 576px){.card-header[_ngcontent-%COMP%]{padding:1.25rem}.card-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.5rem}.products-section[_ngcontent-%COMP%]{padding:1rem 1rem .75rem}.form-field-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{min-width:100px}}"]})}}return o})();function Et(o,m){if(o&1&&(r(0,"div",13)(1,"div",14)(2,"span"),a(3,"Invoice"),i(),r(4,"strong"),a(5),i()(),r(6,"div",14)(7,"span"),a(8,"Purchase Date"),i(),r(9,"strong"),a(10),E(11,"date"),i()(),r(12,"div",14)(13,"span"),a(14,"Customer"),i(),r(15,"strong"),a(16),i()()()),o&2){let e=p();s(5),C(e.purchaseDetails.invoiceNumber),s(5),C(k(11,3,e.purchaseDetails.purchaseDate,"dd-MM-yyyy")),s(6),C(e.purchaseDetails.customerName)}}function kt(o,m){if(o&1&&(r(0,"div",46),a(1),i()),o&2){let e=p().$implicit,t=p(4);s(),x(" Return quantity must be between 0 and ",t.getMaxReturnQuantity(e)," ")}}function wt(o,m){o&1&&(r(0,"div",46),a(1," Return not allowed: available return quantity is 0 "),i())}function Ft(o,m){if(o&1&&(r(0,"tr",37)(1,"td"),a(2),i(),r(3,"td")(4,"div",38)(5,"div",39),a(6),i()()(),r(7,"td")(8,"span",40),a(9),i()(),r(10,"td")(11,"span",41),a(12),i()(),r(13,"td")(14,"span",40),a(15),i()(),r(16,"td")(17,"div",42),d(18,"input",43),h(19,kt,2,1,"div",44)(20,wt,2,0,"div",44),i()(),r(21,"td")(22,"div",42),d(23,"input",45),i()()()),o&2){let e,t,n,c,l=m.$implicit,f=m.index,P=p(4);u("formGroupName",f),s(2),C(f+1),s(4),x(" ",((e=l.get("productName"))==null?null:e.value)||"N/A"," "),s(3),C((t=l.get("quantity"))==null?null:t.value),s(3),C(((n=l.get("batchNumber"))==null?null:n.value)||"-"),s(3),C((c=(c=l.get("qcPass"))==null?null:c.value)!==null&&c!==void 0?c:0),s(3),u("max",P.getMaxReturnQuantity(l))("disabled",P.getMaxReturnQuantity(l)<=0),s(),u("ngIf",P.isReturnQuantityInvalid(f)),s(),u("ngIf",P.getMaxReturnQuantity(l)<=0)}}function Nt(o,m){if(o&1&&(r(0,"div",33)(1,"div",34)(2,"table",35)(3,"thead")(4,"tr")(5,"th"),a(6,"No"),i(),r(7,"th"),a(8,"Product Name"),i(),r(9,"th"),a(10,"Quantity"),i(),r(11,"th"),a(12,"Batch Number"),i(),r(13,"th"),a(14,"QC Pass"),i(),r(15,"th"),a(16,"Purchase Return Quantity"),i(),r(17,"th"),a(18,"Remarks"),i()()(),r(19,"tbody"),h(20,Ft,24,10,"tr",36),i()()()()),o&2){let e=p(3);s(20),u("ngForOf",e.itemsFormArray.controls)}}function At(o,m){o&1&&(r(0,"div",47),d(1,"i",48),r(2,"p"),a(3,"No items found for this purchase."),i()())}function Rt(o,m){if(o&1){let e=O();r(0,"div",16)(1,"form",17),_("ngSubmit",function(){v(e);let n=p(2);return M(n.onSubmit())}),r(2,"div",18)(3,"div",19)(4,"div",20)(5,"label",21),d(6,"i",22),a(7," Purchase Return Date "),i(),d(8,"input",23),i(),r(9,"div",20)(10,"label",24),d(11,"i",25),a(12," Return Invoice Number "),i(),d(13,"input",26),i()()(),h(14,Nt,21,1,"div",27)(15,At,4,0,"ng-template",null,2,K),r(17,"div",28)(18,"div",29)(19,"span"),a(20,"Total Return Quantity"),i(),r(21,"strong"),a(22),E(23,"number"),i()()(),r(24,"div",30)(25,"button",31),d(26,"i",32),a(27),i()()()()}if(o&2){let e=B(16),t=p(2);s(),u("formGroup",t.returnForm),s(13),u("ngIf",t.itemsFormArray.length>0)("ngIfElse",e),s(8),C(k(23,7,t.getTotalReturnQuantity(),"1.2-2")),s(3),u("disabled",t.returnForm.invalid||t.isSaving),s(),u("ngClass",t.isSaving?"fa-spinner fa-spin":"fa-save"),s(),x(" ",t.isSaving?"Saving...":"Save Purchase Return"," ")}}function Dt(o,m){if(o&1&&(_e(0),h(1,Rt,28,10,"div",15),fe()),o&2){let e=p(),t=B(15);s(),u("ngIf",e.purchaseDetails)("ngIfElse",t)}}function Tt(o,m){o&1&&(r(0,"div",49),d(1,"i",50),r(2,"span"),a(3,"Loading purchase details..."),i()())}function qt(o,m){o&1&&(r(0,"div",47),d(1,"i",25),r(2,"p"),a(3,"Purchase details not available."),i()())}var Be=(()=>{class o{constructor(e,t,n,c,l,f){this.fb=e,this.route=t,this.purchaseService=n,this.productService=c,this.snackbar=l,this.encryptionService=f,this.isLoading=!1,this.isSaving=!1,this.products=[],this.destroy$=new w,this.returnForm=this.fb.group({purchaseId:[null],customerId:[null],purchaseReturnDate:[Y(new Date,"yyyy-MM-dd","en"),y.required],invoiceNumber:["",y.required],items:this.fb.array([])})}get itemsFormArray(){return this.returnForm.get("items")}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");if(!e){this.snackbar.error("Invalid purchase id");return}let t=this.encryptionService.decrypt(e),n=t?Number(t):NaN;if(!n||isNaN(n)){this.snackbar.error("Invalid purchase id");return}this.loadProducts(),this.loadPurchaseDetails(n)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadProducts(){this.productService.getProducts({status:"A"}).pipe(b(this.destroy$)).subscribe({next:e=>{e?.success&&e.data&&(this.products=e.data.content||e.data),this.mapProductNames()},error:()=>{this.snackbar.error("Failed to load products")}})}getMaxReturnQuantity(e){let t=Number(e.get("quantity")?.value||0),n=Number(e.get("qcPass")?.value||0),c=t-n;return isNaN(c)||c<0?0:c}loadPurchaseDetails(e){this.isLoading=!0,this.purchaseService.getPurchaseDetails(e,!0).pipe(b(this.destroy$)).subscribe({next:t=>{this.purchaseDetails=t,this.returnForm.patchValue({purchaseId:t.id,customerId:t.customerId,invoiceNumber:t.invoiceNumber?`PR-${t.invoiceNumber}`:"",isPurchaseReturn:!0});let n=t.items||[];this.buildItemsForm(n),t.purchaseReturns&&this.applyExistingPurchaseReturns(t.purchaseReturns),this.isLoading=!1},error:t=>{this.snackbar.error(t?.error?.message||"Failed to load purchase details"),this.isLoading=!1}})}buildItemsForm(e){this.itemsFormArray.clear(),e.forEach(t=>{let n=Number(t.quantity||0),c=Number(t.qcPass||0),l=Math.max(0,n-c),f=this.fb.group({purchaseItemId:[t.id],productId:[t.productId],productName:[null],quantity:[n],batchNumber:[t.batchNumber],qcPass:[c],unitPrice:[t.unitPrice],returnQuantity:[{value:null,disabled:l<=0},[y.min(0),y.max(l)]],remarks:[null]});this.itemsFormArray.push(f)}),this.mapProductNames()}applyExistingPurchaseReturns(e){if(!e)return;if(e.purchaseReturnDate){let n=Y(e.purchaseReturnDate,"yyyy-MM-dd","en");this.returnForm.get("purchaseReturnDate")?.setValue(n)}e.invoiceNumber&&this.returnForm.get("invoiceNumber")?.setValue(e.invoiceNumber);let t=new Map;(e.items||[]).forEach(n=>{n&&n.purchaseItemId!=null&&t.set(n.purchaseItemId,n)}),this.itemsFormArray.controls.forEach(n=>{let c=n.get("purchaseItemId")?.value;if(!c)return;let l=t.get(c);l&&(l.quantity!=null&&n.get("returnQuantity")?.setValue(l.quantity,{emitEvent:!1}),l.unitPrice!=null&&n.get("unitPrice")?.setValue(l.unitPrice,{emitEvent:!1}),l.remarks!=null&&n.get("remarks")?.setValue(l.remarks,{emitEvent:!1}))})}mapProductNames(){!this.products||this.products.length===0||this.itemsFormArray.controls.forEach(e=>{let t=e.get("productId")?.value;if(t){let n=this.products.find(c=>c.id===t);n&&(e.get("productName")?.setValue(n.name,{emitEvent:!1}),!e.get("unitPrice")?.value&&n.unitPrice!=null&&e.get("unitPrice")?.setValue(n.unitPrice,{emitEvent:!1}))}})}isReturnQuantityInvalid(e){let t=this.itemsFormArray.at(e).get("returnQuantity");return!t||t.disabled?!1:!!t.invalid}getTotalReturnQuantity(){return this.itemsFormArray.controls.reduce((e,t)=>{let n=t.get("returnQuantity");if(!n||n.disabled)return e;let c=Number(n.value||0);return e+(isNaN(c)?0:c)},0)}onSubmit(){if(!this.purchaseDetails){this.snackbar.error("Purchase details not loaded");return}if(this.returnForm.invalid){this.returnForm.markAllAsTouched();return}let e=this.returnForm.getRawValue(),t=(e.items||[]).filter(l=>{let f=Number(l.returnQuantity||0);return!isNaN(f)&&f>0}).map(l=>({purchaseItemId:l.purchaseItemId,productId:l.productId,quantity:Number(l.returnQuantity),unitPrice:l.unitPrice,remarks:l.remarks}));if(!t.length){this.snackbar.error("Please enter at least one return quantity greater than 0");return}let c={id:this.purchaseDetails?.purchaseReturns?.id??null,purchaseId:e.purchaseId,customerId:e.customerId,purchaseReturnDate:Y(e.purchaseReturnDate,"dd-MM-yyyy","en"),invoiceNumber:e.invoiceNumber,products:t};this.isSaving=!0,this.purchaseService.createPurchaseReturn(c).pipe(b(this.destroy$)).subscribe({next:l=>{l?.success?this.snackbar.success(l.message||"Purchase return created successfully"):this.snackbar.error(l?.message||"Failed to create purchase return"),this.isSaving=!1},error:l=>{let f=l?.error?.message||"Failed to create purchase return";this.snackbar.error(f),this.isSaving=!1}})}static{this.\u0275fac=function(t){return new(t||o)(g(z),g(ve),g($),g(ue),g(j),g(Q))}}static{this.\u0275cmp=F({type:o,selectors:[["app-add-purchase-return"]],decls:16,vars:3,consts:[["loadingTpl",""],["emptyPurchaseTpl",""],["noItemsTpl",""],[1,"add-purchase-container"],["routerLink","/purchase",1,"btn","btn-sm","btn-secondary","back-btn"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"header-main"],[1,"form-title"],[1,"fas","fa-undo-alt"],["class","purchase-meta",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"purchase-meta"],[1,"meta-item"],["class","qc-content",4,"ngIf","ngIfElse"],[1,"qc-content"],["novalidate","",1,"purchase-form",3,"ngSubmit","formGroup"],[1,"header-section"],[1,"form-row"],[1,"form-group"],["for","purchaseReturnDate"],[1,"fas","fa-calendar"],["type","date","id","purchaseReturnDate","formControlName","purchaseReturnDate",1,"form-control"],["for","invoiceNumber"],[1,"fas","fa-file-invoice"],["type","text","id","invoiceNumber","formControlName","invoiceNumber","placeholder","Enter return invoice number",1,"form-control"],["class","products-section","formArrayName","items",4,"ngIf","ngIfElse"],[1,"purchase-summary"],[1,"summary-item"],[1,"form-actions"],["type","submit",1,"btn","btn-sm","btn-primary",3,"disabled"],[1,"fas",3,"ngClass"],["formArrayName","items",1,"products-section"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[1,"product-cell"],[1,"product-name"],[1,"quantity"],[1,"batch"],[1,"form-field-container"],["type","number","formControlName","returnQuantity","min","0","step","0.01","inputmode","decimal",1,"form-control",3,"max","disabled"],["class","invalid-feedback",4,"ngIf"],["type","text","formControlName","remarks","placeholder","Remarks",1,"form-control"],[1,"invalid-feedback"],[1,"empty-state"],[1,"fas","fa-box-open"],[1,"loading-state"],[1,"fas","fa-spinner","fa-spin"]],template:function(t,n){if(t&1&&(r(0,"div",3)(1,"button",4),d(2,"i",5),a(3," Back to Purchases "),i(),r(4,"div",6)(5,"div",7)(6,"div",8)(7,"h2",9),d(8,"i",10),a(9," Purchase Return "),i(),h(10,Et,17,6,"div",11),i()(),h(11,Dt,2,2,"ng-container",12),i()(),h(12,Tt,4,0,"ng-template",null,0,K)(14,qt,4,0,"ng-template",null,1,K)),t&2){let c=B(13);s(10),u("ngIf",n.purchaseDetails),s(),u("ngIf",!n.isLoading)("ngIfElse",c)}},dependencies:[H,N,A,q,R,ne,D,T,oe,be,L,V,re,ie,se,ee,Z],styles:[".add-purchase-container[_ngcontent-%COMP%]{padding:1.5rem 2rem}.back-btn[_ngcontent-%COMP%]{margin-bottom:.75rem}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1rem 1.5rem}.card-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:1rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{margin:0;color:#fff;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.15rem}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8rem;color:#ffffffd9}.card-header[_ngcontent-%COMP%]   .purchase-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#fff;font-size:.98rem}.purchase-form[_ngcontent-%COMP%]{padding:1.5rem 1.5rem 2rem}.header-section[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1rem 1.25rem;margin-bottom:1.25rem}.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.25rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.4rem;margin-bottom:.4rem;font-weight:500;color:var(--text-primary)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.products-section[_ngcontent-%COMP%]{border-radius:var(--border-radius);border:1px solid var(--border-color);padding:1rem .75rem .5rem;background-color:#fff}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto}.products-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.products-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:#000;padding:.6rem .75rem;font-weight:600;font-size:.9rem;white-space:nowrap}.products-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem .75rem;vertical-align:middle;border-top:1px solid var(--border-color)}.product-cell[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-weight:500;color:var(--text-primary)}.quantity[_ngcontent-%COMP%], .batch[_ngcontent-%COMP%]{color:var(--text-primary)}.form-field-container[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:34px}.form-field-container[_ngcontent-%COMP%]   .invalid-feedback[_ngcontent-%COMP%]{margin-top:.15rem;font-size:.75rem;color:var(--danger)}.purchase-summary[_ngcontent-%COMP%]{margin-top:1rem;padding:.75rem 1rem;background-color:var(--background-light);border-radius:var(--border-radius);display:flex;justify-content:flex-end}.purchase-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.purchase-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.85rem;color:var(--text-secondary)}.purchase-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--text-primary)}.form-actions[_ngcontent-%COMP%]{margin-top:.75rem;display:flex;justify-content:flex-start}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:180px;display:inline-flex;align-items:center;justify-content:center;gap:.4rem}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:2rem 1rem;text-align:center;color:var(--text-secondary)}.loading-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.8rem;color:var(--primary);margin-bottom:.5rem}@media (max-width: 768px){.add-purchase-container[_ngcontent-%COMP%]{padding:1rem}.card-header[_ngcontent-%COMP%]   .header-main[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}"]})}}return o})();var Lt=()=>({label:"All Customers",value:""}),Vt=()=>({label:"All Purchases",value:""});function zt(o,m){if(o&1){let e=O();r(0,"tr")(1,"td"),a(2),i(),r(3,"td"),a(4),i(),r(5,"td"),a(6),i(),r(7,"td"),a(8),i(),r(9,"td"),a(10),i(),r(11,"td",26)(12,"button",27),_("click",function(){let n=v(e).$implicit,c=p(2);return M(c.viewDetails(n.purchaseId))}),d(13,"i",28),i(),r(14,"button",29),_("click",function(){let n=v(e).$implicit,c=p(2);return M(c.deletePurchaseReturn(n.id))}),d(15,"i",30),i()()()}if(o&2){let e=m.$implicit,t=m.index,n=p(2);s(2),C(n.startIndex+t+1),s(2),C(e.invoiceNumber),s(2),C(e.customerName),s(2),C(n.formatDate(e.purchaseReturnDate)),s(2),C(n.formatCurrency(e.totalPurchaseAmount))}}function Qt(o,m){if(o&1&&(r(0,"div",23)(1,"table",24)(2,"thead")(3,"tr")(4,"th"),a(5,"No"),i(),r(6,"th"),a(7,"Invoice No."),i(),r(8,"th"),a(9,"Customer Name"),i(),r(10,"th"),a(11,"Purchase Return Date"),i(),r(12,"th"),a(13,"Total Amount"),i(),r(14,"th"),a(15,"Actions"),i()()(),r(16,"tbody"),h(17,zt,16,5,"tr",25),i()()()),o&2){let e=p();s(17),u("ngForOf",e.purchaseReturns)}}function jt(o,m){o&1&&(r(0,"div",31),d(1,"i",32),r(2,"p"),a(3,"No purchase returns found"),i()())}function $t(o,m){if(o&1){let e=O();r(0,"app-pagination",33),_("pageChange",function(n){v(e);let c=p();return M(c.onPageChange(n))})("pageSizeChange",function(n){v(e);let c=p();return M(c.onPageSizeChange(n))}),i()}if(o&2){let e=p();u("currentPage",e.currentPage)("pageSize",e.pageSize)("totalElements",e.totalElements)("pageSizeOptions",e.pageSizeOptions)}}var Ke=(()=>{class o{constructor(e,t,n,c,l,f,P,S){this.purchaseService=e,this.customerService=t,this.fb=n,this.snackbar=c,this.dateUtils=l,this.encryptionService=f,this.router=P,this.authService=S,this.purchaseReturns=[],this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,50,100],this.totalPages=0,this.totalElements=0,this.startIndex=0,this.endIndex=0,this.customers=[],this.purchases=[],this.isLoadingCustomers=!1,this.isLoadingPurchases=!1,this.clientId=1,this.destroy$=new w,this.initializeForm()}ngOnInit(){this.loadPurchaseReturns(),this.loadCustomers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeForm(){this.searchForm=this.fb.group({search:[""],customerId:[""],purchaseId:[""],startDate:[""],endDate:[""]})}loadPurchaseReturns(){this.isLoading=!0;let e=this.searchForm.value,t={currentPage:this.currentPage,perPageRecord:this.pageSize,clientId:this.clientId,search:e.search?.trim()||void 0,customerId:e.customerId?Number(e.customerId):void 0,purchaseId:e.purchaseId?Number(e.purchaseId):void 0,startDate:e.startDate?this.dateUtils.formatDate(e.startDate):void 0,endDate:e.endDate?this.dateUtils.formatDate(e.endDate):void 0};Object.keys(t).forEach(n=>{t[n]===void 0&&delete t[n]}),this.purchaseService.searchPurchaseReturn(t).pipe(b(this.destroy$)).subscribe({next:n=>{this.purchaseReturns=n.content||[],this.totalPages=n.totalPages||0,this.totalElements=n.totalElements||0,this.updatePaginationIndexes(),this.isLoading=!1},error:n=>{this.snackbar.error(n?.error?.message||"Failed to load purchase returns"),this.isLoading=!1}})}updatePaginationIndexes(){this.startIndex=this.currentPage*this.pageSize,this.endIndex=Math.min((this.currentPage+1)*this.pageSize,this.totalElements)}onSearch(e){e&&(e.preventDefault(),e.stopPropagation()),this.currentPage=0,this.loadPurchaseReturns()}resetForm(){this.searchForm.reset(),this.currentPage=0,this.loadPurchaseReturns()}onPageChange(e){this.currentPage=e,this.loadPurchaseReturns()}onPageSizeChange(e){this.pageSize=e,this.currentPage=0,this.loadPurchaseReturns()}loadCustomers(){this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(b(this.destroy$)).subscribe({next:e=>{e?.success&&e.data&&(this.customers=e.data),this.isLoadingCustomers=!1},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1}})}refreshCustomers(){this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(b(this.destroy$)).subscribe({next:e=>{e?.success&&e.data&&(this.customers=e.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1},error:()=>{this.snackbar.error("Failed to refresh customers"),this.isLoadingCustomers=!1}})}loadPurchasesForCustomer(e){if(!e){this.purchases=[];return}this.isLoadingPurchases=!0;let t={currentPage:0,perPageRecord:1e3,customerId:e};this.purchaseService.searchPurchases(t).pipe(b(this.destroy$)).subscribe({next:n=>{this.purchases=n.content||[],this.isLoadingPurchases=!1},error:()=>{this.snackbar.error("Failed to load purchases"),this.purchases=[],this.isLoadingPurchases=!1}})}onCustomerChange(e){e?this.loadPurchasesForCustomer(Number(e)):(this.purchases=[],this.searchForm.patchValue({purchaseId:""}))}viewDetails(e){let t=this.encryptionService.encrypt(e.toString());this.router.navigate(["/purchase/return",t])}formatDate(e){return e?this.dateUtils.formatDate(e):""}formatCurrency(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2,maximumFractionDigits:2}).format(e||0)}deletePurchaseReturn(e){confirm("Are you sure you want to delete this purchase return? This action cannot be undone.")&&(this.isLoading=!0,this.purchaseService.deletePurchaseReturn(e).pipe(b(this.destroy$)).subscribe({next:t=>{t?.success?(this.snackbar.success(t.message||"Purchase return deleted successfully"),this.loadPurchaseReturns()):(this.snackbar.error(t?.message||"Failed to delete purchase return"),this.isLoading=!1)},error:t=>{this.snackbar.error(t?.error?.message||"Failed to delete purchase return"),this.isLoading=!1}}))}static{this.\u0275fac=function(t){return new(t||o)(g($),g(de),g(z),g(j),g(Oe),g(Q),g(ce),g(Me))}}static{this.\u0275cmp=F({type:o,selectors:[["app-purchase-return-list"]],decls:33,vars:16,consts:[[1,"purchase-return-container"],[3,"show"],[1,"search-section","card"],[3,"ngSubmit","touchstart","formGroup"],[1,"search-controls"],[1,"form-group"],["type","text","formControlName","search","placeholder","Search by invoice number...",1,"form-control",3,"touchstart"],[1,"select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"valueChange","options","defaultOption","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],[1,"fas",3,"ngClass"],["formControlName","purchaseId","labelKey","invoiceNumber","valueKey","id",3,"options","defaultOption","searchPlaceholder","disabled"],["type","date","formControlName","startDate","placeholder","Start Date",1,"form-control",3,"touchstart"],["type","date","formControlName","endDate","placeholder","End Date",1,"form-control",3,"touchstart"],[1,"button-group"],["type","submit",1,"search-btn","btn","btn-sm","btn-primary",3,"touchstart"],[1,"fas","fa-search"],["type","button",1,"search-btn","btn","btn-sm","btn-secondary",3,"click","touchstart"],[1,"fas","fa-undo"],[1,"purchase-returns-list","card"],["class","table-responsive",4,"ngIf"],["class","empty-state",4,"ngIf"],[3,"currentPage","pageSize","totalElements","pageSizeOptions","pageChange","pageSizeChange",4,"ngIf"],[1,"table-responsive"],[1,"table"],[4,"ngFor","ngForOf"],[1,"actions"],["title","View Details",1,"btn-icon","view",3,"click"],[1,"fas","fa-eye"],["title","Delete Purchase Return",1,"btn-icon","delete",3,"click"],[1,"fas","fa-trash"],[1,"empty-state"],[1,"fas","fa-inbox"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalElements","pageSizeOptions"]],template:function(t,n){if(t&1&&(r(0,"div",0),d(1,"app-loader",1),r(2,"div",2)(3,"h2"),a(4,"Search Purchase Returns"),i(),r(5,"form",3),_("ngSubmit",function(l){return n.onSearch(l)})("touchstart",function(l){return l.stopPropagation()}),r(6,"div",4)(7,"div",5)(8,"input",6),_("touchstart",function(l){return l.stopPropagation()}),i()(),r(9,"div",5)(10,"div",7)(11,"app-searchable-select",8),_("valueChange",function(l){return n.onCustomerChange(l)}),i(),r(12,"button",9),_("click",function(){return n.refreshCustomers()})("touchstart",function(l){return l.stopPropagation()}),d(13,"i",10),i()()(),r(14,"div",5),d(15,"app-searchable-select",11),i(),r(16,"div",5)(17,"input",12),_("touchstart",function(l){return l.stopPropagation()}),i()(),r(18,"div",5)(19,"input",13),_("touchstart",function(l){return l.stopPropagation()}),i()(),r(20,"div",14)(21,"button",15),_("touchstart",function(l){return l.stopPropagation()}),d(22,"i",16),a(23," Search "),i(),r(24,"button",17),_("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),d(25,"i",18),a(26," Reset "),i()()()()(),r(27,"div",19)(28,"h2"),a(29,"Purchase Returns"),i(),h(30,Qt,18,1,"div",20)(31,jt,4,0,"div",21)(32,$t,1,4,"app-pagination",22),i()()),t&2){let c;s(),u("show",n.isLoading),s(4),u("formGroup",n.searchForm),s(6),u("options",n.customers)("defaultOption",me(14,Lt))("searchPlaceholder","Search customers..."),s(),u("disabled",n.isLoadingCustomers),s(),u("ngClass",n.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt"),s(2),u("options",n.purchases)("defaultOption",me(15,Vt))("searchPlaceholder","Search purchases...")("disabled",!((c=n.searchForm.get("customerId"))!=null&&c.value)||n.isLoadingPurchases),s(15),u("ngIf",n.purchaseReturns.length>0),s(),u("ngIf",!n.isLoading&&n.purchaseReturns.length===0),s(),u("ngIf",n.totalPages>0)}},dependencies:[H,N,A,q,R,D,T,L,V,W,J,le],styles:[".purchase-return-container[_ngcontent-%COMP%]{padding:2rem;position:relative;min-height:200px;background-color:var(--background)}.purchase-return-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;padding:20px}.purchase-return-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--text-primary);font-size:1.5rem;font-weight:600}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:flex-start}@media (max-width: 768px){.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{grid-template-columns:1fr}}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin:0}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px;width:100%;padding:10px;border:1px solid var(--supporting);border-radius:4px;font-size:14px;transition:all .3s ease}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px #1458811a}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]::placeholder{color:var(--text-secondary)}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%], .purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]{width:40px;height:40px;padding:0;display:flex;align-items:center;justify-content:center;border:none;border-radius:4px;background-color:var(--primary);color:#fff;cursor:pointer;transition:all .3s ease;margin-top:0}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:hover:not(:disabled), .purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0d3a55;transform:translateY(-1px)}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:disabled, .purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}@media (max-width: 768px){.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{grid-column:1/-1}}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;height:40px;display:flex;align-items:center;justify-content:center;gap:.5rem;border:none;border-radius:4px;font-weight:500;cursor:pointer;transition:all .3s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:active{transform:scale(.98)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto;margin:0 -1px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;min-width:800px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px;text-align:left;border-bottom:1px solid var(--border)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background);color:var(--text-primary);font-weight:500}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{color:var(--text-secondary)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:32px;height:32px;padding:0;display:flex;align-items:center;justify-content:center;border-radius:4px;border:none;cursor:pointer;transition:all .3s ease}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]{background-color:var(--primary-light);color:var(--primary)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:hover{background-color:var(--primary);color:#fff}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{background-color:var(--danger-light);color:var(--danger)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:var(--danger);color:#fff}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{margin-bottom:20px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:.5px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle;color:var(--text-primary)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{text-align:center;padding:60px 20px;color:var(--text-secondary)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:48px;margin-bottom:16px;opacity:.5}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;margin:0}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-start!important}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center;border:none;border-radius:6px;cursor:pointer;transition:all .2s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.view[_ngcontent-%COMP%]{color:var(--primary);background-color:#1458811a}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.view[_ngcontent-%COMP%]:hover{background-color:var(--primary);color:#fff;transform:translateY(-1px)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff;transform:translateY(-1px)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:active{transform:translateY(0) scale(.95)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-top:20px;padding-top:20px;border-top:1px solid var(--border)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]   .pagination-info[_ngcontent-%COMP%]{color:var(--text-secondary)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]   .pagination[_ngcontent-%COMP%]{display:flex;gap:5px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]   .pagination[_ngcontent-%COMP%]   .btn-page[_ngcontent-%COMP%]{min-width:32px;height:32px;padding:0 8px;display:flex;align-items:center;justify-content:center;border:1px solid var(--border);background:#fff;color:var(--text-secondary);border-radius:4px;cursor:pointer;transition:all .3s ease}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]   .pagination[_ngcontent-%COMP%]   .btn-page[_ngcontent-%COMP%]:hover:not(:disabled){border-color:var(--primary);color:var(--primary)}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]   .pagination[_ngcontent-%COMP%]   .btn-page.active[_ngcontent-%COMP%]{background:var(--primary);border-color:var(--primary);color:#fff}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .pagination-container[_ngcontent-%COMP%]   .pagination[_ngcontent-%COMP%]   .btn-page[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}@media (max-width: 768px){.purchase-return-container[_ngcontent-%COMP%]{padding:1rem}.purchase-return-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:16px}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]{flex-direction:column}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]{width:100%;margin-top:.5rem}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{min-width:800px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:32px;height:32px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:12px}}@media (max-width: 576px){.purchase-return-container[_ngcontent-%COMP%]{padding:.75rem}.purchase-return-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:12px;margin-bottom:16px}.purchase-return-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem;margin-bottom:16px}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{gap:.75rem}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{flex-direction:column}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}@media (hover: none) and (pointer: coarse){.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{font-size:16px}.purchase-return-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-height:44px}.purchase-return-container[_ngcontent-%COMP%]   .purchase-returns-list[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{min-width:44px;min-height:44px}}"]})}}return o})();var Gt=[{path:"",component:$e},{path:"create",component:we},{path:"edit/:id",component:we},{path:"qc/:id",component:Ue},{path:"return/:id",component:Be},{path:"return",component:Ke}],Ye=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=he({type:o})}static{this.\u0275inj=ge({imports:[U.forChild(Gt),U]})}}return o})();var Jn=(()=>{class o{static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275mod=he({type:o})}static{this.\u0275inj=ge({imports:[te,ae,U,Ye,W,J,le]})}}return o})();export{Jn as PurchaseModule};
