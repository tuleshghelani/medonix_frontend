<div class="ledger-container">
  <app-loader [show]="isLoading || isGeneratingPdf"></app-loader>

  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">
        <i class="fas fa-file-invoice-dollar"></i>
      </div>
      <div class="header-text">
        <h1>Ledger Report</h1>
        <p>Generate customer ledger reports with custom date ranges</p>
      </div>
    </div>
  </div>

  <!-- Filter Card -->
  <div class="filter-card card">
    <div class="card-header">
      <h2><i class="fas fa-filter"></i> Report Filters</h2>
    </div>

    <form [formGroup]="ledgerForm" (ngSubmit)="generatePdf($event)" class="filter-form">
      <div class="filter-grid">
        <!-- Customer Selection -->
        <div class="form-group customer-group">
          <label for="customerId">
            <i class="fas fa-user"></i> Select Customer <span class="required">*</span>
          </label>
          <div class="select-group inline">
            <app-searchable-select
              formControlName="customerId"
              [options]="customers"
              labelKey="name"
              valueKey="id"
              [placeholder]="'Select Customer'"
              [searchPlaceholder]="'Search customers...'"
              [class.is-invalid]="isFieldInvalid('customerId')"
            ></app-searchable-select>
            <button
              type="button"
              class="btn btn-sm btn-primary refresh-btn"
              (click)="refreshCustomers()"
              [disabled]="isLoadingCustomers"
              title="Refresh Customers"
            >
              <i class="fas" [ngClass]="isLoadingCustomers ? 'fa-spinner fa-spin' : 'fa-sync-alt'"></i>
            </button>
          </div>
          <div class="invalid-feedback" *ngIf="isFieldInvalid('customerId')">
            Please select a customer
          </div>
        </div>

        <!-- Start Date -->
        <div class="form-group">
          <label for="startDate">
            <i class="fas fa-calendar-alt"></i> Start Date <span class="required">*</span>
          </label>
          <input
            type="date"
            id="startDate"
            formControlName="startDate"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('startDate')"
          >
          <div class="invalid-feedback" *ngIf="isFieldInvalid('startDate')">
            Start date is required
          </div>
        </div>

        <!-- End Date -->
        <div class="form-group">
          <label for="endDate">
            <i class="fas fa-calendar-check"></i> End Date <span class="required">*</span>
          </label>
          <input
            type="date"
            id="endDate"
            formControlName="endDate"
            class="form-control"
            [class.is-invalid]="isFieldInvalid('endDate')"
          >
          <div class="invalid-feedback" *ngIf="isFieldInvalid('endDate')">
            End date is required
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="resetForm()"
          [disabled]="isGeneratingPdf"
        >
          <i class="fas fa-undo"></i> Reset
        </button>
        <button
          type="submit"
          class="btn btn-primary generate-btn"
          [disabled]="ledgerForm.invalid || isGeneratingPdf"
        >
          <i class="fas" [ngClass]="isGeneratingPdf ? 'fa-spinner fa-spin' : 'fa-file-pdf'"></i>
          {{ isGeneratingPdf ? 'Generating...' : 'Generate PDF' }}
        </button>
      </div>
    </form>
  </div>

  <!-- Info Card -->
  <div class="info-card card">
    <div class="info-header">
      <i class="fas fa-info-circle"></i>
      <h3>How to Generate Report</h3>
    </div>
    <div class="info-content">
      <div class="info-step">
        <div class="step-number">1</div>
        <div class="step-text">Select a customer from the dropdown</div>
      </div>
      <div class="info-step">
        <div class="step-number">2</div>
        <div class="step-text">Choose the start and end date for the report period</div>
      </div>
      <div class="info-step">
        <div class="step-number">3</div>
        <div class="step-text">Click "Generate PDF" to download the ledger report</div>
      </div>
    </div>
  </div>

  <!-- Preview Section (when customer is selected) -->
  <div class="preview-card card" *ngIf="ledgerForm.get('customerId')?.value">
    <div class="preview-header">
      <i class="fas fa-eye"></i>
      <h3>Report Preview</h3>
    </div>
    <div class="preview-content">
      <div class="preview-item">
        <span class="preview-label">Customer</span>
        <span class="preview-value">{{ getSelectedCustomerName() }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Date Range</span>
        <span class="preview-value">
          {{ ledgerForm.get('startDate')?.value | date:'dd MMM yyyy' }}
          <i class="fas fa-arrow-right"></i>
          {{ ledgerForm.get('endDate')?.value | date:'dd MMM yyyy' }}
        </span>
      </div>
    </div>
  </div>
</div>
