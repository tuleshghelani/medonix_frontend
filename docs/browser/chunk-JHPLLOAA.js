import{A as s,Tb as g,Yb as a,Zb as p,_a as l,g as f,h as m,i as c,n as S,v as n,x as h}from"./chunk-SOOHBEPN.js";var i=function(r){return r.ADMIN="ADMIN",r.STAFF_ADMIN="STAFF_ADMIN",r.DISPATCH="DISPATCH",r.SALES_AND_MARKETING="SALES_AND_MARKETING",r.DEALER="DEALER",r.HR="HR",r.REPORTER="REPORTER",r}(i||{}),k=(()=>{class r{constructor(t,e,o){this.http=t,this.encryptionService=e,this.router=o,this.authStateSubject=new f(this.isAuthenticated()),this.authState$=this.authStateSubject.asObservable(),this.refreshTokenInProgress=!1}login(t){return this.http.post(`${a.apiUrl}/api/auth/login`,t).pipe(n(e=>{localStorage.setItem("token",e.accessToken),localStorage.setItem("user",JSON.stringify({firstName:e.firstName,lastName:e.lastName,email:e.email}));let o=this.encryptionService.encrypt(e.refreshToken);localStorage.setItem("refreshToken",o);let u=this.encryptionService.encrypt(e.roles);localStorage.setItem("userRoles",u),this.authStateSubject.next(!0)}))}hasAnyRole(t){let e=this.getUserRoles();return t.some(o=>e.includes(o))}refreshToken(){if(this.refreshTokenInProgress)return c(()=>new Error("Refresh token request in progress"));this.refreshTokenInProgress=!0;let t=localStorage.getItem("refreshToken");if(!t)return this.handleAuthError(),c(()=>new Error("No refresh token available"));let e=this.encryptionService.decrypt(t);return this.http.post(`${a.apiUrl}/api/refresh-token/new`,{refreshToken:e},{headers:{}}).pipe(n(o=>{if(o.success){localStorage.setItem("token",o.data.token);let u=this.encryptionService.encrypt(o.data.refreshToken);localStorage.setItem("refreshToken",u)}this.refreshTokenInProgress=!1}),S(o=>(this.refreshTokenInProgress=!1,o.status===400&&this.handleAuthError(),c(()=>o))))}handleAuthError(){this.logout(),window.location.href=window.location.origin+"/login?_t="+new Date().getTime()}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("refreshToken"),localStorage.clear(),this.authStateSubject.next(!1)}isAuthenticated(){return!!localStorage.getItem("token")}getToken(){return localStorage.getItem("token")}getUserRoles(){let t=localStorage.getItem("userRoles");if(!t)return[];let e=this.encryptionService.decrypt(t);return console.log(e),e.replace("[","").replace("]","").split(",").map(o=>o.trim())}hasRole(t){return this.getUserRoles().includes(t)}isAdmin(){return this.hasRole("ADMIN")}isProductManager(){return this.hasRole("STAFF_ADMIN")}isStaffAdmin(){return this.hasRole(i.STAFF_ADMIN)}getDefaultRoute(){let t=this.getUserRoles();return t.includes(i.ADMIN)||t.includes(i.SALES_AND_MARKETING)?"/category":t.includes(i.HR)?"/employee":t.includes(i.DISPATCH)?"/category":"/login"}static{this.\u0275fac=function(e){return new(e||r)(s(l),s(p),s(g))}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var j=(()=>{class r{constructor(t,e){this.http=t,this.encryptionService=e,this.apiUrl=`${a.apiUrl}/api/transports`,this.CACHE_KEY="active_transports"}create(t){return this.http.post(this.apiUrl,t)}update(t){return this.http.put(this.apiUrl,t)}delete(t){return this.http.request("DELETE",this.apiUrl,{body:{id:t}})}getTransports(t){if(t?.status==="A"){let e=localStorage.getItem(this.CACHE_KEY);if(e){let o=this.encryptionService.decrypt(e);if(o)return m(o)}}return this.http.post(`${this.apiUrl}/getTransports`,{search:t?.search}).pipe(n(e=>{if(t?.status==="A"&&e?.success){let o=this.encryptionService.encrypt(e);localStorage.setItem(this.CACHE_KEY,o)}}))}refreshTransports(){return localStorage.removeItem(this.CACHE_KEY),this.getTransports({status:"A"})}search(t){return this.http.post(`${this.apiUrl}/search`,t)}details(t){return this.http.post(`${this.apiUrl}/details`,{id:t})}static{this.\u0275fac=function(e){return new(e||r)(s(l),s(p))}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{i as a,k as b,j as c};
