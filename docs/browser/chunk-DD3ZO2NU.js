import{a as $t}from"./chunk-SVBUHBIG.js";import{c as zt,d as jt}from"./chunk-WYYFELHO.js";import{b as H}from"./chunk-GC4KDOX7.js";import{a as W,b as Ct}from"./chunk-44VES7CY.js";import{b as _t,c as tt,d as bt}from"./chunk-PGE6QRUW.js";import{$b as et,Ab as ut,C as D,D as st,Db as B,Eb as mt,Fb as Tt,Ga as ct,H as h,Hb as q,I as f,Ib as pt,Jb as gt,Ka as k,Kb as G,La as It,Ma as w,Pa as N,Pb as ht,Rb as ft,Sa as T,Sb as Y,Ta as R,Tb as Rt,U as s,Ua as L,Ub as Lt,V as p,Va as V,Vb as Vt,Xa as lt,Xb as U,Ya as dt,Yb as Z,_a as Dt,a as rt,aa as C,b as At,bb as Nt,bc as Q,ca as d,e as ot,ea as O,f as I,ha as o,ia as r,ja as u,ma as y,o as X,pa as m,q as it,qa as g,u as b,wa as i,wb as z,wc as K,xa as S,xb as x,xc as E,y as at,ya as F,yb as j,zb as $,zc as A}from"./chunk-RL35WT5O.js";var Kt=()=>({label:"All Customers",value:""});function Wt(c,_){if(c&1){let t=y();o(0,"div",6)(1,"div",31),u(2,"app-searchable-select",32),o(3,"button",33),m("click",function(){h(t);let n=g();return f(n.refreshCustomers())}),u(4,"i",34),r()()()}if(c&2){let t=g();s(2),d("options",t.customers)("defaultOption",ct(5,Kt))("searchPlaceholder","Search customers..."),s(),d("disabled",t.isLoadingCustomers),s(),d("ngClass",t.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt")}}function Ht(c,_){if(c&1){let t=y();o(0,"button",35),m("click",function(){h(t);let n=g();return f(n.exportExcel())}),u(1,"i",36),i(2," Export "),r()}if(c&2){let t=g();d("disabled",t.isExportButtonDisabled())}}function Jt(c,_){if(c&1){let t=y();o(0,"div",37)(1,"button",38),m("click",function(){h(t);let n=g();return f(n.clearLocalStorage())}),u(2,"i",39),i(3," Add Sale "),r()()}}function Xt(c,_){c&1&&(o(0,"th",27),i(1,"Actions"),r())}function Zt(c,_){if(c&1){let t=y();o(0,"td",47)(1,"button",48),m("click",function(){h(t);let n=g().$implicit,a=g();return f(a.generatePdf(n.id,n.invoiceNumber))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(2,"i",49),r(),o(3,"button",50),m("click",function(){h(t);let n=g().$implicit,a=g();return f(a.editSales(n.id))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(4,"i",51),r(),o(5,"button",52),m("click",function(){h(t);let n=g().$implicit,a=g();return f(a.deleteSale(n.id))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(6,"i",53),r()()}}function te(c,_){if(c&1&&(o(0,"tr",40)(1,"td",41),i(2),r(),o(3,"td",42)(4,"strong"),i(5),r()(),o(6,"td",43),i(7),r(),o(8,"td",44),i(9),k(10,"date"),r(),o(11,"td",45)(12,"strong"),i(13),k(14,"round"),r()(),C(15,Zt,7,0,"td",46),r()),c&2){let t,e=_.$implicit,n=_.index,a=g();s(2),S(a.startIndex+n+1),s(3),S(e==null?null:e.invoiceNumber),s(2),S(e!=null&&e.customerName?e==null?null:e.customerName:"-"),s(2),S(w(10,6,e==null?null:e.saleDate,"dd-MM-yyyy")),s(4),S(It(14,9,(t=e==null?null:e.totalSaleAmount)!==null&&t!==void 0?t:0)),s(2),d("ngIf",a.canManageSales)}}function ee(c,_){if(c&1){let t=y();o(0,"app-pagination",54),m("pageChange",function(n){h(t);let a=g();return f(a.onPageChange(n))})("pageSizeChange",function(n){h(t);let a=g();return f(a.onPageSizeChange(n))}),r()}if(c&2){let t=g();d("currentPage",t.currentPage)("pageSize",t.pageSize)("totalElements",t.totalElements)("pageSizeOptions",t.pageSizeOptions)}}var Bt=(()=>{class c{constructor(t,e,n,a,l,P,M,v,J){this.saleService=t,this.customerService=e,this.fb=n,this.snackbar=a,this.dateUtils=l,this.encryptionService=P,this.router=M,this.authService=v,this.cdr=J,this.sales=[],this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,50,100],this.totalPages=0,this.totalElements=0,this.startIndex=0,this.endIndex=0,this.customers=[],this.isLoadingCustomers=!1,this.canManageSales=!1,this.destroy$=new I,this.initializeForm()}ngOnInit(){this.canManageSales=this.authService.isAdmin()||this.authService.isStaffAdmin(),this.loadSales(),this.canManageSales&&this.loadCustomers()}initializeForm(){this.searchForm=this.fb.group({search:[""],customerId:[""],startDate:[""],endDate:[""],batchNumber:[""]})}onSearch(){this.currentPage=0,this.loadSales()}downloadFile(t,e){let n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n)}onPageChange(t){this.currentPage=t,this.loadSales()}onPageSizeChange(t){this.pageSize=t,this.currentPage=0,this.loadSales()}deleteSale(t){confirm("Are you sure you want to delete this sale? This action cannot be undone.")&&(this.isLoading=!0,this.saleService.deleteSale(t).pipe(b(this.destroy$)).subscribe({next:e=>{e.success?(this.snackbar.success("Sale deleted successfully"),this.loadSales()):(this.snackbar.error(e.message||"Failed to delete sale"),this.isLoading=!1,this.cdr.markForCheck())},error:e=>{this.snackbar.error(e?.error?.message||"Failed to delete sale"),this.isLoading=!1,this.cdr.markForCheck()}}))}formatDate(t){return this.dateUtils.formatDate(t)}resetForm(){this.searchForm.reset(),this.currentPage=0,this.loadSales()}loadCustomers(){this.canManageSales&&(this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(b(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}refreshCustomers(){this.canManageSales&&(this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(b(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to refresh customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}editSales(t){localStorage.setItem("saleId",this.encryptionService.encrypt(t.toString())),this.router.navigate(["/sale/create"])}addSaleReturn(t){let e=this.encryptionService.encrypt(t.toString());this.router.navigate(["/sale/return",e])}generatePdf(t,e){this.saleService.generatePdf(t).pipe(b(this.destroy$)).subscribe({next:({blob:n,filename:a})=>{let l=e?`sale-${e}.pdf`:a;this.downloadFile(n,l),this.snackbar.success("PDF downloaded successfully")},error:n=>{this.snackbar.error(n?.error?.message||"Failed to generate PDF")}})}isExportButtonDisabled(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;return!t||!e}exportExcel(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;if(!t||!e){this.snackbar.error("Please select both start date and end date to export");return}let n=this.dateUtils.formatDateDDMMYYYY(t),a=this.dateUtils.formatDateDDMMYYYY(e);this.isLoading=!0,this.saleService.exportExcel({startDate:n,endDate:a}).pipe(b(this.destroy$)).subscribe({next:({blob:l,filename:P})=>{let M=P||`sale_export_${n}_${a}.xlsx`;this.downloadFile(l,M),this.snackbar.success("Excel file downloaded successfully"),this.isLoading=!1,this.cdr.markForCheck()},error:l=>{this.snackbar.error(l?.error?.message||"Failed to export Excel file"),this.isLoading=!1,this.cdr.markForCheck()}})}loadSales(){this.isLoading=!0;let t=rt({currentPage:this.currentPage,perPageRecord:this.pageSize,startDate:this.searchForm.value.startDate?this.dateUtils.formatDate(this.searchForm.value.startDate):"",endDate:this.searchForm.value.endDate?this.dateUtils.formatDate(this.searchForm.value.endDate):""},this.searchForm.value);this.saleService.searchSales(t).pipe(b(this.destroy$)).subscribe({next:e=>{this.sales=e.content,this.totalPages=e.totalPages,this.totalElements=e.totalElements,this.startIndex=this.currentPage*this.pageSize,this.endIndex=Math.min((this.currentPage+1)*this.pageSize,this.totalElements),this.isLoading=!1,this.cdr.markForCheck()},error:e=>{this.snackbar.error(e.message||"Failed to load sales"),this.isLoading=!1,this.cdr.markForCheck()}})}clearLocalStorage(){localStorage.removeItem("saleId"),this.router.navigate(["/sale/create"])}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(e){return new(e||c)(p(H),p(W),p(Y),p(K),p(Ct),p(Q),p(U),p(_t),p(N))}}static{this.\u0275cmp=D({type:c,selectors:[["app-sale"]],decls:53,vars:8,consts:[[1,"sales-container"],[3,"show"],["aria-labelledby","search-sales-heading",1,"search-section","card"],["id","search-sales-heading"],["role","search","aria-label","Sale search form",3,"ngSubmit","formGroup"],[1,"search-controls"],[1,"form-group"],["for","invoice-search",1,"sr-only"],["id","invoice-search","type","text","formControlName","search","placeholder","Search by invoice number...","aria-label","Search by invoice number",1,"form-control"],["for","batch-search",1,"sr-only"],["id","batch-search","type","text","formControlName","batchNumber","placeholder","Search by Batch Number...","aria-label","Search by batch number",1,"form-control"],["class","form-group",4,"ngIf"],["for","start-date",1,"sr-only"],["id","start-date","type","date","formControlName","startDate","placeholder","Start Date","aria-label","Start date",1,"form-control",3,"touchstart"],["for","end-date",1,"sr-only"],["id","end-date","type","date","formControlName","endDate","placeholder","End Date","aria-label","End date",1,"form-control",3,"touchstart"],[1,"button-group"],["type","submit",1,"search-btn","btn","btn-sm","btn-primary"],[1,"fas","fa-search"],["type","button",1,"search-btn","btn","btn-sm","btn-secondary",3,"click"],[1,"fas","fa-undo"],["type","button","class","search-btn btn btn-sm btn-success export-btn","title","Export sales to Excel",3,"disabled","click",4,"ngIf"],["class","action-header",4,"ngIf"],["aria-labelledby","sales-heading",1,"sales-list","card"],["id","sales-heading"],[1,"table-responsive"],["role","table","aria-label","Sales list",1,"table"],["scope","col"],["scope","col",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],[3,"currentPage","pageSize","totalElements","pageSizeOptions","pageChange","pageSizeChange",4,"ngIf"],[1,"product-select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","defaultOption","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",2,"margin-top","3px",3,"click","disabled"],[1,"fas",3,"ngClass"],["type","button","title","Export sales to Excel",1,"search-btn","btn","btn-sm","btn-success","export-btn",3,"click","disabled"],[1,"fas","fa-file-excel"],[1,"action-header"],["aria-label","Add new sale",1,"btn","btn-sm","btn-primary","mb-2",3,"click"],["aria-hidden","true",1,"fas","fa-plus"],["role","row"],["data-label","No"],["data-label","Invoice No."],["data-label","Customer Name"],["data-label","Sale Date"],["data-label","Total Sales Amount"],["class","actions","data-label","Actions",4,"ngIf"],["data-label","Actions",1,"actions"],["aria-label","Export sale as PDF",1,"btn-icon","pdf",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-file-pdf"],["aria-label","View sale details",1,"btn-icon","edit",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-eye"],["aria-label","Delete sale",1,"btn-icon","delete",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-trash"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalElements","pageSizeOptions"]],template:function(e,n){e&1&&(o(0,"div",0),u(1,"app-loader",1),o(2,"section",2)(3,"h2",3),i(4,"Search Sales"),r(),o(5,"form",4),m("ngSubmit",function(){return n.onSearch()}),o(6,"div",5)(7,"div",6)(8,"label",7),i(9,"Search by invoice number"),r(),u(10,"input",8),o(11,"label",9),i(12,"Search by batch number"),r(),u(13,"input",10),r(),C(14,Wt,5,6,"div",11),o(15,"div",6)(16,"label",12),i(17,"Start date"),r(),o(18,"input",13),m("touchstart",function(l){return l.stopPropagation()}),r()(),o(19,"div",6)(20,"label",14),i(21,"End date"),r(),o(22,"input",15),m("touchstart",function(l){return l.stopPropagation()}),r()(),o(23,"div",16)(24,"button",17),u(25,"i",18),i(26," Search "),r(),o(27,"button",19),m("click",function(){return n.resetForm()}),u(28,"i",20),i(29," Reset "),r(),C(30,Ht,3,1,"button",21),r()()()(),C(31,Jt,4,0,"div",22),o(32,"section",23)(33,"h2",24),i(34,"Sales"),r(),o(35,"div",25)(36,"table",26)(37,"thead")(38,"tr")(39,"th",27),i(40,"No"),r(),o(41,"th",27),i(42,"Invoice No."),r(),o(43,"th",27),i(44,"Customer Name"),r(),o(45,"th",27),i(46,"Sale Date"),r(),o(47,"th",27),i(48,"Total Sales Amount"),r(),C(49,Xt,2,0,"th",28),r()(),o(50,"tbody"),C(51,te,16,11,"tr",29),r()()(),C(52,ee,1,4,"app-pagination",30),r()()),e&2&&(s(),d("show",n.isLoading),s(4),d("formGroup",n.searchForm),s(9),d("ngIf",n.canManageSales),s(16),d("ngIf",n.canManageSales),s(),d("ngIf",n.canManageSales),s(18),d("ngIf",n.canManageSales),s(2),d("ngForOf",n.sales),s(),d("ngIf",n.totalPages>0))},dependencies:[R,L,V,B,z,j,$,q,G,E,A,tt,lt,$t],styles:[".sales-container[_ngcontent-%COMP%]{padding:2rem;position:relative;min-height:200px;background-color:var(--background)}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border-radius:0;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;padding:20px}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--text-primary);font-size:1.5rem;font-weight:600}.sales-container[_ngcontent-%COMP%]   .action-header[_ngcontent-%COMP%]{margin-bottom:1rem}.sales-container[_ngcontent-%COMP%]   .action-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{touch-action:manipulation;-webkit-tap-highlight-color:transparent}.sales-container[_ngcontent-%COMP%]   .sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:flex-start}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{grid-template-columns:1fr}}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin:0}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{grid-column:1/-1}}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:120px;height:42px;display:flex;align-items:center;justify-content:center;gap:.5rem;transition:all .2s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent;cursor:pointer}@media (max-width: 576px){.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100%;flex:1 1 100%}}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:1px solid #28a745;font-weight:500}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838;border-color:#1e7e34;transform:translateY(-1px);box-shadow:0 2px 4px #28a7454d}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:active:not(:disabled), .sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:focus:not(:disabled){outline:2px solid rgba(40,167,69,.5);outline-offset:2px;transform:translateY(0)}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:disabled{background-color:#6c757d;border-color:#6c757d;opacity:.6;cursor:not-allowed;transform:none}.sales-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap;font-weight:600}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;border:1px solid #dee2e6;border-radius:4px;padding:.5rem}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border:none;border-bottom:1px solid #f0f0f0}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);font-weight:600;color:var(--text-primary)}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-bottom:none}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]{justify-content:flex-start;flex-wrap:wrap;gap:.5rem}.sales-container[_ngcontent-%COMP%]   .sales-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]:before{display:none}}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{color:var(--text-secondary);white-space:nowrap}.sales-container[_ngcontent-%COMP%]   .table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{width:auto;min-width:80px;padding:.5rem;margin-bottom:0}@media (max-width: 768px){.sales-container[_ngcontent-%COMP%]{padding:1rem}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{width:100%}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{touch-action:manipulation;-webkit-appearance:none}.sales-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:1rem}}@media (max-width: 576px){.sales-container[_ngcontent-%COMP%]{padding:.75rem}.sales-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}.table-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;align-items:flex-start}.table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]{width:100%}.table-controls[_ngcontent-%COMP%]   .page-size-selector[_ngcontent-%COMP%]   select.form-control[_ngcontent-%COMP%]{flex:1}}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-start;flex-wrap:wrap}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:6px;transition:all .2s ease;display:flex;align-items:center;justify-content:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-width:36px;min-height:36px}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]{color:var(--primary);background-color:#1458811a}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.return[_ngcontent-%COMP%]{color:#ff9800;background-color:#ff98001a}.actions[_ngcontent-%COMP%]   .btn-icon.return[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#ff9800;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.return[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]{color:var(--primary);background-color:#fd78231a}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.sale[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:active{transform:translateY(0)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{padding:6px}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}}  .custom-snackbar.success{background-color:var(--accent2)}  .custom-snackbar.error{background-color:#dc3545}  .custom-snackbar .snackbar-message{display:flex;align-items:center;gap:.5rem;color:#fff}  .custom-snackbar .snackbar-message i{font-size:1.2rem}.loading-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#fffc;display:flex;justify-content:center;align-items:center;z-index:1000}.loading-overlay[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2rem;color:var(--primary)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]{background-color:var(--background);color:#fff;margin-top:3px;width:42px;height:42px;border-radius:6px;transition:all .2s ease}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:active{transform:translateY(0)}"],changeDetection:0})}}return c})();function re(c,_){c&1&&(o(0,"div",53),i(1," Customer is required "),r())}function oe(c,_){c&1&&(o(0,"div",53),i(1," Sale date is required "),r())}function ie(c,_){c&1&&(o(0,"div",53),i(1," Packaging and forwarding charges is required and must be 0 or greater "),r())}function ae(c,_){c&1&&(o(0,"div",53),i(1," Please select a product "),r())}function se(c,_){c&1&&(o(0,"div",53),i(1," Quantity must be 1 or greater "),r())}function ce(c,_){c&1&&(o(0,"div",53),i(1," Double quotes are not allowed "),r())}function le(c,_){c&1&&(o(0,"div",53),i(1," Unit price must be greater than 0 "),r())}function de(c,_){if(c&1){let t=y();o(0,"tr",54)(1,"td")(2,"div",55)(3,"div",14),u(4,"app-searchable-select",56),o(5,"button",57),m("click",function(){h(t);let n=g();return f(n.refreshProducts())})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(6,"i",17),r()(),C(7,ae,2,0,"div",18),r()(),o(8,"td")(9,"div",55),u(10,"input",58),C(11,se,2,0,"div",18),r()(),o(12,"td")(13,"div",55),u(14,"input",59),C(15,ce,2,0,"div",18),r()(),o(16,"td")(17,"div",55)(18,"div",34)(19,"span",35),i(20,"\u20B9"),r(),u(21,"input",60),r(),C(22,le,2,0,"div",18),r()(),o(23,"td")(24,"div",34),u(25,"input",61),r()(),o(26,"td")(27,"div",34),u(28,"input",62),r()(),o(29,"td")(30,"div",55),u(31,"input",63),r()(),o(32,"td")(33,"button",64),m("click",function(){let n=h(t).index,a=g();return f(a.removeProduct(n))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(34,"i",65),r()()()}if(c&2){let t,e=_.index,n=g();d("formGroupName",e),s(4),O("is-invalid",n.isProductFieldInvalid(e,"productId")),d("focusWidthPx",600)("options",n.products)("placeholder","Select Product")("searchPlaceholder","Search products..."),s(),d("disabled",n.isLoadingProducts),s(),d("ngClass",n.isLoadingProducts?"fa-spinner fa-spin":"fa-sync-alt"),s(),d("ngIf",n.isProductFieldInvalid(e,"productId")),s(3),O("is-invalid",n.isProductFieldInvalid(e,"quantity")),s(),d("ngIf",n.isProductFieldInvalid(e,"quantity")),s(3),O("is-invalid",n.isProductFieldInvalid(e,"batchNumber")),s(),d("ngIf",(t=n.productsFormArray.at(e).get("batchNumber"))==null||t.errors==null?null:t.errors.doubleQuotes),s(6),O("is-invalid",n.isProductFieldInvalid(e,"unitPrice")),s(),d("ngIf",n.isProductFieldInvalid(e,"unitPrice")),s(3),d("value",n.getFormattedPrice(e)),s(3),d("value",n.getFormattedTaxAmount(e)),s(5),d("disabled",n.productsFormArray.length===1)}}var Ft=(()=>{class c{get productsFormArray(){return this.saleForm.get("products")}trackByProductIndex(t,e){return e}constructor(t,e,n,a,l,P,M,v,J){this.fb=t,this.productService=e,this.customerService=n,this.saleService=a,this.snackbar=l,this.http=P,this.router=M,this.encryptionService=v,this.cdr=J,this.products=[],this.customers=[],this.loading=!1,this.isLoadingProducts=!1,this.isLoadingCustomers=!1,this.isEdit=!1,this.destroy$=new I,this.productSubscriptions=[],this.productMap=new Map,this.totalAmount=0,this.totalTaxAmount=0,this.grandTotal=0,this.initForm()}ngOnInit(){this.loadProducts(),this.loadCustomers(),this.saleForm.get("packagingAndForwadingCharges")?.valueChanges.pipe(b(this.destroy$),X(150)).subscribe(()=>{this.calculateTotalAmount(),this.cdr.markForCheck()});let t=localStorage.getItem("saleId");if(t){let e=this.encryptionService.decrypt(t);e&&this.fetchSaleDetails(Number(e))}}ngOnDestroy(){this.productSubscriptions.forEach(t=>{t&&!t.closed&&t.unsubscribe()}),this.productSubscriptions=[],this.destroy$.next(),this.destroy$.complete(),this.products=[],this.customers=[],this.productMap.clear(),this.saleForm&&this.saleForm.reset()}initForm(){this.saleForm=this.fb.group({id:[null],customerId:["",x.required],saleDate:[T(new Date,"yyyy-MM-dd","en"),x.required],invoiceNumber:[""],products:this.fb.array([]),isBlack:[!1,x.required],packagingAndForwadingCharges:[0,[x.required,x.min(0)]]}),this.addProduct()}createProductFormGroup(){return this.fb.group({id:[null],productId:["",x.required],quantity:["",[x.required,x.min(1)]],batchNumber:["",[this.noDoubleQuotesValidator()]],unitPrice:["",[x.required,x.min(.01)]],price:[{value:0,disabled:!0}],taxPercentage:[{value:0,disabled:!0}],taxAmount:[{value:0,disabled:!0}],remarks:[null,[]]})}addProduct(){let t=this.createProductFormGroup(),e=this.setupProductCalculations(t);this.productSubscriptions.push(e),this.productsFormArray.push(t)}removeProduct(t){this.productsFormArray.length!==1&&(this.productSubscriptions[t]&&(this.productSubscriptions[t].unsubscribe(),this.productSubscriptions.splice(t,1)),this.productsFormArray.removeAt(t),this.calculateTotalAmount())}setupProductCalculations(t){let e=new ot,n=t.get("productId")?.valueChanges.pipe(b(this.destroy$),it()).subscribe(l=>{if(l){let P=this.productMap.get(l);if(P){let M=P.taxPercentage||0,v=P.saleAmount||0;t.patchValue({taxPercentage:M,unitPrice:v},{emitEvent:!1}),this.calculateProductPrice(t)}}});n&&e.add(n);let a=t.valueChanges.pipe(b(this.destroy$),X(150)).subscribe(()=>{this.calculateProductPrice(t)});return e.add(a),e}calculateProductPrice(t){if(!t)return;let e=Number(t.get("quantity")?.value||0),n=Number(t.get("unitPrice")?.value||0),a=Number(t.get("taxPercentage")?.value||0),l=Number((e*n).toFixed(2)),P=Number((l*a/100).toFixed(2));t.patchValue({price:l,taxAmount:P},{emitEvent:!1}),this.calculateTotalAmount(),this.cdr.markForCheck()}getTotalAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("price").value||0),0)}getTotalTaxAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("taxAmount").value||0),0)}getTotalFinalPrice(){return this.productsFormArray.controls.reduce((t,e)=>{let n=Number(e.get("price")?.value||0),a=Number(e.get("taxAmount")?.value||0);return t+(n+a)},0)}getGrandTotal(){let t=Number(this.saleForm.get("packagingAndForwadingCharges")?.value||0);return this.getTotalFinalPrice()+t}transformProductsWithDisplayName(t){return t.map(e=>At(rt({},e),{displayName:e.materialName?`${e.name} (${e.materialName})`:e.name}))}loadProducts(){this.isLoadingProducts=!0,this.productService.getProducts({status:"A"}).pipe(b(this.destroy$)).subscribe({next:t=>{t.success&&(this.products=this.transformProductsWithDisplayName(t.data),this.buildProductMap()),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}})}buildProductMap(){this.productMap.clear();for(let t of this.products)this.productMap.set(t.id,t)}refreshProducts(){this.isLoadingProducts=!0,this.productService.refreshProducts().pipe(b(this.destroy$)).subscribe({next:t=>{t.success&&(this.products=this.transformProductsWithDisplayName(t.data),this.buildProductMap(),this.snackbar.success("Products refreshed successfully")),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to refresh products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}})}loadCustomers(){this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(b(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}refreshCustomers(){this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(b(this.destroy$)).subscribe({next:t=>{t.success&&(this.customers=t.data),this.snackbar.success("Customers refreshed successfully"),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:t=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}isFieldInvalid(t){let e=this.saleForm.get(t);return e?e.invalid&&e.touched:!1}isProductFieldInvalid(t,e){let n=this.productsFormArray.at(t).get(e);if(!n)return!1;if(n.invalid&&(n.dirty||n.touched)){let l=n.errors;if(l&&(l.required||l.min&&e==="quantity"||l.min&&e==="unitPrice"||l.min||l.max||l.min))return!0}return!1}resetForm(){this.isEdit=!1,this.saleForm.patchValue({id:null}),this.initForm()}onSubmit(){if(this.markFormGroupTouched(this.saleForm),this.saleForm.valid){this.loading=!0;let t=this.prepareFormData();(this.isEdit?this.saleService.updateSale(t):this.saleService.createSale(t)).pipe(b(this.destroy$)).subscribe({next:n=>{n?.success&&(this.snackbar.success(`Sale ${this.isEdit?"updated":"created"} successfully`),localStorage.removeItem("saleId"),this.router.navigate(["/sale"])),this.loading=!1,this.cdr.markForCheck()},error:n=>{this.snackbar.error(n?.error?.message||`Failed to ${this.isEdit?"update":"create"} sale`),this.loading=!1,this.cdr.markForCheck()}})}else{let t=document.querySelector(".is-invalid");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}prepareFormData(){let t=this.saleForm.value,e={saleDate:T(t.saleDate,"dd-MM-yyyy","en"),customerId:t.customerId,invoiceNumber:t.invoiceNumber,price:this.getTotalAmount(),taxAmount:this.getTotalTaxAmount(),packagingAndForwadingCharges:Number(t.packagingAndForwadingCharges||0),totalAmount:this.getGrandTotal(),isBlack:!!t.isBlack,products:t.products.map((n,a)=>{let l=this.productsFormArray.at(a).get("id")?.value,P=this.productsFormArray.at(a).get("price")?.value||0,M=this.productsFormArray.at(a).get("taxAmount")?.value||0,v={productId:n.productId,quantity:n.quantity,batchNumber:n.batchNumber,unitPrice:n.unitPrice,price:P,taxPercentage:this.productsFormArray.at(a).get("taxPercentage")?.value,taxAmount:M,finalPrice:P+M,remarks:n.remarks};return this.isEdit&&l&&(v.id=l),v})};return this.isEdit&&t.id&&(e.id=t.id),e}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e instanceof ut||e instanceof ft?this.markFormGroupTouched(e):(e.markAsTouched(),e.markAsDirty())})}calculateTotalAmount(){this.totalAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("price").value||0),0),this.totalTaxAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("taxAmount").value||0),0);let t=Number(this.saleForm.get("packagingAndForwadingCharges")?.value||0);this.grandTotal=this.totalAmount+this.totalTaxAmount+t,this.saleForm.patchValue({price:this.totalAmount,taxAmount:this.totalTaxAmount},{emitEvent:!1}),this.cdr.markForCheck()}noDoubleQuotesValidator(){return t=>t.value&&t.value.includes('"')?{doubleQuotes:!0}:null}getFormattedPrice(t){let e=this.productsFormArray.at(t).get("price")?.value;return e?e.toFixed(2):"0.00"}getFormattedTaxAmount(t){let e=this.productsFormArray.at(t).get("taxAmount")?.value;return e?e.toFixed(2):"0.00"}fetchSaleDetails(t){this.saleService.getSaleDetails(t).pipe(b(this.destroy$)).subscribe({next:e=>{e.id&&(this.isEdit=!0,this.populateForm(e)),this.cdr.markForCheck()},error:e=>{this.snackbar.error(e?.error?.message||"Failed to load sale details"),this.cdr.markForCheck()}})}populateForm(t){this.productSubscriptions.forEach(e=>{e&&!e.closed&&e.unsubscribe()}),this.productSubscriptions=[],this.saleForm.patchValue({customerId:t.customerId,id:t.id,saleDate:T(new Date(t.saleDate),"yyyy-MM-dd","en"),invoiceNumber:t.invoiceNumber,isBlack:t.isBlack,packagingAndForwadingCharges:t.packagingAndForwadingCharges||0}),this.productsFormArray.clear(),t.items.forEach(e=>{let n=this.createProductFormGroup(),a=this.setupProductCalculations(n);this.productSubscriptions.push(a),n.patchValue({id:e.id,productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,price:e.price||0,taxPercentage:e.taxPercentage||0,taxAmount:e.taxAmount||0,batchNumber:e.batchNumber||"",remarks:e.remarks||""},{emitEvent:!1}),this.productsFormArray.push(n)}),this.isEdit=!0}static{this.\u0275fac=function(e){return new(e||c)(p(Y),p(bt),p(W),p(H),p(K),p(Nt),p(U),p(Q),p(N))}}static{this.\u0275cmp=D({type:c,selectors:[["app-add-sale"]],decls:124,vars:37,consts:[[1,"add-sale-container"],["routerLink","/sale",1,"btn","btn-sm","btn-secondary","back-btn"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"form-title"],[1,"fas","fa-cart-plus"],[1,"sale-form",3,"ngSubmit","formGroup"],[1,"header-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],[1,"fas","fa-user"],[1,"required"],[1,"select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","placeholder","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",3,"click","disabled"],[1,"fas",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","saleDate"],[1,"fas","fa-calendar"],["type","date","id","saleDate","formControlName","saleDate",1,"form-control",3,"touchstart"],["for","invoiceNumber"],[1,"fas","fa-file-invoice"],["type","text","id","invoiceNumber","formControlName","invoiceNumber","readonly","",1,"form-control"],[1,"form-label"],[1,"d-flex","gap-3"],[1,"form-check"],["type","radio","formControlName","isBlack","id","isBlackTrue",1,"form-check-input",3,"value"],["for","isBlackTrue",1,"form-check-label"],["type","radio","formControlName","isBlack","id","isBlackFalse",1,"form-check-input",3,"value"],["for","isBlackFalse",1,"form-check-label"],["for","packagingAndForwadingCharges"],[1,"fas","fa-box"],[1,"input-group"],[1,"input-group-text"],["type","number","id","packagingAndForwadingCharges","formControlName","packagingAndForwadingCharges","min","0","step","0.01","placeholder","Enter packaging and forwarding charges",1,"form-control"],["formArrayName","products",1,"products-section"],[1,"products-header"],[1,"fas","fa-boxes"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","touchstart"],[1,"fas","fa-plus"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"sale-summary"],[1,"summary-item"],[1,"summary-item","total"],[1,"form-actions"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","touchstart","disabled"],[1,"fas","fa-undo"],["type","submit",1,"btn","btn-sm","btn-primary",3,"touchstart","disabled"],[3,"show"],[1,"invalid-feedback"],[3,"formGroupName"],[1,"form-field-container"],["formControlName","productId","labelKey","displayName","valueKey","id",3,"focusWidthPx","options","placeholder","searchPlaceholder"],["type","button","title","Refresh Products",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],["type","number","formControlName","quantity","placeholder","Qty","min","1",1,"form-control"],["type","text","formControlName","batchNumber","placeholder","Batch Number",1,"form-control"],["type","number","formControlName","unitPrice","placeholder","Price","min","0.01","step","0.01",1,"form-control"],["type","number","formControlName","price","readonly","",1,"form-control",3,"value"],["type","number","formControlName","taxAmount","readonly","",1,"form-control",3,"value"],["type","text","formControlName","remarks","placeholder","Remarks",1,"form-control"],["type","button","title","Remove Product",1,"btn","btn-sm","btn-danger",3,"click","touchstart","disabled"],[1,"fas","fa-trash"]],template:function(e,n){if(e&1&&(o(0,"div",0)(1,"button",1),u(2,"i",2),i(3," Back to Sales "),r(),o(4,"div",3)(5,"div",4)(6,"h2",5),u(7,"i",6),i(8," Add New Sale "),r()(),o(9,"form",7),m("ngSubmit",function(){return n.onSubmit()}),o(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),u(14,"i",12),i(15," Select Customer "),o(16,"span",13),i(17,"*"),r()(),o(18,"div",14),u(19,"app-searchable-select",15),o(20,"button",16),m("click",function(){return n.refreshCustomers()}),u(21,"i",17),r()(),C(22,re,2,0,"div",18),r(),o(23,"div",10)(24,"label",19),u(25,"i",20),i(26," Sale Date "),o(27,"span",13),i(28,"*"),r()(),o(29,"input",21),m("touchstart",function(l){return l.stopPropagation()}),r(),C(30,oe,2,0,"div",18),r(),o(31,"div",10)(32,"label",22),u(33,"i",23),i(34," Invoice Number "),r(),u(35,"input",24),r(),o(36,"div",10)(37,"label",25),i(38,"Is Black"),r(),o(39,"div",26)(40,"div",27),u(41,"input",28),o(42,"label",29),i(43,"Yes"),r()(),o(44,"div",27),u(45,"input",30),o(46,"label",31),i(47,"No"),r()()()(),o(48,"div",10)(49,"label",32),u(50,"i",33),i(51," Packaging & Forwarding Charges "),o(52,"span",13),i(53,"*"),r()(),o(54,"div",34)(55,"span",35),i(56,"\u20B9"),r(),u(57,"input",36),r(),C(58,ie,2,0,"div",18),r()()(),o(59,"div",37)(60,"div",38)(61,"h3"),u(62,"i",39),i(63," Products"),r(),o(64,"button",40),m("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),u(65,"i",41),i(66," Add Product "),r()(),o(67,"div",42)(68,"table",43)(69,"thead")(70,"tr")(71,"th"),i(72,"Product Name"),r(),o(73,"th"),i(74,"Quantity"),r(),o(75,"th"),i(76,"Batch Number"),r(),o(77,"th"),i(78,"Sale Rate"),r(),o(79,"th"),i(80,"Price"),r(),o(81,"th"),i(82,"Tax Amount"),r(),o(83,"th"),i(84,"Remarks"),r(),o(85,"th"),i(86,"Actions"),r()()(),o(87,"tbody"),C(88,de,35,22,"tr",44),r()()()(),o(89,"button",40),m("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),u(90,"i",41),i(91," Add Product "),r(),o(92,"div",45)(93,"div",46)(94,"span"),i(95,"Total Products:"),r(),o(96,"strong"),i(97),r()(),o(98,"div",46)(99,"span"),i(100,"Total Final Price (Items):"),r(),o(101,"strong"),i(102),k(103,"number"),r()(),o(104,"div",46)(105,"span"),i(106,"Packaging & Forwarding Charges:"),r(),o(107,"strong"),i(108),k(109,"number"),r()(),o(110,"div",47)(111,"span"),i(112,"Grand Total:"),r(),o(113,"strong"),i(114),k(115,"number"),r()()(),o(116,"div",48)(117,"button",49),m("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),u(118,"i",50),i(119," Reset "),r(),o(120,"button",51),m("touchstart",function(l){return l.stopPropagation()}),u(121,"i",17),i(122),r()()()()(),u(123,"app-loader",52)),e&2){let a;s(9),d("formGroup",n.saleForm),s(10),O("is-invalid",n.isFieldInvalid("customerId")),d("options",n.customers)("placeholder","Select Customer")("searchPlaceholder","Search customers..."),s(),d("disabled",n.isLoadingCustomers),s(),d("ngClass",n.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt"),s(),d("ngIf",n.isFieldInvalid("customerId")),s(7),O("is-invalid",n.isFieldInvalid("saleDate")),s(),d("ngIf",n.isFieldInvalid("saleDate")),s(11),d("value",!0),s(4),d("value",!1),s(12),O("is-invalid",n.isFieldInvalid("packagingAndForwadingCharges")),s(),d("ngIf",n.isFieldInvalid("packagingAndForwadingCharges")),s(30),d("ngForOf",n.productsFormArray.controls)("ngForTrackBy",n.trackByProductIndex),s(9),S(n.productsFormArray.length),s(5),F("\u20B9",w(103,28,n.totalAmount+n.totalTaxAmount,"1.2-2"),""),s(6),F("\u20B9",w(109,31,((a=n.saleForm.get("packagingAndForwadingCharges"))==null?null:a.value)||0,"1.2-2"),""),s(6),F("\u20B9",w(115,34,n.grandTotal,"1.2-2"),""),s(3),d("disabled",n.loading),s(3),d("disabled",n.saleForm.invalid||n.loading),s(),d("ngClass",n.loading?"fa-spinner fa-spin":"fa-save"),s(),F(" ",n.loading?"Saving...":n.isEdit?"Update Sale":"Save Sale"," "),s(),d("show",n.loading)}},dependencies:[R,L,V,B,z,mt,Tt,j,$,ht,q,G,pt,gt,Z,E,A,dt],styles:[".add-sale-container[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}@media (max-width: 768px){.add-sale-container[_ngcontent-%COMP%]{padding:1rem}}.form-control[_ngcontent-%COMP%]{height:40px}@media (max-width: 768px){.form-control[_ngcontent-%COMP%]{font-size:16px;min-height:44px}}.back-btn[_ngcontent-%COMP%]{margin-bottom:1rem;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.select-group[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:.5rem;width:100%;overflow:visible}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{display:block;flex:1;position:relative;z-index:100;overflow:visible}.select-group[_ngcontent-%COMP%]   app-searchable-select.custom-width[_ngcontent-%COMP%]{position:absolute;z-index:1000;left:0}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within{z-index:1000;position:relative}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]{flex-shrink:0;margin-top:0;height:40px;min-width:40px;display:flex;align-items:center;justify-content:center;position:relative;z-index:1;border:1px solid var(--supporting);border-radius:8px;background:#fff;transition:all .3s ease;color:var(--primary);touch-action:manipulation;-webkit-tap-highlight-color:transparent}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary);color:#fff}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{color:#fff;margin:0;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.sale-form[_ngcontent-%COMP%]{padding:2rem}@media (max-width: 768px){.sale-form[_ngcontent-%COMP%]{padding:1rem}}.header-section[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-bottom:2rem}.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.products-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;border:1px solid var(--primary)}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary);font-size:1.25rem;display:flex;align-items:center;gap:.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;color:var(--text-primary);font-weight:500}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:var(--danger);margin-left:4px}.input-group[_ngcontent-%COMP%]{display:flex;align-items:stretch}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background-color:var(--background);border:1px solid var(--border-color);border-right:none;border-radius:var(--border-radius) 0 0 var(--border-radius);height:38px;color:var(--text-secondary);min-width:40px;display:flex;align-items:center;justify-content:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:0 var(--border-radius) var(--border-radius) 0;flex:1}.sale-summary[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;display:flex;justify-content:flex-end;gap:2rem;flex-wrap:wrap}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;font-weight:600}.sale-summary[_ngcontent-%COMP%]   .summary-item.total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary)}@media (max-width: 768px){.sale-summary[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-end;gap:1rem}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.table-responsive[_ngcontent-%COMP%]{margin:0 -1.5rem;padding:0 1.5rem;overflow-x:auto;min-height:400px;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{margin:0 -1rem;padding:0 1rem}}.products-table[_ngcontent-%COMP%]{width:100%;margin-bottom:0;background:#fff;border-collapse:separate;border-spacing:0}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:var(--text-primary);font-weight:600;padding:1rem;white-space:nowrap;border-bottom:2px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:30%;min-width:300px}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(4){width:10%;max-width:120px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{min-width:80px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{width:30%;min-width:300px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child   .form-control[_ngcontent-%COMP%]{min-width:300px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:10%;max-width:120px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4)   .form-control[_ngcontent-%COMP%]{min-width:100px;max-width:120px}.products-table[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{flex-wrap:nowrap}.products-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{margin:0 auto}@media (max-width: 768px){.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}}.form-field-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem;overflow:visible}.form-field-container[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%], .form-field-container[_ngcontent-%COMP%]   .input-group.is-invalid[_ngcontent-%COMP%]{border-color:var(--danger);background-image:url(data:image/svg+xml,...)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-bottom:1.5rem;vertical-align:top}.invalid-feedback[_ngcontent-%COMP%]{color:var(--danger);font-size:.75rem;margin-top:.25rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}@media (hover: none) and (pointer: coarse){.btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.form-control[_ngcontent-%COMP%]{min-height:44px;font-size:16px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem .5rem}}form[_ngcontent-%COMP%]{touch-action:manipulation}@media (max-width: 768px){app-searchable-select[_ngcontent-%COMP%]{position:relative;z-index:1000}}"],changeDetection:0})}}return c})();function ue(c,_){c&1&&(o(0,"div",46),i(1," Customer is required "),r())}function me(c,_){c&1&&(o(0,"div",46),i(1," Sale return date is required "),r())}function pe(c,_){c&1&&(o(0,"div",46),i(1," Packaging and forwarding charges is required and must be 0 or greater "),r())}function ge(c,_){c&1&&(o(0,"div",46),i(1," Please select a product "),r())}function he(c,_){c&1&&(o(0,"div",46),i(1," Quantity must be 1 or greater "),r())}function fe(c,_){c&1&&(o(0,"div",46),i(1," Double quotes are not allowed "),r())}function _e(c,_){c&1&&(o(0,"div",46),i(1," Unit price must be greater than 0 "),r())}function be(c,_){if(c&1){let t=y();o(0,"tr",47)(1,"td")(2,"div",48)(3,"div",49),u(4,"app-searchable-select",50),o(5,"button",51),m("click",function(){h(t);let n=g();return f(n.refreshProducts())})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(6,"i",17),r()(),C(7,ge,2,0,"div",18),r()(),o(8,"td")(9,"div",48),u(10,"input",52),C(11,he,2,0,"div",18),r()(),o(12,"td")(13,"div",48),u(14,"input",53),C(15,fe,2,0,"div",18),r()(),o(16,"td")(17,"div",48)(18,"div",27)(19,"span",28),i(20,"\u20B9"),r(),u(21,"input",54),r(),C(22,_e,2,0,"div",18),r()(),o(23,"td")(24,"div",27),u(25,"input",55),r()(),o(26,"td")(27,"div",27),u(28,"input",56),r()(),o(29,"td")(30,"div",48),u(31,"input",57),r()(),o(32,"td")(33,"button",58),m("click",function(){let n=h(t).index,a=g();return f(a.removeProduct(n))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(34,"i",59),r()()()}if(c&2){let t,e=_.index,n=g();d("formGroupName",e),s(4),O("is-invalid",n.isProductFieldInvalid(e,"productId")),d("focusWidthPx",600)("options",n.products)("placeholder","Select Product")("searchPlaceholder","Search products..."),s(),d("disabled",n.isLoadingProducts),s(),d("ngClass",n.isLoadingProducts?"fa-spinner fa-spin":"fa-sync-alt"),s(),d("ngIf",n.isProductFieldInvalid(e,"productId")),s(3),O("is-invalid",n.isProductFieldInvalid(e,"quantity")),s(),d("ngIf",n.isProductFieldInvalid(e,"quantity")),s(3),O("is-invalid",n.isProductFieldInvalid(e,"batchNumber")),s(),d("ngIf",(t=n.productsFormArray.at(e).get("batchNumber"))==null||t.errors==null?null:t.errors.doubleQuotes),s(6),O("is-invalid",n.isProductFieldInvalid(e,"unitPrice")),s(),d("ngIf",n.isProductFieldInvalid(e,"unitPrice")),s(3),d("value",n.getFormattedPrice(e)),s(3),d("value",n.getFormattedTaxAmount(e)),s(5),d("disabled",n.productsFormArray.length===1)}}var Et=(()=>{class c{get productsFormArray(){return this.returnForm.get("products")}trackByProductIndex(t,e){return e}constructor(t,e,n,a,l,P,M,v,J){this.fb=t,this.router=e,this.route=n,this.saleService=a,this.productService=l,this.customerService=P,this.snackbar=M,this.encryptionService=v,this.cdr=J,this.products=[],this.customers=[],this.loading=!1,this.isLoadingProducts=!1,this.isLoadingCustomers=!1,this.isEdit=!1,this.saleReturnId=null,this.destroy$=new I,this.productSubscriptions=[],this.productMap=new Map,this.totalAmount=0,this.totalTaxAmount=0,this.grandTotal=0,this.initForm()}ngOnInit(){let t=this.route.snapshot.paramMap.get("id");if(t){let e=this.encryptionService.decrypt(t);if(e){let n=Number(e);isNaN(n)||(this.saleReturnId=n,this.isEdit=!0)}}this.loadCustomers(),this.isLoadingProducts=!0,this.productService.getProducts({status:"A"}).pipe(b(this.destroy$)).subscribe({next:e=>{e?.success&&e.data&&(this.products=e.data.content||e.data,this.buildProductMap(),this.isEdit&&this.saleReturnId&&this.fetchSaleReturnDetails(this.saleReturnId)),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}}),this.returnForm.get("packagingAndForwadingCharges")?.valueChanges.pipe(b(this.destroy$),X(150)).subscribe(()=>{this.calculateTotalAmount(),this.cdr.markForCheck()})}ngOnDestroy(){this.productSubscriptions.forEach(t=>{t&&!t.closed&&t.unsubscribe()}),this.productSubscriptions=[],this.destroy$.next(),this.destroy$.complete(),this.products=[],this.customers=[],this.productMap.clear(),this.returnForm&&this.returnForm.reset()}initForm(){this.returnForm=this.fb.group({id:[null],customerId:["",x.required],saleReturnDate:[T(new Date,"yyyy-MM-dd","en"),x.required],invoiceNumber:[""],products:this.fb.array([]),packagingAndForwadingCharges:[0,[x.required,x.min(0)]]}),this.isEdit||this.addProduct()}createProductFormGroup(){return this.fb.group({id:[null],productId:["",x.required],quantity:["",[x.required,x.min(1)]],batchNumber:["",[this.noDoubleQuotesValidator()]],unitPrice:["",[x.required,x.min(.01)]],price:[{value:0,disabled:!0}],taxPercentage:[{value:0,disabled:!0}],taxAmount:[{value:0,disabled:!0}],remarks:[null,[]]})}addProduct(){let t=this.createProductFormGroup(),e=this.setupProductCalculations(t);this.productSubscriptions.push(e),this.productsFormArray.push(t)}removeProduct(t){this.productsFormArray.length!==1&&(this.productSubscriptions[t]&&(this.productSubscriptions[t].unsubscribe(),this.productSubscriptions.splice(t,1)),this.productsFormArray.removeAt(t),this.calculateTotalAmount())}setupProductCalculations(t){let e=new ot,n=t.get("productId")?.valueChanges.pipe(b(this.destroy$),it()).subscribe(l=>{if(l){let P=this.productMap.get(l);if(P){let M=P.taxPercentage||0;t.patchValue({taxPercentage:M},{emitEvent:!1}),this.calculateProductPrice(t)}}});n&&e.add(n);let a=t.valueChanges.pipe(b(this.destroy$),X(150)).subscribe(()=>{this.calculateProductPrice(t)});return e.add(a),e}calculateProductPrice(t){if(!t)return;let e=Number(t.get("quantity")?.value||0),n=Number(t.get("unitPrice")?.value||0),a=Number(t.get("taxPercentage")?.value||0),l=Number((e*n).toFixed(2)),P=Number((l*a/100).toFixed(2));t.patchValue({price:l,taxAmount:P},{emitEvent:!1}),this.calculateTotalAmount(),this.cdr.markForCheck()}getTotalAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("price").value||0),0)}getTotalTaxAmount(){return this.productsFormArray.controls.reduce((t,e)=>t+(e.get("taxAmount").value||0),0)}getTotalFinalPrice(){return this.productsFormArray.controls.reduce((t,e)=>{let n=Number(e.get("price")?.value||0),a=Number(e.get("taxAmount")?.value||0);return t+(n+a)},0)}getGrandTotal(){let t=Number(this.returnForm.get("packagingAndForwadingCharges")?.value||0);return this.getTotalFinalPrice()+t}buildProductMap(){this.productMap.clear();for(let t of this.products)this.productMap.set(t.id,t)}refreshProducts(){this.isLoadingProducts=!0,this.productService.refreshProducts().pipe(b(this.destroy$)).subscribe({next:t=>{t?.success&&(this.products=t.data,this.buildProductMap(),this.snackbar.success("Products refreshed successfully")),this.isLoadingProducts=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to refresh products"),this.isLoadingProducts=!1,this.cdr.markForCheck()}})}loadCustomers(){this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(b(this.destroy$)).subscribe({next:t=>{t?.success&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}refreshCustomers(){this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(b(this.destroy$)).subscribe({next:t=>{t?.success&&(this.customers=t.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}})}isFieldInvalid(t){let e=this.returnForm.get(t);return e?e.invalid&&e.touched:!1}isProductFieldInvalid(t,e){let n=this.productsFormArray.at(t).get(e);if(!n)return!1;if(n.invalid&&(n.dirty||n.touched)){let l=n.errors;if(l&&(l.required||l.min&&e==="quantity"||l.min&&e==="unitPrice"||l.min||l.max||l.min))return!0}return!1}resetForm(){this.initForm()}onSubmit(){if(this.markFormGroupTouched(this.returnForm),this.returnForm.valid){this.loading=!0;let t=this.prepareFormData();(this.isEdit?this.saleService.createSaleReturn(t):this.saleService.createSaleReturn(t)).pipe(b(this.destroy$)).subscribe({next:n=>{n?.success?(this.snackbar.success(n.message||`Sale return ${this.isEdit?"updated":"created"} successfully`),this.router.navigate(["/sale/return"])):this.snackbar.error(n?.message||`Failed to ${this.isEdit?"update":"create"} sale return`),this.loading=!1,this.cdr.markForCheck()},error:n=>{let a=n?.error?.message||`Failed to ${this.isEdit?"update":"create"} sale return`;this.snackbar.error(a),this.loading=!1,this.cdr.markForCheck()}})}else{let t=document.querySelector(".is-invalid");t&&t.scrollIntoView({behavior:"smooth",block:"center"})}}prepareFormData(){let t=this.returnForm.value,e={saleReturnDate:T(t.saleReturnDate,"dd-MM-yyyy","en"),customerId:t.customerId,invoiceNumber:t.invoiceNumber,price:this.getTotalAmount(),taxAmount:this.getTotalTaxAmount(),packagingAndForwadingCharges:Number(t.packagingAndForwadingCharges||0),totalAmount:this.getGrandTotal(),products:t.products.map((n,a)=>{let l=this.productsFormArray.at(a).get("id")?.value,P=this.productsFormArray.at(a).get("price")?.value||0,M=this.productsFormArray.at(a).get("taxAmount")?.value||0,v={productId:n.productId,quantity:n.quantity,batchNumber:n.batchNumber,unitPrice:n.unitPrice,price:P,taxPercentage:this.productsFormArray.at(a).get("taxPercentage")?.value,taxAmount:M,finalPrice:P+M,remarks:n.remarks};return this.isEdit&&l&&(v.id=l),v})};return this.isEdit&&t.id&&(e.id=t.id),e}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e instanceof ut||e instanceof ft?this.markFormGroupTouched(e):(e.markAsTouched(),e.markAsDirty())})}calculateTotalAmount(){this.totalAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("price").value||0),0),this.totalTaxAmount=this.productsFormArray.controls.reduce((e,n)=>e+(n.get("taxAmount").value||0),0);let t=Number(this.returnForm.get("packagingAndForwadingCharges")?.value||0);this.grandTotal=this.totalAmount+this.totalTaxAmount+t,this.returnForm.patchValue({price:this.totalAmount,taxAmount:this.totalTaxAmount},{emitEvent:!1}),this.cdr.markForCheck()}noDoubleQuotesValidator(){return t=>t.value&&t.value.includes('"')?{doubleQuotes:!0}:null}getFormattedPrice(t){let e=this.productsFormArray.at(t).get("price")?.value;return e?e.toFixed(2):"0.00"}getFormattedTaxAmount(t){let e=this.productsFormArray.at(t).get("taxAmount")?.value;return e?e.toFixed(2):"0.00"}fetchSaleReturnDetails(t){this.loading=!0,this.saleService.getSaleReturnDetail(t).pipe(b(this.destroy$)).subscribe({next:e=>{e&&e.id?this.populateForm(e):this.snackbar.error("Failed to load sale return details"),this.loading=!1,this.cdr.markForCheck()},error:e=>{this.snackbar.error(e?.error?.message||"Failed to load sale return details"),this.loading=!1,this.cdr.markForCheck()}})}populateForm(t){this.productsFormArray.clear(),this.productSubscriptions.forEach(e=>e?.unsubscribe()),this.productSubscriptions=[],this.returnForm.patchValue({id:t.id,customerId:t.customerId,saleReturnDate:T(new Date(t.saleReturnDate),"yyyy-MM-dd","en"),invoiceNumber:t.invoiceNumber,packagingAndForwadingCharges:t.packagingAndForwadingCharges||0}),t.items&&t.items.length>0?t.items.forEach(e=>{let n=this.createProductFormGroup(),a=this.setupProductCalculations(n);this.productSubscriptions.push(a),n.patchValue({id:e.id,productId:e.productId,quantity:e.quantity,unitPrice:e.unitPrice,price:e.price||0,taxPercentage:e.taxPercentage||0,taxAmount:e.taxAmount||0,batchNumber:e.batchNumber||"",remarks:e.remarks||""},{emitEvent:!1}),this.productsFormArray.push(n)}):this.addProduct()}static{this.\u0275fac=function(e){return new(e||c)(p(Y),p(U),p(Vt),p(H),p(bt),p(W),p(K),p(Q),p(N))}}static{this.\u0275cmp=D({type:c,selectors:[["app-add-sale-return"]],decls:112,vars:36,consts:[[1,"add-sale-container"],["routerLink","/sale/return",1,"btn","btn-sm","btn-secondary","back-btn",3,"touchstart"],[1,"fas","fa-arrow-left"],[1,"form-card"],[1,"card-header"],[1,"form-title"],[1,"fas","fa-undo-alt"],[1,"sale-form",3,"ngSubmit","formGroup"],[1,"header-section"],[1,"form-row"],[1,"form-group"],["for","customerId"],[1,"fas","fa-user"],[1,"required"],[1,"select-group","inline"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","placeholder","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],[1,"fas",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["for","saleReturnDate"],[1,"fas","fa-calendar"],["type","date","id","saleReturnDate","formControlName","saleReturnDate",1,"form-control",3,"touchstart"],["for","invoiceNumber"],[1,"fas","fa-file-invoice"],["type","text","id","invoiceNumber","formControlName","invoiceNumber","readonly","",1,"form-control"],["for","packagingAndForwadingCharges"],[1,"fas","fa-box"],[1,"input-group"],[1,"input-group-text"],["type","number","id","packagingAndForwadingCharges","formControlName","packagingAndForwadingCharges","min","0","step","0.01","placeholder","Enter packaging and forwarding charges",1,"form-control"],["formArrayName","products",1,"products-section"],[1,"products-header"],[1,"fas","fa-boxes"],["type","button",1,"btn","btn-sm","btn-primary",3,"click","touchstart"],[1,"fas","fa-plus"],[1,"table-responsive"],[1,"table","products-table"],[3,"formGroupName",4,"ngFor","ngForOf","ngForTrackBy"],[1,"sale-summary"],[1,"summary-item"],[1,"summary-item","total"],[1,"form-actions"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click","touchstart","disabled"],[1,"fas","fa-undo"],["type","submit",1,"btn","btn-sm","btn-primary",3,"touchstart","disabled"],[3,"show"],[1,"invalid-feedback"],[3,"formGroupName"],[1,"form-field-container"],[1,"select-group"],["formControlName","productId","labelKey","name","valueKey","id",3,"focusWidthPx","options","placeholder","searchPlaceholder"],["type","button","title","Refresh Products",1,"btn","btn-sm","btn-primary","refresh",3,"click","touchstart","disabled"],["type","number","formControlName","quantity","placeholder","Qty","min","1",1,"form-control"],["type","text","formControlName","batchNumber","placeholder","Batch Number",1,"form-control"],["type","number","formControlName","unitPrice","placeholder","Price","min","0.01","step","0.01",1,"form-control"],["type","number","formControlName","price","readonly","",1,"form-control",3,"value"],["type","number","formControlName","taxAmount","readonly","",1,"form-control",3,"value"],["type","text","formControlName","remarks","placeholder","Remarks",1,"form-control"],["type","button","title","Remove Product",1,"btn","btn-sm","btn-danger",3,"click","touchstart","disabled"],[1,"fas","fa-trash"]],template:function(e,n){if(e&1&&(o(0,"div",0)(1,"button",1),m("touchstart",function(l){return l.stopPropagation()}),u(2,"i",2),i(3," Back to Sale Returns "),r(),o(4,"div",3)(5,"div",4)(6,"h2",5),u(7,"i",6),i(8),r()(),o(9,"form",7),m("ngSubmit",function(){return n.onSubmit()}),o(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),u(14,"i",12),i(15," Select Customer "),o(16,"span",13),i(17,"*"),r()(),o(18,"div",14),u(19,"app-searchable-select",15),o(20,"button",16),m("click",function(){return n.refreshCustomers()})("touchstart",function(l){return l.stopPropagation()}),u(21,"i",17),r()(),C(22,ue,2,0,"div",18),r(),o(23,"div",10)(24,"label",19),u(25,"i",20),i(26," Sale Return Date "),o(27,"span",13),i(28,"*"),r()(),o(29,"input",21),m("touchstart",function(l){return l.stopPropagation()}),r(),C(30,me,2,0,"div",18),r(),o(31,"div",10)(32,"label",22),u(33,"i",23),i(34," Return Invoice Number "),r(),u(35,"input",24),r(),o(36,"div",10)(37,"label",25),u(38,"i",26),i(39," Packaging & Forwarding Charges "),o(40,"span",13),i(41,"*"),r()(),o(42,"div",27)(43,"span",28),i(44,"\u20B9"),r(),u(45,"input",29),r(),C(46,pe,2,0,"div",18),r()()(),o(47,"div",30)(48,"div",31)(49,"h3"),u(50,"i",32),i(51," Products"),r(),o(52,"button",33),m("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),u(53,"i",34),i(54," Add Product "),r()(),o(55,"div",35)(56,"table",36)(57,"thead")(58,"tr")(59,"th"),i(60,"Product Name"),r(),o(61,"th"),i(62,"Quantity"),r(),o(63,"th"),i(64,"Batch Number"),r(),o(65,"th"),i(66,"Sale Rate"),r(),o(67,"th"),i(68,"Price"),r(),o(69,"th"),i(70,"Tax Amount"),r(),o(71,"th"),i(72,"Remarks"),r(),o(73,"th"),i(74,"Actions"),r()()(),o(75,"tbody"),C(76,be,35,22,"tr",37),r()()()(),o(77,"button",33),m("click",function(){return n.addProduct()})("touchstart",function(l){return l.stopPropagation()}),u(78,"i",34),i(79," Add Product "),r(),o(80,"div",38)(81,"div",39)(82,"span"),i(83,"Total Products:"),r(),o(84,"strong"),i(85),r()(),o(86,"div",39)(87,"span"),i(88,"Total Final Price (Items):"),r(),o(89,"strong"),i(90),k(91,"number"),r()(),o(92,"div",39)(93,"span"),i(94,"Packaging & Forwarding Charges:"),r(),o(95,"strong"),i(96),k(97,"number"),r()(),o(98,"div",40)(99,"span"),i(100,"Grand Total:"),r(),o(101,"strong"),i(102),k(103,"number"),r()()(),o(104,"div",41)(105,"button",42),m("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),u(106,"i",43),i(107," Reset "),r(),o(108,"button",44),m("touchstart",function(l){return l.stopPropagation()}),u(109,"i",17),i(110),r()()()()(),u(111,"app-loader",45)),e&2){let a;s(8),F(" ",n.isEdit?"Edit Sale Return":"Add New Sale Return"," "),s(),d("formGroup",n.returnForm),s(10),O("is-invalid",n.isFieldInvalid("customerId")),d("options",n.customers)("placeholder","Select Customer")("searchPlaceholder","Search customers..."),s(),d("disabled",n.isLoadingCustomers),s(),d("ngClass",n.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt"),s(),d("ngIf",n.isFieldInvalid("customerId")),s(7),O("is-invalid",n.isFieldInvalid("saleReturnDate")),s(),d("ngIf",n.isFieldInvalid("saleReturnDate")),s(15),O("is-invalid",n.isFieldInvalid("packagingAndForwadingCharges")),s(),d("ngIf",n.isFieldInvalid("packagingAndForwadingCharges")),s(30),d("ngForOf",n.productsFormArray.controls)("ngForTrackBy",n.trackByProductIndex),s(9),S(n.productsFormArray.length),s(5),F("\u20B9",w(91,27,n.totalAmount+n.totalTaxAmount,"1.2-2"),""),s(6),F("\u20B9",w(97,30,((a=n.returnForm.get("packagingAndForwadingCharges"))==null?null:a.value)||0,"1.2-2"),""),s(6),F("\u20B9",w(103,33,n.grandTotal,"1.2-2"),""),s(3),d("disabled",n.loading),s(3),d("disabled",n.returnForm.invalid||n.loading),s(),d("ngClass",n.loading?"fa-spinner fa-spin":"fa-save"),s(),F(" ",n.loading?n.isEdit?"Updating...":"Saving...":n.isEdit?"Update Sale Return":"Save Sale Return"," "),s(),d("show",n.loading)}},dependencies:[R,L,V,B,z,mt,j,$,ht,q,G,pt,gt,Z,E,A,dt],styles:[".add-sale-container[_ngcontent-%COMP%]{padding:2rem;margin:0 auto}@media (max-width: 768px){.add-sale-container[_ngcontent-%COMP%]{padding:1rem}}.form-control[_ngcontent-%COMP%]{height:40px}@media (max-width: 768px){.form-control[_ngcontent-%COMP%]{font-size:16px;min-height:44px}}.back-btn[_ngcontent-%COMP%]{margin-bottom:1rem;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.form-card[_ngcontent-%COMP%]{background:#fff;border-radius:var(--border-radius);box-shadow:var(--card-shadow);overflow:hidden}.card-header[_ngcontent-%COMP%]{background-color:var(--primary);padding:1.5rem}.card-header[_ngcontent-%COMP%]   .form-title[_ngcontent-%COMP%]{color:#fff;margin:0;font-size:1.5rem;font-weight:500;display:flex;align-items:center;gap:.5rem}.sale-form[_ngcontent-%COMP%]{padding:2rem}@media (max-width: 768px){.sale-form[_ngcontent-%COMP%]{padding:1rem}}.header-section[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-bottom:2rem}.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.products-section[_ngcontent-%COMP%]{background-color:#fff;border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;border:1px solid var(--primary)}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:var(--text-primary);font-size:1.25rem;display:flex;align-items:center;gap:.5rem}.products-section[_ngcontent-%COMP%]   .products-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem;color:var(--text-primary);font-weight:500}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--primary)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   .required[_ngcontent-%COMP%]{color:var(--danger);margin-left:4px}.select-group[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:.5rem;width:100%;overflow:visible}.select-group.inline[_ngcontent-%COMP%]{flex-direction:row;align-items:center;gap:.5rem}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{display:block;flex:1;position:relative;z-index:100;overflow:visible}.select-group[_ngcontent-%COMP%]   app-searchable-select.custom-width[_ngcontent-%COMP%]{position:absolute;z-index:1000;left:0}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within{z-index:1000;position:relative}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]:focus-within     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]     .select-dropdown{z-index:1001!important;position:absolute!important}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]{flex-shrink:0;margin-top:0;height:40px;min-width:40px;display:flex;align-items:center;justify-content:center;position:relative;z-index:1;border:1px solid var(--supporting);border-radius:8px;background:#fff;transition:all .3s ease;color:var(--primary);touch-action:manipulation;-webkit-tap-highlight-color:transparent}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary);color:#fff}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.select-group[_ngcontent-%COMP%]   .refresh[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.input-group[_ngcontent-%COMP%]{display:flex;align-items:stretch}.input-group[_ngcontent-%COMP%]   .input-group-text[_ngcontent-%COMP%]{background-color:var(--background);border:1px solid var(--border-color);border-right:none;border-radius:var(--border-radius) 0 0 var(--border-radius);height:38px;color:var(--text-secondary);min-width:40px;display:flex;align-items:center;justify-content:center}.input-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{border-radius:0 var(--border-radius) var(--border-radius) 0;flex:1}.sale-summary[_ngcontent-%COMP%]{background-color:var(--background-light);border-radius:var(--border-radius);padding:1.5rem;margin-top:2rem;display:flex;justify-content:flex-end;gap:2rem;flex-wrap:wrap}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--text-secondary);font-size:.875rem}.sale-summary[_ngcontent-%COMP%]   .summary-item[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--text-primary);font-size:1.25rem;font-weight:600}.sale-summary[_ngcontent-%COMP%]   .summary-item.total[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--primary)}@media (max-width: 768px){.sale-summary[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-end;gap:1rem}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border-color)}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{width:100%}}.table-responsive[_ngcontent-%COMP%]{margin:0 -1.5rem;padding:0 1.5rem;overflow-x:auto;min-height:400px;-webkit-overflow-scrolling:touch}@media (max-width: 768px){.table-responsive[_ngcontent-%COMP%]{margin:0 -1rem;padding:0 1rem}}.products-table[_ngcontent-%COMP%]{width:100%;margin-bottom:0;background:#fff;border-collapse:separate;border-spacing:0}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:var(--background-light);color:var(--text-primary);font-weight:600;padding:1rem;white-space:nowrap;border-bottom:2px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-child{width:30%;min-width:300px}.products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(4){width:10%;max-width:120px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem 1rem;vertical-align:middle;border-bottom:1px solid var(--border-color)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{min-width:80px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child{width:30%;min-width:300px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-child   .form-control[_ngcontent-%COMP%]{min-width:300px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4){width:10%;max-width:120px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(4)   .form-control[_ngcontent-%COMP%]{min-width:100px;max-width:120px}.products-table[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{flex-wrap:nowrap}.products-table[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{margin:0 auto}@media (max-width: 768px){.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem}}.form-field-container[_ngcontent-%COMP%]{position:relative;margin-bottom:1rem;overflow:visible}.form-field-container[_ngcontent-%COMP%]   .form-control.is-invalid[_ngcontent-%COMP%], .form-field-container[_ngcontent-%COMP%]   .input-group.is-invalid[_ngcontent-%COMP%]{border-color:var(--danger);background-image:url(data:image/svg+xml,...)}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding-bottom:1.5rem;vertical-align:top}.invalid-feedback[_ngcontent-%COMP%]{color:var(--danger);font-size:.75rem;margin-top:.25rem;animation:_ngcontent-%COMP%_fadeIn .3s ease-in}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(-5px)}to{opacity:1;transform:translateY(0)}}@media (hover: none) and (pointer: coarse){.btn[_ngcontent-%COMP%]{min-height:44px;min-width:44px;touch-action:manipulation;-webkit-tap-highlight-color:transparent}.form-control[_ngcontent-%COMP%]{min-height:44px;font-size:16px}.products-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .products-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.75rem .5rem}}form[_ngcontent-%COMP%]{touch-action:manipulation}@media (max-width: 768px){app-searchable-select[_ngcontent-%COMP%]{position:relative;z-index:1000}}"],changeDetection:0})}}return c})();var Ce=()=>({label:"All Customers",value:""});function Pe(c,_){if(c&1){let t=y();o(0,"div",6)(1,"div",31),u(2,"app-searchable-select",32),o(3,"button",33),m("click",function(){h(t);let n=g();return f(n.refreshCustomers())})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(4,"i",34),r()()()}if(c&2){let t=g();s(2),d("options",t.customers)("defaultOption",ct(5,Ce))("searchPlaceholder","Search customers..."),s(),d("disabled",t.isLoadingCustomers),s(),d("ngClass",t.isLoadingCustomers?"fa-spinner fa-spin":"fa-sync-alt")}}function Me(c,_){if(c&1){let t=y();o(0,"button",35),m("click",function(){h(t);let n=g();return f(n.exportExcel())})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(1,"i",36),i(2," Export "),r()}if(c&2){let t=g();d("disabled",t.isExportButtonDisabled())}}function ve(c,_){if(c&1){let t=y();o(0,"div",37)(1,"button",38),m("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(2,"i",39),i(3," Add Sale Return "),r()()}}function xe(c,_){c&1&&(o(0,"th",27),i(1,"Actions"),r())}function Oe(c,_){if(c&1){let t=y();o(0,"td",47)(1,"button",48),m("click",function(){h(t);let n=g().$implicit,a=g();return f(a.generatePdf(n.id,n.invoiceNumber))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(2,"i",49),r(),o(3,"button",50),m("click",function(){h(t);let n=g().$implicit,a=g();return f(a.viewDetails(n==null?null:n.id))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(4,"i",51),r(),o(5,"button",52),m("click",function(){h(t);let n=g().$implicit,a=g();return f(a.deleteSaleReturn(n.id))})("touchstart",function(n){return h(t),f(n.stopPropagation())}),u(6,"i",53),r()()}if(c&2){let t=g().$implicit;s(3),d("disabled",!(t!=null&&t.id))}}function ye(c,_){if(c&1&&(o(0,"tr",40)(1,"td",41),i(2),r(),o(3,"td",42)(4,"strong"),i(5),r()(),o(6,"td",43),i(7),r(),o(8,"td",44),i(9),k(10,"date"),r(),o(11,"td",45)(12,"strong"),i(13),r()(),C(14,Oe,7,1,"td",46),r()),c&2){let t=_.$implicit,e=_.index,n=g();s(2),S(n.startIndex+e+1),s(3),S(t.invoiceNumber),s(2),S(t.customerName),s(2),S(w(10,6,t.saleReturnDate,"dd-MM-yyyy")),s(4),S(t.totalSaleAmount||0),s(),d("ngIf",n.canManagePurchases)}}function Se(c,_){if(c&1){let t=y();o(0,"app-pagination",54),m("pageChange",function(n){h(t);let a=g();return f(a.onPageChange(n))})("pageSizeChange",function(n){h(t);let a=g();return f(a.onPageSizeChange(n))}),r()}if(c&2){let t=g();d("currentPage",t.currentPage)("pageSize",t.pageSize)("totalElements",t.totalElements)("pageSizeOptions",t.pageSizeOptions)}}var qt=(()=>{class c{constructor(t,e,n,a,l,P,M,v,J){this.saleService=t,this.customerService=e,this.fb=n,this.snackbar=a,this.dateUtils=l,this.encryptionService=P,this.router=M,this.authService=v,this.cdr=J,this.saleReturns=[],this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.pageSizeOptions=[5,10,25,50,100],this.totalPages=0,this.totalElements=0,this.startIndex=0,this.endIndex=0,this.customers=[],this.isLoadingCustomers=!1,this.canManagePurchases=!1,this.destroy$=new I,this.initializeForm()}ngOnInit(){this.canManagePurchases=this.authService.isAdmin()||this.authService.isStaffAdmin(),this.loadSaleReturns(),this.canManagePurchases&&this.loadCustomers()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}initializeForm(){this.searchForm=this.fb.group({search:[""],batchNumber:[""],customerId:[""],startDate:[""],endDate:[""]})}loadSaleReturns(){this.isLoading=!0;let t=this.searchForm.value,e={currentPage:this.currentPage,perPageRecord:this.pageSize,search:t.search?.trim()||void 0,customerId:this.canManagePurchases&&t.customerId?Number(t.customerId):void 0,startDate:t.startDate?this.formatDateForApi(t.startDate):void 0,endDate:t.endDate?this.formatDateForApi(t.endDate):void 0};Object.keys(e).forEach(n=>{e[n]===void 0&&delete e[n]}),this.saleService.searchSaleReturn(e).pipe(b(this.destroy$)).subscribe({next:n=>{this.saleReturns=n.content||[],this.totalPages=n.totalPages||0,this.totalElements=n.totalElements||0,this.updatePaginationIndexes(),this.isLoading=!1,this.cdr.markForCheck()},error:n=>{this.snackbar.error(n?.error?.message||"Failed to load sale returns"),this.isLoading=!1,this.cdr.markForCheck()}})}formatDateForApi(t){if(!t)return"";let e=new Date(t);if(isNaN(e.getTime()))return"";let n=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${n}-${a}-${l}`}updatePaginationIndexes(){this.startIndex=this.currentPage*this.pageSize,this.endIndex=Math.min((this.currentPage+1)*this.pageSize,this.totalElements)}onSearch(t){t&&(t.preventDefault(),t.stopPropagation()),this.currentPage=0,this.loadSaleReturns()}resetForm(){this.searchForm.reset(),this.currentPage=0,this.loadSaleReturns()}onPageChange(t){this.currentPage=t,this.loadSaleReturns()}onPageSizeChange(t){this.pageSize=t,this.currentPage=0,this.loadSaleReturns()}loadCustomers(){this.canManagePurchases&&(this.isLoadingCustomers=!0,this.customerService.getCustomers({status:"A"}).pipe(b(this.destroy$)).subscribe({next:t=>{t?.success&&t.data&&(this.customers=t.data),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to load customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}refreshCustomers(){this.canManagePurchases&&(this.isLoadingCustomers=!0,this.customerService.refreshCustomers().pipe(b(this.destroy$)).subscribe({next:t=>{t?.success&&t.data&&(this.customers=t.data,this.snackbar.success("Customers refreshed successfully")),this.isLoadingCustomers=!1,this.cdr.markForCheck()},error:()=>{this.snackbar.error("Failed to refresh customers"),this.isLoadingCustomers=!1,this.cdr.markForCheck()}}))}viewDetails(t){if(!t){this.snackbar.error("Sale return ID is not available");return}let e=this.encryptionService.encrypt(t.toString());this.router.navigate(["/sale/return",e])}deleteSaleReturn(t){confirm("Are you sure you want to delete this sale return? This action cannot be undone.")&&(this.isLoading=!0,this.saleService.deleteSaleReturn(t).pipe(b(this.destroy$)).subscribe({next:e=>{e?.success?(this.snackbar.success(e.message||"Sale return deleted successfully"),this.loadSaleReturns()):(this.snackbar.error(e?.message||"Failed to delete sale return"),this.isLoading=!1,this.cdr.markForCheck())},error:e=>{this.snackbar.error(e?.error?.message||"Failed to delete sale return"),this.isLoading=!1,this.cdr.markForCheck()}}))}generatePdf(t,e){this.saleService.generateSaleReturnPdf(t).pipe(b(this.destroy$)).subscribe({next:({blob:n,filename:a})=>{let l="sale-return-"+(e?`${e}.pdf`:a),P=window.URL.createObjectURL(n),M=document.createElement("a");M.href=P,M.download=l,document.body.appendChild(M),M.click(),document.body.removeChild(M),window.URL.revokeObjectURL(P),this.snackbar.success("PDF downloaded successfully")},error:n=>{this.snackbar.error(n?.error?.message||"Failed to generate PDF")}})}isExportButtonDisabled(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;return!t||!e}exportExcel(){let t=this.searchForm.get("startDate")?.value,e=this.searchForm.get("endDate")?.value;if(!t||!e){this.snackbar.error("Please select both start date and end date to export");return}let n=this.dateUtils.formatDateDDMMYYYY(t),a=this.dateUtils.formatDateDDMMYYYY(e);this.isLoading=!0,this.saleService.exportSaleReturnExcel({startDate:n,endDate:a}).pipe(b(this.destroy$)).subscribe({next:({blob:l,filename:P})=>{let M=window.URL.createObjectURL(l),v=document.createElement("a");v.href=M,v.download=P||`sale_return_export_${n}_${a}.xlsx`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(M),this.snackbar.success("Excel file downloaded successfully"),this.isLoading=!1,this.cdr.markForCheck()},error:l=>{this.snackbar.error(l?.error?.message||"Failed to export Excel file"),this.isLoading=!1,this.cdr.markForCheck()}})}static{this.\u0275fac=function(e){return new(e||c)(p(H),p(W),p(Y),p(K),p(Ct),p(Q),p(U),p(_t),p(N))}}static{this.\u0275cmp=D({type:c,selectors:[["app-sale-return-list"]],decls:53,vars:8,consts:[[1,"purchase-container"],[3,"show"],["aria-labelledby","search-sale-returns-heading",1,"search-section","card"],["id","search-sale-returns-heading"],["role","search","aria-label","Sale return search form",3,"ngSubmit","formGroup"],[1,"search-controls"],[1,"form-group"],["for","invoice-search",1,"sr-only"],["id","invoice-search","type","text","formControlName","search","placeholder","Search by invoice number...","aria-label","Search by invoice number",1,"form-control"],["for","batch-search",1,"sr-only"],["id","batch-search","type","text","formControlName","batchNumber","placeholder","Search by Batch Number...","aria-label","Search by batch number",1,"form-control"],["class","form-group",4,"ngIf"],["for","start-date",1,"sr-only"],["id","start-date","type","date","formControlName","startDate","placeholder","Start Date","aria-label","Start date",1,"form-control",3,"touchstart"],["for","end-date",1,"sr-only"],["id","end-date","type","date","formControlName","endDate","placeholder","End Date","aria-label","End date",1,"form-control",3,"touchstart"],[1,"button-group"],["type","submit",1,"search-btn","btn","btn-sm","btn-primary",3,"touchstart"],[1,"fas","fa-search"],["type","button",1,"search-btn","btn","btn-sm","btn-secondary",3,"click","touchstart"],[1,"fas","fa-undo"],["type","button","class","search-btn btn btn-sm btn-success export-btn","title","Export sale returns to Excel",3,"disabled","click","touchstart",4,"ngIf"],["class","action-buttons",4,"ngIf"],["aria-labelledby","sale-returns-heading",1,"purchases-list","card"],["id","sale-returns-heading"],[1,"table-responsive"],["role","table","aria-label","Sale returns list",1,"table"],["scope","col"],["scope","col",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],[3,"currentPage","pageSize","totalElements","pageSizeOptions","pageChange","pageSizeChange",4,"ngIf"],[1,"product-select-group"],["formControlName","customerId","labelKey","name","valueKey","id",3,"options","defaultOption","searchPlaceholder"],["type","button","title","Refresh Customers",1,"btn","btn-sm","btn-primary","refresh",2,"margin-top","3px",3,"click","touchstart","disabled"],[1,"fas",3,"ngClass"],["type","button","title","Export sale returns to Excel",1,"search-btn","btn","btn-sm","btn-success","export-btn",3,"click","touchstart","disabled"],[1,"fas","fa-file-excel"],[1,"action-buttons"],["routerLink","/sale/return/create","aria-label","Add new sale return",1,"btn","btn-sm","btn-primary",3,"touchstart"],["aria-hidden","true",1,"fas","fa-plus"],["role","row"],["data-label","No"],["data-label","Invoice No."],["data-label","Customer Name"],["data-label","Sale Return Date"],["data-label","Total Amount"],["class","actions","data-label","Actions",4,"ngIf"],["data-label","Actions",1,"actions"],["aria-label","Export sale return as PDF",1,"btn-icon","pdf",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-file-pdf"],["aria-label","View sale return details",1,"btn-icon","edit",3,"click","touchstart","disabled"],["aria-hidden","true",1,"fas","fa-eye"],["aria-label","Delete sale return",1,"btn-icon","delete",3,"click","touchstart"],["aria-hidden","true",1,"fas","fa-trash"],[3,"pageChange","pageSizeChange","currentPage","pageSize","totalElements","pageSizeOptions"]],template:function(e,n){e&1&&(o(0,"div",0),u(1,"app-loader",1),o(2,"section",2)(3,"h2",3),i(4,"Search Sale Returns"),r(),o(5,"form",4),m("ngSubmit",function(l){return n.onSearch(l)}),o(6,"div",5)(7,"div",6)(8,"label",7),i(9,"Search by invoice number"),r(),u(10,"input",8),o(11,"label",9),i(12,"Search by batch number"),r(),u(13,"input",10),r(),C(14,Pe,5,6,"div",11),o(15,"div",6)(16,"label",12),i(17,"Start date"),r(),o(18,"input",13),m("touchstart",function(l){return l.stopPropagation()}),r()(),o(19,"div",6)(20,"label",14),i(21,"End date"),r(),o(22,"input",15),m("touchstart",function(l){return l.stopPropagation()}),r()(),o(23,"div",16)(24,"button",17),m("touchstart",function(l){return l.stopPropagation()}),u(25,"i",18),i(26," Search "),r(),o(27,"button",19),m("click",function(){return n.resetForm()})("touchstart",function(l){return l.stopPropagation()}),u(28,"i",20),i(29," Reset "),r(),C(30,Me,3,1,"button",21),r()()()(),C(31,ve,4,0,"div",22),o(32,"section",23)(33,"h2",24),i(34,"Sale Returns"),r(),o(35,"div",25)(36,"table",26)(37,"thead")(38,"tr")(39,"th",27),i(40,"No"),r(),o(41,"th",27),i(42,"Invoice No."),r(),o(43,"th",27),i(44,"Customer Name"),r(),o(45,"th",27),i(46,"Sale Return Date"),r(),o(47,"th",27),i(48,"Total Amount"),r(),C(49,xe,2,0,"th",28),r()(),o(50,"tbody"),C(51,ye,15,9,"tr",29),r()()(),C(52,Se,1,4,"app-pagination",30),r()()),e&2&&(s(),d("show",n.isLoading),s(4),d("formGroup",n.searchForm),s(9),d("ngIf",n.canManagePurchases),s(16),d("ngIf",n.canManagePurchases),s(),d("ngIf",n.canManagePurchases),s(18),d("ngIf",n.canManagePurchases),s(2),d("ngForOf",n.saleReturns),s(),d("ngIf",n.totalPages>0))},dependencies:[R,L,V,B,z,j,$,q,G,Z,E,A,tt,lt],styles:[".purchase-container[_ngcontent-%COMP%]{padding:2rem;position:relative;min-height:200px;background-color:var(--background)}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{background:#fff;border-radius:0;box-shadow:0 2px 4px #0000001a;margin-bottom:20px;padding:20px}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;color:var(--text-primary);font-size:1.5rem;font-weight:600}.purchase-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{margin-bottom:1rem;display:flex;justify-content:flex-start;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{touch-action:manipulation;-webkit-tap-highlight-color:transparent}.purchase-container[_ngcontent-%COMP%]   .sr-only[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:flex-start}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{grid-template-columns:1fr}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin:0}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{height:40px}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{font-size:16px;min-height:44px}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{width:42px;padding:0;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color);border-radius:var(--border-radius);background:var(--primary)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:hover:not(:disabled){background:var(--primary)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   .product-select-group[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]{grid-column:1/-1}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1;min-width:120px;height:42px;display:flex;align-items:center;justify-content:center;gap:.5rem;transition:all .2s ease;touch-action:manipulation;-webkit-tap-highlight-color:transparent;cursor:pointer}@media (max-width: 576px){.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100%;flex:1 1 100%}}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]{background-color:#28a745;color:#fff;border:1px solid #28a745;font-weight:500}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#218838;border-color:#1e7e34;transform:translateY(-1px);box-shadow:0 2px 4px #28a7454d}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:active:not(:disabled), .purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:focus:not(:disabled){outline:2px solid rgba(40,167,69,.5);outline-offset:2px;transform:translateY(0)}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]:disabled{background-color:#6c757d;border-color:#6c757d;opacity:.6;cursor:not-allowed;transform:none}.purchase-container[_ngcontent-%COMP%]   .search-section[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .button-group[_ngcontent-%COMP%]   button.export-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:#fff}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table-responsive[_ngcontent-%COMP%]{overflow-x:auto;-webkit-overflow-scrolling:touch}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{white-space:nowrap;font-weight:600}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{display:none}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{display:block;margin-bottom:1rem;border:1px solid #dee2e6;border-radius:4px;padding:.5rem}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;border:none;border-bottom:1px solid #f0f0f0}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:before{content:attr(data-label);font-weight:600;color:var(--text-primary)}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{border-bottom:none}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]{justify-content:flex-start;flex-wrap:wrap;gap:.5rem}.purchase-container[_ngcontent-%COMP%]   .purchases-list[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td.actions[_ngcontent-%COMP%]:before{display:none}}@media (max-width: 768px){.purchase-container[_ngcontent-%COMP%]{padding:1rem}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{width:100%}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[type=date][_ngcontent-%COMP%]{touch-action:manipulation;-webkit-appearance:none;font-size:16px}.purchase-container[_ngcontent-%COMP%]   .search-controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:1rem}}@media (max-width: 576px){.purchase-container[_ngcontent-%COMP%]{padding:.75rem}.purchase-container[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.25rem}}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:flex-start;flex-wrap:wrap}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{background:none;border:none;padding:8px;cursor:pointer;border-radius:6px;transition:all .2s ease;display:flex;align-items:center;justify-content:center;touch-action:manipulation;-webkit-tap-highlight-color:transparent;min-width:36px;min-height:36px}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]{color:var(--primary);background-color:#1458811a}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.edit[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon.pdf[_ngcontent-%COMP%]:disabled{color:var(--text-secondary);background-color:#0000000d;cursor:not-allowed}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]{color:#dc3545;background-color:#dc35451a}.actions[_ngcontent-%COMP%]   .btn-icon.delete[_ngcontent-%COMP%]:hover{background-color:#dc3545;color:#fff;transform:translateY(-1px)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]:active{transform:translateY(0)}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:16px}@media (max-width: 768px){.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]{padding:6px}.actions[_ngcontent-%COMP%]   .btn-icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:14px}}.product-select-group[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:flex-start}.product-select-group[_ngcontent-%COMP%]   app-searchable-select[_ngcontent-%COMP%]{flex:1}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]{background-color:var(--background);color:#fff;margin-top:3px;width:42px;height:42px;border-radius:6px;transition:all .2s ease}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:hover:not(:disabled){background-color:var(--primary);color:#fff;transform:translateY(-1px)}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:not-allowed}.product-select-group[_ngcontent-%COMP%]   .btn-icon.refresh[_ngcontent-%COMP%]:active{transform:translateY(0)}"],changeDetection:0})}}return c})();var ke=[{path:"",component:Bt},{path:"create",component:Ft},{path:"edit/:id",component:Ft},{path:"return",component:qt},{path:"return/create",component:Et},{path:"return/:id",component:Et}],Gt=(()=>{class c{static{this.\u0275fac=function(e){return new(e||c)}}static{this.\u0275mod=st({type:c})}static{this.\u0275inj=at({imports:[et.forChild(ke),et]})}}return c})();var bn=(()=>{class c{static{this.\u0275fac=function(e){return new(e||c)}}static{this.\u0275mod=st({type:c})}static{this.\u0275inj=at({imports:[Dt,Lt,Rt,et,zt,Gt,E,A,tt,jt]})}}return c})();export{bn as SaleModule};
